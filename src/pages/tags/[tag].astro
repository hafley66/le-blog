---
import IndexFolderPage from "~/components/IndexFolderPage.astro";

export async function getStaticPaths() {
  const uniqueTags = Object.values(
    import.meta.glob(`../blog/*/index.mdx`, { eager: true }),
  ).map((i: any) => ({
    ...i,
    ...i.frontmatter,
  }));

  const mapping: Record<string, typeof uniqueTags> = {};
  uniqueTags.forEach((it) => {
    it.tags.forEach((tag) => {
      (mapping[tag] ||= []).push(it);
    });
  });

  return Object.entries(mapping).map((i) => ({
    params: { tag: i[0] },
    props: { posts: i[1] },
  }));
}

const { tag } = Astro.params;
const { posts } = Astro.props;
---

<IndexFolderPage
  title={tag}
  description={"All the blogs"}
  modules={posts}
  h1={"TAG: " + tag}
/>
