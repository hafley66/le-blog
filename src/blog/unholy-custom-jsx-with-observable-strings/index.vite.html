<html lang="en"><head><meta name="viewport" content="width=device-width, initial-scale=1"><meta charSet="UTF-8"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><script>window.resizeIframe = function resizeIframe(obj) {
          obj.style.height = obj.contentWindow.document.documentElement.scrollHeight + 'px';
          }</script><link rel="stylesheet" href="/styles/colors.css"><link rel="stylesheet" href="/styles/fonts.css"><link rel="stylesheet" href="/styles/global.css"><link rel="stylesheet" href="/styles/nav_and_toc.css"><link rel="stylesheet" href="/styles/hex.css"><link rel="stylesheet" href="/styles/code.css"><link rel="stylesheet" href="/styles/img.css"><link rel="stylesheet" href="/shiki-twoslash.css"><title>(DRAFT) True lazy rendering with JSX and RxJS Observables (DRAFT)</title><script type="module" src="/lib/remark_rehype/demo-runner.daemon.dom.ts" defer="true"></script></head><body class=""><header><nav id="primary-nav" aria-label="Primary navigation"><div class="nav-links" role="tablist"><a href="/home/index.html" role="tab" class="nav-link-anchor"><span class="nav-link ">Home</span></a><a href="/resume/index.html" role="tab" class="nav-link-anchor"><span class="nav-link ">Resume</span></a><a href="/blog/index.html" role="tab" aria-selected="true" class="nav-link-anchor"><span class="nav-link active">Blog</span></a></div></nav></header><main class="body-markdown"><section id="title-and-description"><h1>(DRAFT) True lazy rendering with JSX and RxJS Observables (DRAFT)</h1><sub>2025-02-25 by Chris Hafley</sub><div id="h1-desc"><div class="f-col"><strong>DRAFT!!!</strong><em><blockquote>"Do you think God stays in heaven because he too lives in fear of what he's created?"</blockquote></em></div></div><div class="f-col f-a-center" id="tags" style="margin-bottom:24px;"><div class="responsive-hex-grid-3"><a class="hex-content caption" href="/tags/typescript" style="--hex-color:var(--color-inferno-2);">
      <div class="hex-content hex-shadow">
        <div class="hex-content-amoeba"></div>
      </div>
      <div class="hex-content-amoeba"></div>
      <span>typescript</span>
</a><a class="hex-content caption" href="/tags/javascript" style="--hex-color:var(--color-inferno-4);">
      <div class="hex-content hex-shadow">
        <div class="hex-content-amoeba"></div>
      </div>
      <div class="hex-content-amoeba"></div>
      <span>javascript</span>
</a><a class="hex-content caption" href="/tags/jsx" style="--hex-color:var(--color-inferno-6);">
      <div class="hex-content hex-shadow">
        <div class="hex-content-amoeba"></div>
      </div>
      <div class="hex-content-amoeba"></div>
      <span>jsx</span>
</a><a class="hex-content caption" href="/tags/react" style="--hex-color:var(--color-inferno-8);">
      <div class="hex-content hex-shadow">
        <div class="hex-content-amoeba"></div>
      </div>
      <div class="hex-content-amoeba"></div>
      <span>react</span>
</a><a class="hex-content caption" href="/tags/deno" style="--hex-color:var(--color-inferno-10);">
      <div class="hex-content hex-shadow">
        <div class="hex-content-amoeba"></div>
      </div>
      <div class="hex-content-amoeba"></div>
      <span>deno</span>
</a><a class="hex-content caption" href="/tags/rxjs" style="--hex-color:var(--color-inferno-12);">
      <div class="hex-content hex-shadow">
        <div class="hex-content-amoeba"></div>
      </div>
      <div class="hex-content-amoeba"></div>
      <span>rxjs</span>
</a></div></div></section><details open="true" id="section-table-of-contents"><summary id="toc-header-contents"><h2 id="table-of-contents">Table of Contents</h2><input type="checkbox" id="toc-toggle"></summary><div class="fancy-hr"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 20"><circle cx="10" cy="10" r="7" style="fill:var(--color-text);" stroke-width="2"></circle><circle cx="30" cy="10" r="9" style="fill:var(--color-text);" stroke-width="2" fill="transparent"></circle><circle cx="50" cy="10" r="7" style="fill:var(--color-text);" stroke-width="2"></circle></svg></div><nav id="toc-nav"><ol><li><a href="#section-html-over-time">1.  HTML Over Time</a><ol><li><a href="#section-but-actually-why">1.1.  But actually why</a></li><li><a href="#section-comparisons-with-react">1.2.  Comparisons with React</a></li><li><a href="#section-basic-demos">1.3.  Basic Demos</a></li></ol></li><li><a href="#section-jsx-element-type">2.  JSX.Element Type</a></li><li><a href="#section-components">3.  Components</a><ol><li><a href="#section-add-static-props-and-styling">3.1.  Add static props and styling</a></li></ol></li><li><a href="#section-props">4.  Props</a></li><li><a href="#section-counter-demo">5.  Counter Demo</a></li><li><a href="#section-children">6.  Children</a><ol><li><a href="#section-arrays">6.1.  Arrays</a></li><li><a href="#section-conditionals">6.2.  Conditionals</a></li></ol></li><li><a href="#section-events">7.  Events</a></li><li><a href="#section-state">8.  State</a></li></ol></nav></details><div id="main-content-middle"><section id="section-html-over-time"><h2 id="html-over-time"><a href="#html-over-time"><span class="marker">1.</span>  HTML Over Time<div class="flair-a"></div></a><div class="flair-h"></div></h2><p>React Components represent <strong>HTML</strong> over time.</p><p>Observables represent <strong>any value</strong>  over time.</p><p>So then, we can say React Components are <code>Observable&#x3C;JSX></code> over time.</p><p>After seeing this logic, I decided to create a RxJS version of <code>JSX</code>. It is meant to be as simple as possible, and promote what I view as idiomatic/practical RxJS.</p><style>
#section-html-over-time {
  --section-header-hr-start: -8.881784197001252e-16%;
  --section-header-hr-stop: 7.142857142857142%;
}
</style><div class="flair-section"></div></section>
<section id="section-but-actually-why"><h3 id="but-actually-why"><a href="#but-actually-why"><span class="marker">1.1.</span>  But actually why<div class="flair-a"></div></a><div class="flair-h"></div></h3><p>I have a lot of experience getting react to work with RxJS. Often times, its a chaotic mess. Its much like lifting everything out of react and into redux. But even with redux, you are often left re-implementing a ton of missing features that are just in rxjs for free.</p><p>My biggest frustration was making this blog while learning the ReactDOM server API's. You must spam <code>use(Promise)</code> everywhere to prevent rendering your blog post. useEffect cannot be used as a way to defer rendering. React notes this in their docs for 19, with a special info block that tells you to use a meta-framework that does all this for you. Talk about friendly and intuitive ergonomics.</p><p>These are simply non-problems in RxJS, so I decided to write a version of jsx that <strong>naturally</strong> allows lazy programming, by leveraging Observable's and RxJS.</p><p>If you want to defer rendering for a blog post, just do whatever combo of rxjs that you need.</p><p>RxJS is fundamentally the reverse order of how you do things in other libraries, but they express all the same things.</p><p>I truly hope that this is a starting point for some devs to build intuition or interest in RxJS, and more importantly, Observable's as a standard data structure.</p><style>
#section-but-actually-why {
  --section-header-hr-start: 7.1428571428571415%;
  --section-header-hr-stop: 14.285714285714285%;
}
</style><div class="flair-section"></div></section>
<section id="section-comparisons-with-react"><h3 id="comparisons-with-react"><a href="#comparisons-with-react"><span class="marker">1.2.</span>  Comparisons with React<div class="flair-a"></div></a><div class="flair-h"></div></h3><ol>
<li>Components
<ul>
<li>Components are <strong>run once</strong>
<ul>
<li>Unlike React, more like Solid.js</li>
</ul>
</li>
<li>The unit of reactivity is <code>Observable&#x3C;string></code>
<ul>
<li>Not signals, and not magic hooks</li>
<li>Just an Symbol.asyncIterable compatible data structure</li>
</ul>
</li>
<li>Props
<ul>
<li>Props are not reactive, if you want reactive props, you must pass Observables</li>
</ul>
</li>
</ul>
</li>
<li>JSX Basics
<ul>
<li>Like all others, style as css object, className, id</li>
<li><strong>There are no refs</strong>: this is intentional...for now</li>
<li>There is no vdom and reason for <code>key</code> prop...also for now
<ul>
<li>I will eventually learn how to make efficient dom updates just using rxjs and a read/write queue</li>
</ul>
</li>
</ul>
</li>
<li>DOM events
<ul>
<li>I am not supporting inline handlers for now
<ul>
<li>I view it as an anti-pattern</li>
</ul>
</li>
<li>Instead, there are helpers for making <strong>event delegation</strong> patterns easier
<ul>
<li><strong>jQuery was right all along</strong></li>
</ul>
</li>
<li>But this keeps the DOM you produced mostly serializable from the get go</li>
</ul>
</li>
<li>State
<ul>
<li>scan operator exists or new Observable for idiomatic RxJS</li>
<li>BehaviorSubject for imperative/useState style setState</li>
</ul>
</li>
<li>Memos/Computed/Derived
<ul>
<li>In RxJS, you have a massive amount of incredibly useful tools</li>
<li>The very basic combo of <code>combineLatest(...).pipe(map(MEMO_FN))</code> will get you very far
<ul>
<li>This gives you manual control of the reactivity, instead of having 1 blunt tool for it
<ul>
<li>(Lexical scope deps arrays)</li>
</ul>
</li>
</ul>
</li>
<li>I do nothing special here, you must learn the power of <code>merge</code>, <code>combineLatest</code></li>
</ul>
</li>
<li>Effects
<ul>
<li>switchMap
<ul>
<li>switchMap</li>
<li>?????????</li>
<li>Believe it or not, also switchMap</li>
</ul>
</li>
<li>The ubiquity of switchMap will drive you nuts</li>
<li>You will see it in every library you use, a horrifically custom and duct taped switchMap of disappointment</li>
<li>You can do conditional useEffect's in this lib, bc switchMap doesn't care about magic call order</li>
</ul>
</li>
<li>Server Side Stuff
<ul>
<li>I have crazy ideas for this with websockets but thats a much later thing.</li>
<li>Running on the server is easy, I do it for the demos that output console.logs to the page.</li>
<li>Its just a string output, so you do what you want with it.</li>
<li>Some day I'll make a better situations but for now it works fine for my blog.</li>
</ul>
</li>
</ol><style>
#section-comparisons-with-react {
  --section-header-hr-start: 14.285714285714285%;
  --section-header-hr-stop: 21.428571428571427%;
}
</style><div class="flair-section"></div></section>
<section id="section-basic-demos"><h3 id="basic-demos"><a href="#basic-demos"><span class="marker">1.3.</span>  Basic Demos<div class="flair-a"></div></a><div class="flair-h"></div></h3><p>Here are 4 intro demos demonstrating basic jsx, sync jsx, and async jsx with observables, and async jsx with rxjs.</p><p>The console.logs represent the value of html emitted over time.</p><div class="code-group" id="src/blog/unholy-custom-jsx-with-observable-strings/intro/"><div id="code-group-src/blog/unholy-custom-jsx-with-observable-strings" class="code-group-tabs" data-sticky="1"><input type="radio" value="1.sync.deno.tsx" id="src/blog/unholy-custom-jsx-with-observable-strings/intro/1.sync.deno.tsx" name="src/blog/unholy-custom-jsx-with-observable-strings/intro/" class="code-tabs-radio-input" data-scroll-to-me="src/blog/unholy-custom-jsx-with-observable-strings/intro/" checked="true"><label for="src/blog/unholy-custom-jsx-with-observable-strings/intro/1.sync.deno.tsx"><div class="centerino">Sync RxJSX
</div></label><input type="radio" value="4.async.rxjs.deno.tsx" id="src/blog/unholy-custom-jsx-with-observable-strings/intro/4.async.rxjs.deno.tsx" name="src/blog/unholy-custom-jsx-with-observable-strings/intro/" class="code-tabs-radio-input" data-scroll-to-me="src/blog/unholy-custom-jsx-with-observable-strings/intro/"><label for="src/blog/unholy-custom-jsx-with-observable-strings/intro/4.async.rxjs.deno.tsx"><div class="centerino">Async RxJS
</div></label><input type="radio" value="2.basic.deno.tsx" id="src/blog/unholy-custom-jsx-with-observable-strings/intro/2.basic.deno.tsx" name="src/blog/unholy-custom-jsx-with-observable-strings/intro/" class="code-tabs-radio-input" data-scroll-to-me="src/blog/unholy-custom-jsx-with-observable-strings/intro/"><label for="src/blog/unholy-custom-jsx-with-observable-strings/intro/2.basic.deno.tsx"><div class="centerino">2.basic.deno.tsx</div></label><input type="radio" value="3.async.deno.tsx" id="src/blog/unholy-custom-jsx-with-observable-strings/intro/3.async.deno.tsx" name="src/blog/unholy-custom-jsx-with-observable-strings/intro/" class="code-tabs-radio-input" data-scroll-to-me="src/blog/unholy-custom-jsx-with-observable-strings/intro/"><label for="src/blog/unholy-custom-jsx-with-observable-strings/intro/3.async.deno.tsx"><div class="centerino">Async Observables
</div></label></div><pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><div class='code-scroller'><code><span class="line"><span style="color:#C678DD">import</span><span style="color:#ABB2BF"> { </span><span style="color:#E06C75">of</span><span style="color:#ABB2BF"> } </span><span style="color:#C678DD">from</span><span style="color:#ABB2BF"> </span><span style="color:#98C379">"rxjs"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">const</span><span style="color:#ABB2BF"> </span><span style="color:#E5C07B">children</span><span style="color:#ABB2BF"> </span><span style="color:#56B6C2">=</span><span style="color:#ABB2BF"> </span><span style="color:#61AFEF">of</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">"Hello World"</span><span style="color:#ABB2BF">, </span><span style="color:#98C379">"It was me, DIO"</span><span style="color:#ABB2BF">)</span></span>
<span class="line"><span style="color:#ABB2BF">;(&#x3C;</span><span style="color:#E06C75">div</span><span style="color:#ABB2BF">></span><span style="color:#C678DD">{</span><span style="color:#E06C75">children</span><span style="color:#C678DD">}</span><span style="color:#ABB2BF">&#x3C;/</span><span style="color:#E06C75">div</span><span style="color:#ABB2BF">>).</span><span style="color:#61AFEF">subscribe</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">console</span><span style="color:#ABB2BF">.</span><span style="color:#E06C75">log</span><span style="color:#ABB2BF">)</span></span>
<span class="line"></span><details class="console.log-details" open="1"><summary class="log-grid-heading">console.log[]</summary><code class="console.log-output"><span class="log-line">(1)</span><span class="log-line">&lt;div&gt;Hello World&lt;/div&gt;</span><span class="log-line">(2)</span><span class="log-line">&lt;div&gt;It was me, DIO&lt;/div&gt;</span></code></details></code></div><button class='copy-to-clipboard caption'>Copy</button></pre><pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><div class='code-scroller'><code><span class="line"><span style="color:#C678DD">import</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#ABB2BF">  </span><span style="color:#E06C75">defer</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#ABB2BF">  </span><span style="color:#E06C75">from</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#ABB2BF">  </span><span style="color:#E06C75">map</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#ABB2BF">  </span><span style="color:#E06C75">startWith</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#ABB2BF">  </span><span style="color:#E06C75">timeInterval</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#ABB2BF">} </span><span style="color:#C678DD">from</span><span style="color:#ABB2BF"> </span><span style="color:#98C379">"rxjs"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">type</span><span style="color:#ABB2BF"> </span><span style="color:#E5C07B">User</span><span style="color:#ABB2BF"> </span><span style="color:#56B6C2">=</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#ABB2BF">  </span><span style="color:#E06C75">id</span><span style="color:#ABB2BF">: </span><span style="color:#E5C07B">number</span></span>
<span class="line"><span style="color:#ABB2BF">  </span><span style="color:#E06C75">name</span><span style="color:#ABB2BF">: </span><span style="color:#E5C07B">string</span></span>
<span class="line"><span style="color:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">const</span><span style="color:#ABB2BF"> </span><span style="color:#61AFEF">fakeUserApiCall</span><span style="color:#ABB2BF"> </span><span style="color:#56B6C2">=</span><span style="color:#ABB2BF"> (): </span><span style="color:#E5C07B">Promise</span><span style="color:#ABB2BF">&#x3C;</span><span style="color:#E5C07B">User</span><span style="color:#ABB2BF">> </span><span style="color:#C678DD">=></span></span>
<span class="line"><span style="color:#ABB2BF">  </span><span style="color:#C678DD">new</span><span style="color:#ABB2BF"> </span><span style="color:#E5C07B">Promise</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75;font-style:italic">res</span><span style="color:#ABB2BF"> </span><span style="color:#C678DD">=></span></span>
<span class="line"><span style="color:#ABB2BF">    </span><span style="color:#61AFEF">setTimeout</span><span style="color:#ABB2BF">(</span></span>
<span class="line"><span style="color:#ABB2BF">      () </span><span style="color:#C678DD">=></span><span style="color:#ABB2BF"> </span><span style="color:#61AFEF">res</span><span style="color:#ABB2BF">({ </span><span style="color:#E06C75">id</span><span style="color:#ABB2BF">: </span><span style="color:#D19A66">0</span><span style="color:#ABB2BF">, </span><span style="color:#E06C75">name</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"ZA WARUDO"</span><span style="color:#ABB2BF"> }),</span></span>
<span class="line"><span style="color:#ABB2BF">      </span><span style="color:#D19A66">100</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#ABB2BF">    ),</span></span>
<span class="line"><span style="color:#ABB2BF">  )</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">const</span><span style="color:#ABB2BF"> </span><span style="color:#61AFEF">Subscription</span><span style="color:#ABB2BF"> </span><span style="color:#56B6C2">=</span><span style="color:#ABB2BF"> (</span></span>
<span class="line"><span style="color:#ABB2BF">  &#x3C;</span><span style="color:#E06C75">div</span><span style="color:#ABB2BF">></span></span>
<span class="line"><span style="color:#ABB2BF">    Hello</span><span style="color:#E06C75">&#x26;nbsp;</span></span>
<span class="line"><span style="color:#ABB2BF">    </span><span style="color:#C678DD">{</span><span style="color:#61AFEF">defer</span><span style="color:#ABB2BF">(() </span><span style="color:#C678DD">=></span><span style="color:#ABB2BF"> </span><span style="color:#61AFEF">from</span><span style="color:#ABB2BF">(</span><span style="color:#61AFEF">fakeUserApiCall</span><span style="color:#ABB2BF">())).</span><span style="color:#61AFEF">pipe</span><span style="color:#ABB2BF">(</span></span>
<span class="line"><span style="color:#ABB2BF">      </span><span style="color:#61AFEF">map</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75;font-style:italic">i</span><span style="color:#ABB2BF"> </span><span style="color:#C678DD">=></span><span style="color:#ABB2BF"> </span><span style="color:#E5C07B">i</span><span style="color:#ABB2BF">.</span><span style="color:#E06C75">name</span><span style="color:#ABB2BF">),</span></span>
<span class="line"><span style="color:#ABB2BF">      </span><span style="color:#61AFEF">startWith</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">"..."</span><span style="color:#ABB2BF">),</span></span>
<span class="line"><span style="color:#ABB2BF">    )</span><span style="color:#C678DD">}</span></span>
<span class="line"><span style="color:#ABB2BF">  &#x3C;/</span><span style="color:#E06C75">div</span><span style="color:#ABB2BF">></span></span>
<span class="line"><span style="color:#ABB2BF">)</span></span>
<span class="line"><span style="color:#ABB2BF">  .</span><span style="color:#61AFEF">pipe</span><span style="color:#ABB2BF">(</span><span style="color:#61AFEF">timeInterval</span><span style="color:#ABB2BF">())</span></span>
<span class="line"><span style="color:#ABB2BF">  .</span><span style="color:#61AFEF">subscribe</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">console</span><span style="color:#ABB2BF">.</span><span style="color:#E06C75">log</span><span style="color:#ABB2BF">)</span></span>
<span class="line"></span><details class="console.log-details" open="1"><summary class="log-grid-heading">console.log[]</summary><code class="console.log-output"><span class="log-line">(1)</span><span class="log-line">TimeInterval { value: &quot;&lt;div&gt;Hello ...&lt;/div&gt;&quot;, interval: 3 }</span><span class="log-line">(2)</span><span class="log-line">TimeInterval { value: &quot;&lt;div&gt;Hello ZA WARUDO&lt;/div&gt;&quot;, interval: 102 }</span></code></details></code></div><button class='copy-to-clipboard caption'>Copy</button></pre><pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><div class='code-scroller'><code><span class="line"><span style="color:#C678DD">export</span><span style="color:#ABB2BF"> </span><span style="color:#C678DD">default</span><span style="color:#ABB2BF"> (&#x3C;</span><span style="color:#E06C75">div</span><span style="color:#ABB2BF">>Hello World&#x3C;/</span><span style="color:#E06C75">div</span><span style="color:#ABB2BF">>).</span><span style="color:#61AFEF">subscribe</span><span style="color:#ABB2BF">(</span></span>
<span class="line"><span style="color:#ABB2BF">  </span><span style="color:#E5C07B">console</span><span style="color:#ABB2BF">.</span><span style="color:#E06C75">log</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#ABB2BF">)</span></span>
<span class="line"></span><details class="console.log-details" open="1"><summary class="log-grid-heading">console.log[]</summary><code class="console.log-output"><span class="log-line">(1)</span><span class="log-line">&lt;div&gt;Hello World&lt;/div&gt;</span></code></details></code></div><button class='copy-to-clipboard caption'>Copy</button></pre><pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><div class='code-scroller'><code><span class="line"><span style="color:#C678DD">import</span><span style="color:#ABB2BF"> { </span><span style="color:#E06C75">Observable</span><span style="color:#ABB2BF">, </span><span style="color:#E06C75">timeInterval</span><span style="color:#ABB2BF"> } </span><span style="color:#C678DD">from</span><span style="color:#ABB2BF"> </span><span style="color:#98C379">"rxjs"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">type</span><span style="color:#ABB2BF"> </span><span style="color:#E5C07B">User</span><span style="color:#ABB2BF"> </span><span style="color:#56B6C2">=</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#ABB2BF">  </span><span style="color:#E06C75">id</span><span style="color:#ABB2BF">: </span><span style="color:#E5C07B">number</span></span>
<span class="line"><span style="color:#ABB2BF">  </span><span style="color:#E06C75">name</span><span style="color:#ABB2BF">: </span><span style="color:#E5C07B">string</span></span>
<span class="line"><span style="color:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">const</span><span style="color:#ABB2BF"> </span><span style="color:#61AFEF">fakeUserApiCall</span><span style="color:#ABB2BF"> </span><span style="color:#56B6C2">=</span><span style="color:#ABB2BF"> (): </span><span style="color:#E5C07B">Promise</span><span style="color:#ABB2BF">&#x3C;</span><span style="color:#E5C07B">User</span><span style="color:#ABB2BF">> </span><span style="color:#C678DD">=></span></span>
<span class="line"><span style="color:#ABB2BF">  </span><span style="color:#C678DD">new</span><span style="color:#ABB2BF"> </span><span style="color:#E5C07B">Promise</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75;font-style:italic">res</span><span style="color:#ABB2BF"> </span><span style="color:#C678DD">=></span></span>
<span class="line"><span style="color:#ABB2BF">    </span><span style="color:#61AFEF">setTimeout</span><span style="color:#ABB2BF">(</span></span>
<span class="line"><span style="color:#ABB2BF">      () </span><span style="color:#C678DD">=></span><span style="color:#ABB2BF"> </span><span style="color:#61AFEF">res</span><span style="color:#ABB2BF">({ </span><span style="color:#E06C75">id</span><span style="color:#ABB2BF">: </span><span style="color:#D19A66">0</span><span style="color:#ABB2BF">, </span><span style="color:#E06C75">name</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"ZA WARUDO"</span><span style="color:#ABB2BF"> }),</span></span>
<span class="line"><span style="color:#ABB2BF">      </span><span style="color:#D19A66">100</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#ABB2BF">    ),</span></span>
<span class="line"><span style="color:#ABB2BF">  )</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">const</span><span style="color:#ABB2BF"> </span><span style="color:#61AFEF">Subscription</span><span style="color:#ABB2BF"> </span><span style="color:#56B6C2">=</span><span style="color:#ABB2BF"> (</span></span>
<span class="line"><span style="color:#ABB2BF">  &#x3C;</span><span style="color:#E06C75">div</span><span style="color:#ABB2BF">></span></span>
<span class="line"><span style="color:#ABB2BF">    Hello</span><span style="color:#E06C75">&#x26;nbsp;</span></span>
<span class="line"><span style="color:#ABB2BF">    </span><span style="color:#C678DD">{</span></span>
<span class="line"><span style="color:#ABB2BF">      </span><span style="color:#C678DD">new</span><span style="color:#ABB2BF"> </span><span style="color:#61AFEF">Observable</span><span style="color:#ABB2BF">&#x3C;</span><span style="color:#E5C07B">string</span><span style="color:#ABB2BF">>(</span><span style="color:#E06C75;font-style:italic">sub</span><span style="color:#ABB2BF"> </span><span style="color:#C678DD">=></span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#ABB2BF">        </span><span style="color:#E5C07B">sub</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">next</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">"..."</span><span style="color:#ABB2BF">)</span></span>
<span class="line"><span style="color:#ABB2BF">        </span><span style="color:#61AFEF">fakeUserApiCall</span><span style="color:#ABB2BF">().</span><span style="color:#61AFEF">then</span><span style="color:#ABB2BF">(</span></span>
<span class="line"><span style="color:#ABB2BF">          </span><span style="color:#E06C75;font-style:italic">i</span><span style="color:#ABB2BF"> </span><span style="color:#C678DD">=></span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#ABB2BF">            </span><span style="color:#E5C07B">sub</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">next</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">i</span><span style="color:#ABB2BF">.</span><span style="color:#E06C75">name</span><span style="color:#ABB2BF">)</span></span>
<span class="line"><span style="color:#ABB2BF">            </span><span style="color:#E5C07B">sub</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">complete</span><span style="color:#ABB2BF">()</span></span>
<span class="line"><span style="color:#ABB2BF">          },</span></span>
<span class="line"><span style="color:#ABB2BF">          </span><span style="color:#E06C75;font-style:italic">err</span><span style="color:#ABB2BF"> </span><span style="color:#C678DD">=></span><span style="color:#ABB2BF"> </span><span style="color:#E5C07B">sub</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">error</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75">err</span><span style="color:#ABB2BF">),</span></span>
<span class="line"><span style="color:#ABB2BF">        )</span></span>
<span class="line"><span style="color:#ABB2BF">        </span><span style="color:#C678DD">return</span><span style="color:#ABB2BF"> () </span><span style="color:#C678DD">=></span><span style="color:#ABB2BF"> {}</span></span>
<span class="line"><span style="color:#ABB2BF">      })</span></span>
<span class="line"><span style="color:#ABB2BF">    </span><span style="color:#C678DD">}</span></span>
<span class="line"><span style="color:#ABB2BF">  &#x3C;/</span><span style="color:#E06C75">div</span><span style="color:#ABB2BF">></span></span>
<span class="line"><span style="color:#ABB2BF">)</span></span>
<span class="line"><span style="color:#ABB2BF">  .</span><span style="color:#61AFEF">pipe</span><span style="color:#ABB2BF">(</span><span style="color:#61AFEF">timeInterval</span><span style="color:#ABB2BF">())</span></span>
<span class="line"><span style="color:#ABB2BF">  .</span><span style="color:#61AFEF">subscribe</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">console</span><span style="color:#ABB2BF">.</span><span style="color:#E06C75">log</span><span style="color:#ABB2BF">)</span></span>
<span class="line"></span><details class="console.log-details" open="1"><summary class="log-grid-heading">console.log[]</summary><code class="console.log-output"><span class="log-line">(1)</span><span class="log-line">TimeInterval { value: &quot;&lt;div&gt;Hello ...&lt;/div&gt;&quot;, interval: 4 }</span><span class="log-line">(2)</span><span class="log-line">TimeInterval { value: &quot;&lt;div&gt;Hello ZA WARUDO&lt;/div&gt;&quot;, interval: 102 }</span></code></details></code></div><button class='copy-to-clipboard caption'>Copy</button></pre>
<style>
  #src\/blog\/unholy-custom-jsx-with-observable-strings\/intro\/{
    
  &:has(#src\/blog\/unholy-custom-jsx-with-observable-strings\/intro\/1\.sync\.deno\.tsx:checked) { 
    & pre:nth-child(2){
      & + .console\.log-details {
        display: block;
      }
      display: block;
    }
    pre:nth-child(2)
  }
  

  &:has(#src\/blog\/unholy-custom-jsx-with-observable-strings\/intro\/4\.async\.rxjs\.deno\.tsx:checked) { 
    & pre:nth-child(3){
      & + .console\.log-details {
        display: block;
      }
      display: block;
    }
    pre:nth-child(3)
  }
  

  &:has(#src\/blog\/unholy-custom-jsx-with-observable-strings\/intro\/2\.basic\.deno\.tsx:checked) { 
    & pre:nth-child(4){
      & + .console\.log-details {
        display: block;
      }
      display: block;
    }
    pre:nth-child(4)
  }
  

  &:has(#src\/blog\/unholy-custom-jsx-with-observable-strings\/intro\/3\.async\.deno\.tsx:checked) { 
    & pre:nth-child(5){
      & + .console\.log-details {
        display: block;
      }
      display: block;
    }
    pre:nth-child(5)
  }
  
  }
</style>
<div class="code-group-demo-area"></div></div><style>
#section-basic-demos {
  --section-header-hr-start: 21.428571428571427%;
  --section-header-hr-stop: 28.57142857142857%;
}
</style><div class="flair-section"></div></section>
<section id="section-jsx-element-type"><h2 id="jsx-element-type"><a href="#jsx-element-type"><span class="marker">2.</span>  JSX.Element Type<div class="flair-a"></div></a><div class="flair-h"></div></h2><p>In this jsx transform, thie children types are</p><pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><div class="code-scroller"><code class="language-ts"><span class="line"><span style="color:#C678DD">export</span><span style="color:#C678DD"> namespace</span><span style="color:#E5C07B"> JSX</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD">  type</span><span style="color:#E5C07B"> Element</span><span style="color:#56B6C2"> =</span><span style="color:#E5C07B"> Observable</span><span style="color:#ABB2BF">&#x3C;</span><span style="color:#E5C07B">string</span><span style="color:#ABB2BF">></span></span>
<span class="line"><span style="color:#ABB2BF">}</span></span></code></div><button class="copy-to-clipboard caption">Copy</button></pre><p>That means every <strong>JSX Expression</strong> is:</p><ol>
<li>pipe-able
<ul>
<li>You can throttle/debounce re-renders intuitively</li>
<li>The end result of your intense chains/compositions of rxjs can be the output for jsx</li>
<li>Align them to any scheduler</li>
<li>Memo-ize freely with <code>distinct</code> operators</li>
</ul>
</li>
<li>subscribe-able
<ul>
<li>You can do whatever you want with the html string produced by the jsx</li>
<li>In the following demo's, I simply subscribe and assign to the iframe's body.innerHTML</li>
</ul>
</li>
</ol><style>
#section-jsx-element-type {
  --section-header-hr-start: 28.571428571428573%;
  --section-header-hr-stop: 35.714285714285715%;
}
</style><div class="flair-section"></div></section>
<section id="section-components"><h2 id="components"><a href="#components"><span class="marker">3.</span>  Components<div class="flair-a"></div></a><div class="flair-h"></div></h2><p>In this style, a component is any function that returns an observable.</p><p>This also means that we dont call functions more than once!
This framework is like solid.js and vue hooks, where we are declaring everything once, then re-evaluating when necessary by means of RxJS and Observables.</p><p>Here is a basic, re-usable component comparison:</p><p>:::codes</p><pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><div class="code-scroller"><code class="language-tsx"><span class="line"><span style="color:#7F848E;font-style:italic">// @@filename RxJSX</span></span>
<span class="line"><span style="color:#C678DD">export</span><span style="color:#C678DD"> const</span><span style="color:#61AFEF"> Component</span><span style="color:#56B6C2"> =</span><span style="color:#ABB2BF"> () </span><span style="color:#C678DD">=></span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD">  return</span><span style="color:#ABB2BF"> &#x3C;</span><span style="color:#E06C75">div</span><span style="color:#ABB2BF">>Hello World&#x3C;/</span><span style="color:#E06C75">div</span><span style="color:#ABB2BF">></span></span>
<span class="line"><span style="color:#ABB2BF">}</span></span></code></div><button class="copy-to-clipboard caption">Copy</button></pre><pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><div class="code-scroller"><code class="language-tsx"><span class="line"><span style="color:#7F848E;font-style:italic">// @@filename React</span></span>
<span class="line"><span style="color:#C678DD">export</span><span style="color:#C678DD"> const</span><span style="color:#61AFEF"> Component</span><span style="color:#56B6C2"> =</span><span style="color:#ABB2BF"> () </span><span style="color:#C678DD">=></span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD">  return</span><span style="color:#ABB2BF"> &#x3C;</span><span style="color:#E06C75">div</span><span style="color:#ABB2BF">>Hello World&#x3C;/</span><span style="color:#E06C75">div</span><span style="color:#ABB2BF">></span></span>
<span class="line"><span style="color:#ABB2BF">}</span></span></code></div><button class="copy-to-clipboard caption">Copy</button></pre><p>:::</p><style>
#section-components {
  --section-header-hr-start: 35.71428571428571%;
  --section-header-hr-stop: 42.857142857142854%;
}
</style><div class="flair-section"></div></section>
<section id="section-add-static-props-and-styling"><h3 id="add-static-props-and-styling"><a href="#add-static-props-and-styling"><span class="marker">3.1.</span>  Add static props and styling<div class="flair-a"></div></a><div class="flair-h"></div></h3><p>Now we can leverage props for dynamic styling</p><p>:::codes</p><pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><div class="code-scroller"><code class="language-tsx"><span class="line"><span style="color:#7F848E;font-style:italic">// @@filename RxJSX</span></span>
<span class="line"><span style="color:#C678DD">type</span><span style="color:#E5C07B"> Props</span><span style="color:#56B6C2"> =</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E06C75">  isRed</span><span style="color:#C678DD">?</span><span style="color:#ABB2BF">: </span><span style="color:#E5C07B">boolean</span></span>
<span class="line"><span style="color:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">export</span><span style="color:#C678DD"> const</span><span style="color:#61AFEF"> Component</span><span style="color:#56B6C2"> =</span><span style="color:#ABB2BF"> (</span><span style="color:#E06C75;font-style:italic">props</span><span style="color:#ABB2BF">: </span><span style="color:#E5C07B">Props</span><span style="color:#ABB2BF">) </span><span style="color:#C678DD">=></span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD">  return</span><span style="color:#ABB2BF"> &#x3C;</span><span style="color:#E06C75">div</span><span style="color:#D19A66;font-style:italic"> style</span><span style="color:#56B6C2">=</span><span style="color:#C678DD">{</span><span style="color:#ABB2BF">{</span></span>
<span class="line"><span style="color:#E06C75">    background</span><span style="color:#ABB2BF">: </span><span style="color:#E5C07B">props</span><span style="color:#ABB2BF">.</span><span style="color:#E06C75">isRed</span><span style="color:#C678DD"> ?</span><span style="color:#98C379"> 'red'</span><span style="color:#C678DD"> :</span><span style="color:#D19A66"> undefined</span></span>
<span class="line"><span style="color:#ABB2BF">  }</span><span style="color:#C678DD">}</span><span style="color:#ABB2BF">></span></span>
<span class="line"><span style="color:#ABB2BF">    Hello World</span></span>
<span class="line"><span style="color:#ABB2BF">  &#x3C;/</span><span style="color:#E06C75">div</span><span style="color:#ABB2BF">></span></span>
<span class="line"><span style="color:#ABB2BF">}</span></span></code></div><button class="copy-to-clipboard caption">Copy</button></pre><pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><div class="code-scroller"><code class="language-tsx"><span class="line"><span style="color:#7F848E;font-style:italic">// @@filename React</span></span>
<span class="line"><span style="color:#C678DD">type</span><span style="color:#E5C07B"> Props</span><span style="color:#56B6C2"> =</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E06C75">  isRed</span><span style="color:#C678DD">?</span><span style="color:#ABB2BF">: </span><span style="color:#E5C07B">boolean</span></span>
<span class="line"><span style="color:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">export</span><span style="color:#C678DD"> const</span><span style="color:#61AFEF"> Component</span><span style="color:#56B6C2"> =</span><span style="color:#ABB2BF"> (</span><span style="color:#E06C75;font-style:italic">props</span><span style="color:#ABB2BF">: </span><span style="color:#E5C07B">Props</span><span style="color:#ABB2BF">) </span><span style="color:#C678DD">=></span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD">  return</span><span style="color:#ABB2BF"> &#x3C;</span><span style="color:#E06C75">div</span><span style="color:#D19A66;font-style:italic"> style</span><span style="color:#56B6C2">=</span><span style="color:#C678DD">{</span><span style="color:#ABB2BF">{</span></span>
<span class="line"><span style="color:#E06C75">    background</span><span style="color:#ABB2BF">: </span><span style="color:#E5C07B">props</span><span style="color:#ABB2BF">.</span><span style="color:#E06C75">isRed</span><span style="color:#C678DD"> ?</span><span style="color:#98C379"> 'red'</span><span style="color:#C678DD"> :</span><span style="color:#D19A66"> undefined</span></span>
<span class="line"><span style="color:#ABB2BF">  }</span><span style="color:#C678DD">}</span><span style="color:#ABB2BF">></span></span>
<span class="line"><span style="color:#ABB2BF">    Hello World</span></span>
<span class="line"><span style="color:#ABB2BF">  &#x3C;/</span><span style="color:#E06C75">div</span><span style="color:#ABB2BF">></span></span>
<span class="line"><span style="color:#ABB2BF">}</span></span></code></div><button class="copy-to-clipboard caption">Copy</button></pre><p>:::</p><p>However there is 1 problem, our RxJSX props never get redefined. If we want to react to changes in isRed, we must change a few things:</p><ol>
<li>We can pass isRed as isRed$
<ul>
<li><code>$</code> at the end of a variable is RxJS <strong>convention</strong> for indicating an observable value.</li>
<li>You dont have to do this if you are in typescript, but it can save a headache or two from time to time.</li>
</ul>
</li>
<li>This is not unlike <code>Signal</code>s in Solid.js and in general, there is no auto-reacting.</li>
</ol><p>:::codes</p><pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><div class="code-scroller"><code class="language-tsx"><span class="line"><span style="color:#7F848E;font-style:italic">// @@filename RxJSX</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">// @@eval</span></span>
<span class="line"><span style="color:#C678DD">import</span><span style="color:#ABB2BF"> { </span><span style="color:#E06C75">map</span><span style="color:#ABB2BF"> } </span><span style="color:#C678DD">from</span><span style="color:#98C379"> 'rxjs'</span><span style="color:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">type</span><span style="color:#E5C07B"> Props</span><span style="color:#56B6C2"> =</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E06C75">  isRed$</span><span style="color:#C678DD">?</span><span style="color:#ABB2BF">: </span><span style="color:#E5C07B">boolean</span></span>
<span class="line"><span style="color:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">export</span><span style="color:#C678DD"> const</span><span style="color:#61AFEF"> Component</span><span style="color:#56B6C2"> =</span><span style="color:#ABB2BF"> (</span><span style="color:#E06C75;font-style:italic">props</span><span style="color:#ABB2BF">: </span><span style="color:#E5C07B">Props</span><span style="color:#ABB2BF">) </span><span style="color:#C678DD">=></span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD">  return</span><span style="color:#ABB2BF"> &#x3C;</span><span style="color:#E06C75">div</span><span style="color:#D19A66;font-style:italic"> style</span><span style="color:#56B6C2">=</span><span style="color:#C678DD">{</span><span style="color:#ABB2BF">{</span></span>
<span class="line"><span style="color:#E06C75">    background</span><span style="color:#ABB2BF">: </span><span style="color:#E5C07B">props</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">isRed$</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">pipe</span><span style="color:#ABB2BF">(</span></span>
<span class="line"><span style="color:#61AFEF">      map</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75;font-style:italic">isRed</span><span style="color:#C678DD"> =></span><span style="color:#E06C75"> isRed</span><span style="color:#C678DD"> ?</span><span style="color:#98C379"> 'red'</span><span style="color:#C678DD"> :</span><span style="color:#D19A66"> undefined</span><span style="color:#ABB2BF">)</span></span>
<span class="line"><span style="color:#ABB2BF">    )</span></span>
<span class="line"><span style="color:#ABB2BF">  }</span><span style="color:#C678DD">}</span><span style="color:#ABB2BF">></span></span>
<span class="line"><span style="color:#ABB2BF">    Hello World</span></span>
<span class="line"><span style="color:#ABB2BF">  &#x3C;/</span><span style="color:#E06C75">div</span><span style="color:#ABB2BF">></span></span>
<span class="line"><span style="color:#ABB2BF">}</span></span></code></div><button class="copy-to-clipboard caption">Copy</button></pre><pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><div class="code-scroller"><code class="language-tsx"><span class="line"><span style="color:#7F848E;font-style:italic">// @@filename React</span></span>
<span class="line"><span style="color:#C678DD">type</span><span style="color:#E5C07B"> Props</span><span style="color:#56B6C2"> =</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E06C75">  isRed</span><span style="color:#C678DD">?</span><span style="color:#ABB2BF">: </span><span style="color:#E5C07B">boolean</span></span>
<span class="line"><span style="color:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">export</span><span style="color:#C678DD"> const</span><span style="color:#61AFEF"> Component</span><span style="color:#56B6C2"> =</span><span style="color:#ABB2BF"> (</span><span style="color:#E06C75;font-style:italic">props</span><span style="color:#ABB2BF">: </span><span style="color:#E5C07B">Props</span><span style="color:#ABB2BF">) </span><span style="color:#C678DD">=></span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD">  return</span><span style="color:#ABB2BF"> &#x3C;</span><span style="color:#E06C75">div</span><span style="color:#D19A66;font-style:italic"> style</span><span style="color:#56B6C2">=</span><span style="color:#C678DD">{</span><span style="color:#ABB2BF">{</span></span>
<span class="line"><span style="color:#E06C75">    background</span><span style="color:#ABB2BF">: </span><span style="color:#E5C07B">props</span><span style="color:#ABB2BF">.</span><span style="color:#E06C75">isRed</span><span style="color:#C678DD"> ?</span><span style="color:#98C379"> 'red'</span><span style="color:#C678DD"> :</span><span style="color:#D19A66"> undefined</span></span>
<span class="line"><span style="color:#ABB2BF">  }</span><span style="color:#C678DD">}</span><span style="color:#ABB2BF">></span></span>
<span class="line"><span style="color:#ABB2BF">    Hello World</span></span>
<span class="line"><span style="color:#ABB2BF">  &#x3C;/</span><span style="color:#E06C75">div</span><span style="color:#ABB2BF">></span></span>
<span class="line"><span style="color:#ABB2BF">}</span></span></code></div><button class="copy-to-clipboard caption">Copy</button></pre><p>:::</p><style>
#section-add-static-props-and-styling {
  --section-header-hr-start: 42.857142857142854%;
  --section-header-hr-stop: 50%;
}
</style><div class="flair-section"></div></section>
<section id="section-props"><h2 id="props"><a href="#props"><span class="marker">4.</span>  Props<div class="flair-a"></div></a><div class="flair-h"></div></h2><style>
#section-props {
  --section-header-hr-start: 49.99999999999999%;
  --section-header-hr-stop: 57.14285714285714%;
}
</style><div class="flair-section"></div></section>
<section id="section-counter-demo"><h2 id="counter-demo"><a href="#counter-demo"><span class="marker">5.</span>  Counter Demo<div class="flair-a"></div></a><div class="flair-h"></div></h2><p>Here are some demo's of this technique <strong>without DOM events and state</strong>. This is what we can achieve with just a few functions from rxjs itself.</p><p>If you don't know rxjs, dont panic, just know that <code>interval</code> is like <code>setTimeout</code> + <code>setState</code>.</p><ol>
<li>You give it the interval in milliseconds as first arg</li>
<li>It will count, <strong>starting from zero</strong>, forever</li>
<li>It's also <strong>lazy</strong> like <code>setInterval</code>, it will not emit a value right away
<ul>
<li>This is why you see <code>.pipe(startWith(0))</code></li>
<li>Imagine this is the first arg to useState, so we already have a value on initial render.</li>
</ul>
</li>
<li>It feels backwards for some things, but that is a virtue in RxJS style of composition.</li>
</ol><div class="code-group" id="src/blog/unholy-custom-jsx-with-observable-strings/counter/"><div id="code-group-src/blog/unholy-custom-jsx-with-observable-strings" class="code-group-tabs" data-sticky="1"><input type="radio" value="7.react.ellapsed.dom.tsx" id="src/blog/unholy-custom-jsx-with-observable-strings/counter/7.react.ellapsed.dom.tsx" name="src/blog/unholy-custom-jsx-with-observable-strings/counter/" class="code-tabs-radio-input" data-scroll-to-me="src/blog/unholy-custom-jsx-with-observable-strings/counter/" checked="true"><label for="src/blog/unholy-custom-jsx-with-observable-strings/counter/7.react.ellapsed.dom.tsx"><div class="centerino">7.react.ellapsed.dom.tsx</div></label><input type="radio" value="5_interval.dom.tsx" id="src/blog/unholy-custom-jsx-with-observable-strings/counter/5_interval.dom.tsx" name="src/blog/unholy-custom-jsx-with-observable-strings/counter/" class="code-tabs-radio-input" data-scroll-to-me="src/blog/unholy-custom-jsx-with-observable-strings/counter/"><label for="src/blog/unholy-custom-jsx-with-observable-strings/counter/5_interval.dom.tsx"><div class="centerino">5_interval.dom.tsx</div></label><input type="radio" value="6_interval.dom.tsx" id="src/blog/unholy-custom-jsx-with-observable-strings/counter/6_interval.dom.tsx" name="src/blog/unholy-custom-jsx-with-observable-strings/counter/" class="code-tabs-radio-input" data-scroll-to-me="src/blog/unholy-custom-jsx-with-observable-strings/counter/"><label for="src/blog/unholy-custom-jsx-with-observable-strings/counter/6_interval.dom.tsx"><div class="centerino">6_interval.dom.tsx</div></label><input type="radio" value="7.react.dom.tsx" id="src/blog/unholy-custom-jsx-with-observable-strings/counter/7.react.dom.tsx" name="src/blog/unholy-custom-jsx-with-observable-strings/counter/" class="code-tabs-radio-input" data-scroll-to-me="src/blog/unholy-custom-jsx-with-observable-strings/counter/"><label for="src/blog/unholy-custom-jsx-with-observable-strings/counter/7.react.dom.tsx"><div class="centerino">7.react.dom.tsx</div></label></div><pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><div class='code-scroller'><code><span class="line"><span style="color:#7F848E;font-style:italic">/** </span><span style="color:#C678DD;font-style:italic">@jsxImportSource</span><span style="color:#7F848E;font-style:italic"> react */</span></span>
<span class="line"><span style="color:#C678DD">import</span><span style="color:#ABB2BF"> </span><span style="color:#E06C75">React</span><span style="color:#ABB2BF">, { </span><span style="color:#E06C75">useState</span><span style="color:#ABB2BF"> } </span><span style="color:#C678DD">from</span><span style="color:#ABB2BF"> </span><span style="color:#98C379">"react"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">const</span><span style="color:#ABB2BF"> </span><span style="color:#61AFEF">Elapsed</span><span style="color:#ABB2BF"> </span><span style="color:#56B6C2">=</span><span style="color:#ABB2BF"> () </span><span style="color:#C678DD">=></span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#ABB2BF">  </span><span style="color:#C678DD">const</span><span style="color:#ABB2BF"> [</span><span style="color:#E5C07B">state</span><span style="color:#ABB2BF">, </span><span style="color:#E5C07B">setState</span><span style="color:#ABB2BF">] </span><span style="color:#56B6C2">=</span><span style="color:#ABB2BF"> </span><span style="color:#61AFEF">useState</span><span style="color:#ABB2BF">(</span><span style="color:#D19A66">0</span><span style="color:#ABB2BF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF">  </span><span style="color:#E5C07B">React</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">useEffect</span><span style="color:#ABB2BF">(() </span><span style="color:#C678DD">=></span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#ABB2BF">    </span><span style="color:#C678DD">let</span><span style="color:#ABB2BF"> </span><span style="color:#E06C75">start</span><span style="color:#ABB2BF"> </span><span style="color:#56B6C2">=</span><span style="color:#ABB2BF"> </span><span style="color:#56B6C2">+</span><span style="color:#C678DD">new</span><span style="color:#ABB2BF"> </span><span style="color:#61AFEF">Date</span><span style="color:#ABB2BF">()</span></span>
<span class="line"><span style="color:#ABB2BF">    </span><span style="color:#C678DD">const</span><span style="color:#ABB2BF"> </span><span style="color:#E5C07B">id</span><span style="color:#ABB2BF"> </span><span style="color:#56B6C2">=</span><span style="color:#ABB2BF"> </span><span style="color:#61AFEF">setInterval</span><span style="color:#ABB2BF">(() </span><span style="color:#C678DD">=></span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#ABB2BF">      </span><span style="color:#61AFEF">setState</span><span style="color:#ABB2BF">(() </span><span style="color:#C678DD">=></span><span style="color:#ABB2BF"> </span><span style="color:#56B6C2">+</span><span style="color:#C678DD">new</span><span style="color:#ABB2BF"> </span><span style="color:#61AFEF">Date</span><span style="color:#ABB2BF">() </span><span style="color:#56B6C2">-</span><span style="color:#ABB2BF"> </span><span style="color:#E06C75">start</span><span style="color:#ABB2BF">)</span></span>
<span class="line"><span style="color:#ABB2BF">    }, </span><span style="color:#D19A66">60</span><span style="color:#ABB2BF">)</span></span>
<span class="line"><span style="color:#ABB2BF">    </span><span style="color:#C678DD">return</span><span style="color:#ABB2BF"> () </span><span style="color:#C678DD">=></span><span style="color:#ABB2BF"> </span><span style="color:#61AFEF">clearInterval</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75">id</span><span style="color:#ABB2BF">)</span></span>
<span class="line"><span style="color:#ABB2BF">  }, [])</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF">  </span><span style="color:#C678DD">return</span><span style="color:#ABB2BF"> (</span></span>
<span class="line"><span style="color:#ABB2BF">    &#x3C;</span><span style="color:#E06C75">div</span><span style="color:#ABB2BF"> </span><span style="color:#D19A66;font-style:italic">style</span><span style="color:#56B6C2">=</span><span style="color:#C678DD">{</span><span style="color:#ABB2BF">{ </span><span style="color:#E06C75">background</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"blue"</span><span style="color:#ABB2BF">, </span><span style="color:#E06C75">color</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"white"</span><span style="color:#ABB2BF"> }</span><span style="color:#C678DD">}</span><span style="color:#ABB2BF">></span></span>
<span class="line"><span style="color:#ABB2BF">      </span><span style="color:#C678DD">{</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75">state</span><span style="color:#ABB2BF"> </span><span style="color:#56B6C2">/</span><span style="color:#ABB2BF"> </span><span style="color:#D19A66">1000</span><span style="color:#ABB2BF">).</span><span style="color:#61AFEF">toFixed</span><span style="color:#ABB2BF">(</span><span style="color:#D19A66">2</span><span style="color:#ABB2BF">)</span><span style="color:#C678DD">}</span><span style="color:#E06C75">&#x26;nbsp;</span><span style="color:#ABB2BF">seconds since</span></span>
<span class="line"><span style="color:#ABB2BF">      mount/subscribe</span></span>
<span class="line"><span style="color:#ABB2BF">    &#x3C;/</span><span style="color:#E06C75">div</span><span style="color:#ABB2BF">></span></span>
<span class="line"><span style="color:#ABB2BF">  )</span></span>
<span class="line"><span style="color:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">export</span><span style="color:#ABB2BF"> </span><span style="color:#C678DD">default</span><span style="color:#ABB2BF"> () </span><span style="color:#C678DD">=></span><span style="color:#ABB2BF"> &#x3C;</span><span style="color:#E5C07B">Elapsed</span><span style="color:#ABB2BF"> /></span></span>
<span class="line"></span></code></div><button class='copy-to-clipboard caption'>Copy</button></pre><pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><div class='code-scroller'><code><span class="line"><span style="color:#C678DD">import</span><span style="color:#ABB2BF"> { </span><span style="color:#E06C75">interval</span><span style="color:#ABB2BF">, </span><span style="color:#E06C75">map</span><span style="color:#ABB2BF">, </span><span style="color:#E06C75">startWith</span><span style="color:#ABB2BF"> } </span><span style="color:#C678DD">from</span><span style="color:#ABB2BF"> </span><span style="color:#98C379">"rxjs"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">export</span><span style="color:#ABB2BF"> </span><span style="color:#C678DD">default</span><span style="color:#ABB2BF"> () </span><span style="color:#C678DD">=></span><span style="color:#ABB2BF"> (</span></span>
<span class="line"><span style="color:#ABB2BF">  &#x3C;</span><span style="color:#E06C75">div</span><span style="color:#ABB2BF"> </span><span style="color:#D19A66;font-style:italic">style</span><span style="color:#56B6C2">=</span><span style="color:#C678DD">{</span><span style="color:#ABB2BF">{ </span><span style="color:#E06C75">background</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"red"</span><span style="color:#ABB2BF">, </span><span style="color:#E06C75">color</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"white"</span><span style="color:#ABB2BF"> }</span><span style="color:#C678DD">}</span><span style="color:#ABB2BF">></span></span>
<span class="line"><span style="color:#ABB2BF">    </span><span style="color:#C678DD">{</span><span style="color:#61AFEF">interval</span><span style="color:#ABB2BF">(</span><span style="color:#D19A66">1000</span><span style="color:#ABB2BF">).</span><span style="color:#61AFEF">pipe</span><span style="color:#ABB2BF">(</span></span>
<span class="line"><span style="color:#ABB2BF">      </span><span style="color:#61AFEF">map</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75;font-style:italic">i</span><span style="color:#ABB2BF"> </span><span style="color:#C678DD">=></span><span style="color:#ABB2BF"> </span><span style="color:#E06C75">i</span><span style="color:#ABB2BF"> </span><span style="color:#56B6C2">+</span><span style="color:#ABB2BF"> </span><span style="color:#D19A66">1</span><span style="color:#ABB2BF">),</span></span>
<span class="line"><span style="color:#ABB2BF">      </span><span style="color:#61AFEF">startWith</span><span style="color:#ABB2BF">(</span><span style="color:#D19A66">0</span><span style="color:#ABB2BF">),</span></span>
<span class="line"><span style="color:#ABB2BF">    )</span><span style="color:#C678DD">}</span></span>
<span class="line"><span style="color:#ABB2BF">    </span><span style="color:#E06C75">&#x26;nbsp;</span><span style="color:#ABB2BF">seconds since mount/subscribe</span></span>
<span class="line"><span style="color:#ABB2BF">  &#x3C;/</span><span style="color:#E06C75">div</span><span style="color:#ABB2BF">></span></span>
<span class="line"><span style="color:#ABB2BF">)</span></span>
<span class="line"></span></code></div><button class='copy-to-clipboard caption'>Copy</button></pre><pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><div class='code-scroller'><code><span class="line"><span style="color:#C678DD">import</span><span style="color:#ABB2BF"> { </span><span style="color:#E06C75">interval</span><span style="color:#ABB2BF">, </span><span style="color:#E06C75">map</span><span style="color:#ABB2BF"> } </span><span style="color:#C678DD">from</span><span style="color:#ABB2BF"> </span><span style="color:#98C379">"rxjs"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">export</span><span style="color:#ABB2BF"> </span><span style="color:#C678DD">const</span><span style="color:#ABB2BF"> </span><span style="color:#61AFEF">Ellapsed</span><span style="color:#ABB2BF"> </span><span style="color:#56B6C2">=</span><span style="color:#ABB2BF"> () </span><span style="color:#C678DD">=></span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#ABB2BF">  </span><span style="color:#C678DD">const</span><span style="color:#ABB2BF"> </span><span style="color:#E5C07B">start</span><span style="color:#ABB2BF"> </span><span style="color:#56B6C2">=</span><span style="color:#ABB2BF"> </span><span style="color:#56B6C2">+</span><span style="color:#C678DD">new</span><span style="color:#ABB2BF"> </span><span style="color:#61AFEF">Date</span><span style="color:#ABB2BF">()</span></span>
<span class="line"><span style="color:#ABB2BF">  </span><span style="color:#C678DD">return</span><span style="color:#ABB2BF"> (</span></span>
<span class="line"><span style="color:#ABB2BF">    &#x3C;</span><span style="color:#E06C75">div</span><span style="color:#ABB2BF"> </span><span style="color:#D19A66;font-style:italic">style</span><span style="color:#56B6C2">=</span><span style="color:#C678DD">{</span><span style="color:#ABB2BF">{ </span><span style="color:#E06C75">background</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"blue"</span><span style="color:#ABB2BF">, </span><span style="color:#E06C75">color</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"white"</span><span style="color:#ABB2BF"> }</span><span style="color:#C678DD">}</span><span style="color:#ABB2BF">></span></span>
<span class="line"><span style="color:#ABB2BF">      </span><span style="color:#C678DD">{</span><span style="color:#61AFEF">interval</span><span style="color:#ABB2BF">(</span><span style="color:#D19A66">60</span><span style="color:#ABB2BF">).</span><span style="color:#61AFEF">pipe</span><span style="color:#ABB2BF">(</span></span>
<span class="line"><span style="color:#ABB2BF">        </span><span style="color:#61AFEF">map</span><span style="color:#ABB2BF">(() </span><span style="color:#C678DD">=></span></span>
<span class="line"><span style="color:#ABB2BF">          ((</span><span style="color:#56B6C2">+</span><span style="color:#C678DD">new</span><span style="color:#ABB2BF"> </span><span style="color:#61AFEF">Date</span><span style="color:#ABB2BF">() </span><span style="color:#56B6C2">-</span><span style="color:#ABB2BF"> </span><span style="color:#E06C75">start</span><span style="color:#ABB2BF">) </span><span style="color:#56B6C2">/</span><span style="color:#ABB2BF"> </span><span style="color:#D19A66">1000</span><span style="color:#ABB2BF">).</span><span style="color:#61AFEF">toFixed</span><span style="color:#ABB2BF">(</span><span style="color:#D19A66">2</span><span style="color:#ABB2BF">),</span></span>
<span class="line"><span style="color:#ABB2BF">        ),</span></span>
<span class="line"><span style="color:#ABB2BF">      )</span><span style="color:#C678DD">}</span></span>
<span class="line"><span style="color:#ABB2BF">      </span><span style="color:#E06C75">&#x26;nbsp;</span><span style="color:#ABB2BF">seconds since mount/subscribe</span></span>
<span class="line"><span style="color:#ABB2BF">    &#x3C;/</span><span style="color:#E06C75">div</span><span style="color:#ABB2BF">></span></span>
<span class="line"><span style="color:#ABB2BF">  )</span></span>
<span class="line"><span style="color:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">export</span><span style="color:#ABB2BF"> </span><span style="color:#C678DD">default</span><span style="color:#ABB2BF"> </span><span style="color:#E06C75">Ellapsed</span></span>
<span class="line"></span></code></div><button class='copy-to-clipboard caption'>Copy</button></pre><pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><div class='code-scroller'><code><span class="line"><span style="color:#7F848E;font-style:italic">/** </span><span style="color:#C678DD;font-style:italic">@jsxImportSource</span><span style="color:#7F848E;font-style:italic"> react */</span></span>
<span class="line"><span style="color:#C678DD">import</span><span style="color:#ABB2BF"> </span><span style="color:#E06C75">React</span><span style="color:#ABB2BF">, { </span><span style="color:#E06C75">useState</span><span style="color:#ABB2BF"> } </span><span style="color:#C678DD">from</span><span style="color:#ABB2BF"> </span><span style="color:#98C379">"react"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">const</span><span style="color:#ABB2BF"> </span><span style="color:#61AFEF">OneSecondTimer</span><span style="color:#ABB2BF"> </span><span style="color:#56B6C2">=</span><span style="color:#ABB2BF"> () </span><span style="color:#C678DD">=></span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#ABB2BF">  </span><span style="color:#7F848E;font-style:italic">// startWith(0)</span></span>
<span class="line"><span style="color:#ABB2BF">  </span><span style="color:#C678DD">const</span><span style="color:#ABB2BF"> [</span><span style="color:#E5C07B">state</span><span style="color:#ABB2BF">, </span><span style="color:#E5C07B">setState</span><span style="color:#ABB2BF">] </span><span style="color:#56B6C2">=</span><span style="color:#ABB2BF"> </span><span style="color:#61AFEF">useState</span><span style="color:#ABB2BF">(</span><span style="color:#D19A66">0</span><span style="color:#ABB2BF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF">  </span><span style="color:#7F848E;font-style:italic">// interval(1000).pipe(map(i => i + 1))</span></span>
<span class="line"><span style="color:#ABB2BF">  </span><span style="color:#E5C07B">React</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">useEffect</span><span style="color:#ABB2BF">(() </span><span style="color:#C678DD">=></span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#ABB2BF">    </span><span style="color:#C678DD">const</span><span style="color:#ABB2BF"> </span><span style="color:#E5C07B">id</span><span style="color:#ABB2BF"> </span><span style="color:#56B6C2">=</span><span style="color:#ABB2BF"> </span><span style="color:#61AFEF">setInterval</span><span style="color:#ABB2BF">(() </span><span style="color:#C678DD">=></span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#ABB2BF">      </span><span style="color:#61AFEF">setState</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75;font-style:italic">p</span><span style="color:#ABB2BF"> </span><span style="color:#C678DD">=></span><span style="color:#ABB2BF"> </span><span style="color:#E06C75">p</span><span style="color:#ABB2BF"> </span><span style="color:#56B6C2">+</span><span style="color:#ABB2BF"> </span><span style="color:#D19A66">1</span><span style="color:#ABB2BF">)</span></span>
<span class="line"><span style="color:#ABB2BF">    }, </span><span style="color:#D19A66">1000</span><span style="color:#ABB2BF">)</span></span>
<span class="line"><span style="color:#ABB2BF">    </span><span style="color:#C678DD">return</span><span style="color:#ABB2BF"> () </span><span style="color:#C678DD">=></span><span style="color:#ABB2BF"> </span><span style="color:#61AFEF">clearInterval</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75">id</span><span style="color:#ABB2BF">)</span></span>
<span class="line"><span style="color:#ABB2BF">  }, [])</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF">  </span><span style="color:#C678DD">return</span><span style="color:#ABB2BF"> (</span></span>
<span class="line"><span style="color:#ABB2BF">    &#x3C;</span><span style="color:#E06C75">div</span><span style="color:#ABB2BF"> </span><span style="color:#D19A66;font-style:italic">style</span><span style="color:#56B6C2">=</span><span style="color:#C678DD">{</span><span style="color:#ABB2BF">{ </span><span style="color:#E06C75">background</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"red"</span><span style="color:#ABB2BF">, </span><span style="color:#E06C75">color</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"white"</span><span style="color:#ABB2BF"> }</span><span style="color:#C678DD">}</span><span style="color:#ABB2BF">></span></span>
<span class="line"><span style="color:#ABB2BF">      </span><span style="color:#C678DD">{</span><span style="color:#E06C75">state</span><span style="color:#C678DD">}</span><span style="color:#E06C75">&#x26;nbsp;</span><span style="color:#ABB2BF">seconds since mount/subscribe</span></span>
<span class="line"><span style="color:#ABB2BF">    &#x3C;/</span><span style="color:#E06C75">div</span><span style="color:#ABB2BF">></span></span>
<span class="line"><span style="color:#ABB2BF">  )</span></span>
<span class="line"><span style="color:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">export</span><span style="color:#ABB2BF"> </span><span style="color:#C678DD">default</span><span style="color:#ABB2BF"> () </span><span style="color:#C678DD">=></span><span style="color:#ABB2BF"> &#x3C;</span><span style="color:#E5C07B">OneSecondTimer</span><span style="color:#ABB2BF"> /></span></span>
<span class="line"></span></code></div><button class='copy-to-clipboard caption'>Copy</button></pre><script defer src="/Users/chrishafley/projects/le-blog/src/lib/CodeTabs/temp/src/blog/unholy-custom-jsx-with-observable-strings/counter//index.vite.ts" type="module"></script>
<style>
  #src\/blog\/unholy-custom-jsx-with-observable-strings\/counter\/{
    
  &:has(#src\/blog\/unholy-custom-jsx-with-observable-strings\/counter\/7\.react\.ellapsed\.dom\.tsx:checked) { 
    & pre:nth-child(2){
      & + .console\.log-details {
        display: block;
      }
      display: block;
    }
    pre:nth-child(2)
  }
  

  &:has(#src\/blog\/unholy-custom-jsx-with-observable-strings\/counter\/5_interval\.dom\.tsx:checked) { 
    & pre:nth-child(3){
      & + .console\.log-details {
        display: block;
      }
      display: block;
    }
    pre:nth-child(3)
  }
  

  &:has(#src\/blog\/unholy-custom-jsx-with-observable-strings\/counter\/6_interval\.dom\.tsx:checked) { 
    & pre:nth-child(4){
      & + .console\.log-details {
        display: block;
      }
      display: block;
    }
    pre:nth-child(4)
  }
  

  &:has(#src\/blog\/unholy-custom-jsx-with-observable-strings\/counter\/7\.react\.dom\.tsx:checked) { 
    & pre:nth-child(5){
      & + .console\.log-details {
        display: block;
      }
      display: block;
    }
    pre:nth-child(5)
  }
  
  }
</style>
<div class="code-group-demo-area"></div></div><style>
#section-counter-demo {
  --section-header-hr-start: 57.142857142857146%;
  --section-header-hr-stop: 64.28571428571429%;
}
</style><div class="flair-section"></div></section>
<section id="section-children"><h2 id="children"><a href="#children"><span class="marker">6.</span>  Children<div class="flair-a"></div></a><div class="flair-h"></div></h2><style>
#section-children {
  --section-header-hr-start: 64.28571428571429%;
  --section-header-hr-stop: 71.42857142857143%;
}
</style><div class="flair-section"></div></section>
<section id="section-arrays"><h3 id="arrays"><a href="#arrays"><span class="marker">6.1.</span>  Arrays<div class="flair-a"></div></a><div class="flair-h"></div></h3><style>
#section-arrays {
  --section-header-hr-start: 71.42857142857143%;
  --section-header-hr-stop: 78.57142857142857%;
}
</style><div class="flair-section"></div></section>
<section id="section-conditionals"><h3 id="conditionals"><a href="#conditionals"><span class="marker">6.2.</span>  Conditionals<div class="flair-a"></div></a><div class="flair-h"></div></h3><p>Okay and lets make sure that doing regular array map's into jsx work as expected, as well as conditionals.</p><p>:::codes</p><pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><div class="code-scroller"><code class="language-tsx"><span class="line"><span style="color:#7F848E;font-style:italic">// @@filename Static Array</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">// @@src /blog/unholy-custom-jsx-with-observable-strings/arrays/1.static.dom.tsx</span></span>
<span class="line"><span style="color:#C678DD">const</span><span style="color:#E5C07B"> navItems</span><span style="color:#56B6C2"> =</span><span style="color:#ABB2BF"> [</span></span>
<span class="line"><span style="color:#98C379">  "home"</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#98C379">  "resume"</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#98C379">  "blog"</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#98C379">  "tags"</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#98C379">  "projects"</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#ABB2BF">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">export</span><span style="color:#C678DD"> default</span><span style="color:#ABB2BF"> () </span><span style="color:#C678DD">=></span><span style="color:#ABB2BF"> (</span></span>
<span class="line"><span style="color:#ABB2BF">  &#x3C;</span><span style="color:#E06C75">nav</span><span style="color:#D19A66;font-style:italic"> style</span><span style="color:#56B6C2">=</span><span style="color:#C678DD">{</span><span style="color:#ABB2BF">{ </span><span style="color:#E06C75">background</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"purple"</span><span style="color:#ABB2BF">, </span><span style="color:#E06C75">color</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"white"</span><span style="color:#ABB2BF"> }</span><span style="color:#C678DD">}</span><span style="color:#ABB2BF">></span></span>
<span class="line"><span style="color:#ABB2BF">    Primary Nav:</span></span>
<span class="line"><span style="color:#ABB2BF">    &#x3C;</span><span style="color:#E06C75">ul</span><span style="color:#ABB2BF">></span></span>
<span class="line"><span style="color:#C678DD">      {</span><span style="color:#E5C07B">navItems</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">map</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75;font-style:italic">it</span><span style="color:#C678DD"> =></span><span style="color:#ABB2BF"> (</span></span>
<span class="line"><span style="color:#ABB2BF">        &#x3C;</span><span style="color:#E06C75">li</span><span style="color:#D19A66;font-style:italic"> key</span><span style="color:#56B6C2">=</span><span style="color:#C678DD">{</span><span style="color:#E06C75">it</span><span style="color:#C678DD">}</span><span style="color:#ABB2BF">></span><span style="color:#C678DD">{</span><span style="color:#E06C75">it</span><span style="color:#C678DD">}</span><span style="color:#ABB2BF">&#x3C;/</span><span style="color:#E06C75">li</span><span style="color:#ABB2BF">></span></span>
<span class="line"><span style="color:#ABB2BF">      ))</span><span style="color:#C678DD">}</span></span>
<span class="line"><span style="color:#ABB2BF">    &#x3C;/</span><span style="color:#E06C75">ul</span><span style="color:#ABB2BF">></span></span>
<span class="line"><span style="color:#ABB2BF">  &#x3C;/</span><span style="color:#E06C75">nav</span><span style="color:#ABB2BF">></span></span>
<span class="line"><span style="color:#ABB2BF">)</span></span>
<span class="line"></span></code></div><button class="copy-to-clipboard caption">Copy</button></pre><script type="module" src="/blog/unholy-custom-jsx-with-observable-strings/arrays/1.static.dom.tsx" demo-for="1.static.dom.tsx"></script><pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><div class="code-scroller"><code class="language-tsx"><span class="line"><span style="color:#7F848E;font-style:italic">// @@filename Observable Array</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">// @@src /blog/unholy-custom-jsx-with-observable-strings/arrays/2.dynamic.dom.tsx</span></span>
<span class="line"><span style="color:#C678DD">const</span><span style="color:#E5C07B"> navItems</span><span style="color:#56B6C2"> =</span><span style="color:#ABB2BF"> [</span></span>
<span class="line"><span style="color:#98C379">  "home"</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#98C379">  "resume"</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#98C379">  "blog"</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#98C379">  "tags"</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#98C379">  "projects"</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#ABB2BF">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">export</span><span style="color:#C678DD"> default</span><span style="color:#ABB2BF"> () </span><span style="color:#C678DD">=></span><span style="color:#ABB2BF"> (</span></span>
<span class="line"><span style="color:#ABB2BF">  &#x3C;</span><span style="color:#E06C75">nav</span><span style="color:#D19A66;font-style:italic"> style</span><span style="color:#56B6C2">=</span><span style="color:#C678DD">{</span><span style="color:#ABB2BF">{ </span><span style="color:#E06C75">background</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"purple"</span><span style="color:#ABB2BF">, </span><span style="color:#E06C75">color</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"white"</span><span style="color:#ABB2BF"> }</span><span style="color:#C678DD">}</span><span style="color:#ABB2BF">></span></span>
<span class="line"><span style="color:#ABB2BF">    Primary Nav:</span></span>
<span class="line"><span style="color:#ABB2BF">    &#x3C;</span><span style="color:#E06C75">ul</span><span style="color:#ABB2BF">></span></span>
<span class="line"><span style="color:#C678DD">      {</span><span style="color:#E5C07B">navItems</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">map</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75;font-style:italic">it</span><span style="color:#C678DD"> =></span><span style="color:#ABB2BF"> (</span></span>
<span class="line"><span style="color:#ABB2BF">        &#x3C;</span><span style="color:#E06C75">li</span><span style="color:#D19A66;font-style:italic"> key</span><span style="color:#56B6C2">=</span><span style="color:#C678DD">{</span><span style="color:#E06C75">it</span><span style="color:#C678DD">}</span><span style="color:#ABB2BF">></span><span style="color:#C678DD">{</span><span style="color:#E06C75">it</span><span style="color:#C678DD">}</span><span style="color:#ABB2BF">&#x3C;/</span><span style="color:#E06C75">li</span><span style="color:#ABB2BF">></span></span>
<span class="line"><span style="color:#ABB2BF">      ))</span><span style="color:#C678DD">}</span></span>
<span class="line"><span style="color:#ABB2BF">    &#x3C;/</span><span style="color:#E06C75">ul</span><span style="color:#ABB2BF">></span></span>
<span class="line"><span style="color:#ABB2BF">  &#x3C;/</span><span style="color:#E06C75">nav</span><span style="color:#ABB2BF">></span></span>
<span class="line"><span style="color:#ABB2BF">)</span></span>
<span class="line"></span></code></div><button class="copy-to-clipboard caption">Copy</button></pre><script type="module" src="/blog/unholy-custom-jsx-with-observable-strings/arrays/2.dynamic.dom.tsx" demo-for="2.dynamic.dom.tsx"></script><pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><div class="code-scroller"><code class="language-tsx"><span class="line"><span style="color:#7F848E;font-style:italic">// @@filename Promised Array</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">// @@src /blog/unholy-custom-jsx-with-observable-strings/arrays/3.promise.dom.tsx</span></span>
<span class="line"></span></code></div><button class="copy-to-clipboard caption">Copy</button></pre><script type="module" src="/blog/unholy-custom-jsx-with-observable-strings/arrays/3.promise.dom.tsx" demo-for="3.promise.dom.tsx"></script><p>:::</p><style>
#section-conditionals {
  --section-header-hr-start: 78.57142857142857%;
  --section-header-hr-stop: 85.71428571428571%;
}
</style><div class="flair-section"></div></section>
<section id="section-events"><h2 id="events"><a href="#events"><span class="marker">7.</span>  Events<div class="flair-a"></div></a><div class="flair-h"></div></h2><p>This is easily the hardest part of designing this jsx transform.</p><p>For starters, RxJS already has a built in shortcut, called <code>fromEvent</code>, which takes an HTMLElement, and an event string.</p><p>This works well <strong>when the element already exists</strong>. That is, you must have a reference to the element before calling it.</p><p>Here are some examples
:::codes</p><pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><div class="code-scroller"><code class="language-ts"><span class="line"><span style="color:#C678DD">import</span><span style="color:#ABB2BF"> { </span><span style="color:#E06C75">fromEvent</span><span style="color:#ABB2BF"> } </span><span style="color:#C678DD">from</span><span style="color:#98C379"> 'rxjs'</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B">document</span><span style="color:#ABB2BF">.</span><span style="color:#E06C75">body</span></span></code></div><button class="copy-to-clipboard caption">Copy</button></pre><p>:::</p><style>
#section-events {
  --section-header-hr-start: 85.71428571428572%;
  --section-header-hr-stop: 92.85714285714286%;
}
</style><div class="flair-section"></div></section>
<section id="section-state"><h2 id="state"><a href="#state"><span class="marker">8.</span>  State<div class="flair-a"></div></a><div class="flair-h"></div></h2><p>For idiomatic RxJS, I heavily urge you to avoid BehaviorSubject as much as possible. BUT, it exists for a reason, and when you are starting out, you will want to use it all the time.</p><p>Just know that using it will delay you from understanding everything you see as state is really just some other observable somewhere else.</p><div class="code-group" id="src/blog/unholy-custom-jsx-with-observable-strings/state/"><div id="code-group-src/blog/unholy-custom-jsx-with-observable-strings" class="code-group-tabs" data-sticky="1"><input type="radio" value="2.woBS.dom.tsx" id="src/blog/unholy-custom-jsx-with-observable-strings/state/2.woBS.dom.tsx" name="src/blog/unholy-custom-jsx-with-observable-strings/state/" class="code-tabs-radio-input" data-scroll-to-me="src/blog/unholy-custom-jsx-with-observable-strings/state/" checked="true"><label for="src/blog/unholy-custom-jsx-with-observable-strings/state/2.woBS.dom.tsx"><div class="centerino">Without BehaviorSubject
</div></label><input type="radio" value="1.wBS.dom.tsx" id="src/blog/unholy-custom-jsx-with-observable-strings/state/1.wBS.dom.tsx" name="src/blog/unholy-custom-jsx-with-observable-strings/state/" class="code-tabs-radio-input" data-scroll-to-me="src/blog/unholy-custom-jsx-with-observable-strings/state/"><label for="src/blog/unholy-custom-jsx-with-observable-strings/state/1.wBS.dom.tsx"><div class="centerino">With BehaviorSubject
</div></label></div><pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><div class='code-scroller'><code><span class="line"><span style="color:#C678DD">import</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#ABB2BF">  </span><span style="color:#E06C75">map</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#ABB2BF">  </span><span style="color:#E06C75">merge</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#ABB2BF">  </span><span style="color:#E06C75">Observable</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#ABB2BF">  </span><span style="color:#E06C75">scan</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#ABB2BF">  </span><span style="color:#E06C75">startWith</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#ABB2BF">} </span><span style="color:#C678DD">from</span><span style="color:#ABB2BF"> </span><span style="color:#98C379">"rxjs"</span></span>
<span class="line"><span style="color:#C678DD">import</span><span style="color:#ABB2BF"> { </span><span style="color:#E06C75">withId</span><span style="color:#ABB2BF"> } </span><span style="color:#C678DD">from</span><span style="color:#ABB2BF"> </span><span style="color:#98C379">"~/lib/form_helpers/with.dom"</span></span>
<span class="line"><span style="color:#C678DD">import</span><span style="color:#ABB2BF"> { </span><span style="color:#E06C75">RxJSX</span><span style="color:#ABB2BF"> } </span><span style="color:#C678DD">from</span><span style="color:#ABB2BF"> </span><span style="color:#98C379">"~/lib/rxjs-vhtml/v2/jsx-runtime"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">const</span><span style="color:#ABB2BF"> </span><span style="color:#61AFEF">MyButton</span><span style="color:#ABB2BF">: </span><span style="color:#E5C07B">RxJSX</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">FC</span><span style="color:#ABB2BF">&#x3C;{ </span><span style="color:#E06C75">name</span><span style="color:#ABB2BF">: </span><span style="color:#E5C07B">string</span><span style="color:#ABB2BF"> }> </span><span style="color:#56B6C2">=</span><span style="color:#ABB2BF"> </span><span style="color:#E06C75;font-style:italic">props</span><span style="color:#ABB2BF"> </span><span style="color:#C678DD">=></span><span style="color:#ABB2BF"> (</span></span>
<span class="line"><span style="color:#ABB2BF">  &#x3C;</span><span style="color:#E06C75">button</span></span>
<span class="line"><span style="color:#ABB2BF">    </span><span style="color:#C678DD">{</span><span style="color:#ABB2BF">...</span><span style="color:#E06C75">props</span><span style="color:#C678DD">}</span></span>
<span class="line"><span style="color:#ABB2BF">    </span><span style="color:#D19A66;font-style:italic">style</span><span style="color:#56B6C2">=</span><span style="color:#C678DD">{</span><span style="color:#ABB2BF">{ </span><span style="color:#E06C75">background</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"red"</span><span style="color:#ABB2BF">, ...</span><span style="color:#E5C07B">props</span><span style="color:#ABB2BF">.</span><span style="color:#E06C75">style</span><span style="color:#ABB2BF"> }</span><span style="color:#C678DD">}</span></span>
<span class="line"><span style="color:#ABB2BF">  /></span></span>
<span class="line"><span style="color:#ABB2BF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">const</span><span style="color:#ABB2BF"> </span><span style="color:#E5C07B">Interactive</span><span style="color:#ABB2BF"> </span><span style="color:#56B6C2">=</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#ABB2BF">  </span><span style="color:#E06C75">addOne</span><span style="color:#ABB2BF">: </span><span style="color:#61AFEF">withId</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">"button"</span><span style="color:#ABB2BF">, </span><span style="color:#98C379">"add"</span><span style="color:#ABB2BF">),</span></span>
<span class="line"><span style="color:#ABB2BF">  </span><span style="color:#E06C75">subOne</span><span style="color:#ABB2BF">: </span><span style="color:#61AFEF">withId</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75">MyButton</span><span style="color:#ABB2BF">, </span><span style="color:#98C379">"sub"</span><span style="color:#ABB2BF">),</span></span>
<span class="line"><span style="color:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">const</span><span style="color:#ABB2BF"> </span><span style="color:#E5C07B">state</span><span style="color:#ABB2BF"> </span><span style="color:#56B6C2">=</span><span style="color:#ABB2BF"> </span><span style="color:#61AFEF">merge</span><span style="color:#ABB2BF">(</span></span>
<span class="line"><span style="color:#ABB2BF">  </span><span style="color:#E5C07B">Interactive</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">addOne</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">$</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">click</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">pipe</span><span style="color:#ABB2BF">(</span><span style="color:#61AFEF">map</span><span style="color:#ABB2BF">(() </span><span style="color:#C678DD">=></span><span style="color:#ABB2BF"> </span><span style="color:#D19A66">1</span><span style="color:#ABB2BF">)),</span></span>
<span class="line"><span style="color:#ABB2BF">  </span><span style="color:#E5C07B">Interactive</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">subOne</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">$</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">click</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">pipe</span><span style="color:#ABB2BF">(</span><span style="color:#61AFEF">map</span><span style="color:#ABB2BF">(() </span><span style="color:#C678DD">=></span><span style="color:#ABB2BF"> </span><span style="color:#56B6C2">-</span><span style="color:#D19A66">1</span><span style="color:#ABB2BF">)),</span></span>
<span class="line"><span style="color:#ABB2BF">).</span><span style="color:#61AFEF">pipe</span><span style="color:#ABB2BF">(</span></span>
<span class="line"><span style="color:#ABB2BF">  </span><span style="color:#61AFEF">scan</span><span style="color:#ABB2BF">((</span><span style="color:#E06C75;font-style:italic">sum</span><span style="color:#ABB2BF">, </span><span style="color:#E06C75;font-style:italic">next</span><span style="color:#ABB2BF">) </span><span style="color:#C678DD">=></span><span style="color:#ABB2BF"> </span><span style="color:#E06C75">sum</span><span style="color:#ABB2BF"> </span><span style="color:#56B6C2">+</span><span style="color:#ABB2BF"> </span><span style="color:#E06C75">next</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">0</span><span style="color:#ABB2BF">),</span></span>
<span class="line"><span style="color:#ABB2BF">  </span><span style="color:#61AFEF">startWith</span><span style="color:#ABB2BF">(</span><span style="color:#D19A66">0</span><span style="color:#ABB2BF">),</span></span>
<span class="line"><span style="color:#ABB2BF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">export</span><span style="color:#ABB2BF"> </span><span style="color:#C678DD">default</span><span style="color:#ABB2BF"> () </span><span style="color:#C678DD">=></span><span style="color:#ABB2BF"> (</span></span>
<span class="line"><span style="color:#ABB2BF">  &#x3C;</span><span style="color:#E06C75">div</span><span style="color:#ABB2BF"> </span><span style="color:#D19A66;font-style:italic">style</span><span style="color:#56B6C2">=</span><span style="color:#98C379">"display: flex; flex-direction: column;"</span><span style="color:#ABB2BF">></span></span>
<span class="line"><span style="color:#ABB2BF">    &#x3C;</span><span style="color:#E5C07B">Interactive.addOne</span></span>
<span class="line"><span style="color:#ABB2BF">      </span><span style="color:#D19A66;font-style:italic">style</span><span style="color:#56B6C2">=</span><span style="color:#C678DD">{</span><span style="color:#ABB2BF">{</span></span>
<span class="line"><span style="color:#ABB2BF">        </span><span style="color:#E06C75">padding</span><span style="color:#ABB2BF">: </span><span style="color:#D19A66">10</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#ABB2BF">        </span><span style="color:#E06C75">color</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"white"</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#ABB2BF">        </span><span style="color:#E06C75">background</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"blue"</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#ABB2BF">      }</span><span style="color:#C678DD">}</span></span>
<span class="line"><span style="color:#ABB2BF">    ></span></span>
<span class="line"><span style="color:#ABB2BF">      Add One</span></span>
<span class="line"><span style="color:#ABB2BF">    &#x3C;/</span><span style="color:#E5C07B">Interactive.addOne</span><span style="color:#ABB2BF">></span></span>
<span class="line"><span style="color:#ABB2BF">    &#x3C;</span><span style="color:#E5C07B">Interactive.subOne</span></span>
<span class="line"><span style="color:#ABB2BF">      </span><span style="color:#D19A66;font-style:italic">name</span><span style="color:#56B6C2">=</span><span style="color:#98C379">"sub-one"</span></span>
<span class="line"><span style="color:#ABB2BF">      </span><span style="color:#D19A66;font-style:italic">style</span><span style="color:#56B6C2">=</span><span style="color:#C678DD">{</span><span style="color:#ABB2BF">{</span></span>
<span class="line"><span style="color:#ABB2BF">        </span><span style="color:#E06C75">padding</span><span style="color:#ABB2BF">: </span><span style="color:#D19A66">10</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#ABB2BF">        </span><span style="color:#E06C75">color</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"white"</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#ABB2BF">      }</span><span style="color:#C678DD">}</span></span>
<span class="line"><span style="color:#ABB2BF">    ></span></span>
<span class="line"><span style="color:#ABB2BF">      Sub One</span></span>
<span class="line"><span style="color:#ABB2BF">    &#x3C;/</span><span style="color:#E5C07B">Interactive.subOne</span><span style="color:#ABB2BF">></span></span>
<span class="line"><span style="color:#ABB2BF">    &#x3C;</span><span style="color:#E06C75">div</span><span style="color:#ABB2BF">>Result: </span><span style="color:#C678DD">{</span><span style="color:#E06C75">state</span><span style="color:#C678DD">}</span><span style="color:#ABB2BF">&#x3C;/</span><span style="color:#E06C75">div</span><span style="color:#ABB2BF">></span></span>
<span class="line"><span style="color:#ABB2BF">  &#x3C;/</span><span style="color:#E06C75">div</span><span style="color:#ABB2BF">></span></span>
<span class="line"><span style="color:#ABB2BF">)</span></span>
<span class="line"></span></code></div><button class='copy-to-clipboard caption'>Copy</button></pre><pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><div class='code-scroller'><code><span class="line"><span style="color:#C678DD">import</span><span style="color:#ABB2BF"> { </span><span style="color:#E06C75">BehaviorSubject</span><span style="color:#ABB2BF">, </span><span style="color:#E06C75">Observable</span><span style="color:#ABB2BF"> } </span><span style="color:#C678DD">from</span><span style="color:#ABB2BF"> </span><span style="color:#98C379">"rxjs"</span></span>
<span class="line"><span style="color:#C678DD">import</span><span style="color:#ABB2BF"> { </span><span style="color:#E06C75">withId</span><span style="color:#ABB2BF"> } </span><span style="color:#C678DD">from</span><span style="color:#ABB2BF"> </span><span style="color:#98C379">"~/lib/form_helpers/with.dom"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">import</span><span style="color:#ABB2BF"> { </span><span style="color:#E06C75">RxJSX</span><span style="color:#ABB2BF"> } </span><span style="color:#C678DD">from</span><span style="color:#ABB2BF"> </span><span style="color:#98C379">"~/lib/rxjs-vhtml/v2/jsx-runtime"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">const</span><span style="color:#ABB2BF"> </span><span style="color:#61AFEF">MyButton</span><span style="color:#ABB2BF">: </span><span style="color:#E5C07B">RxJSX</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">FC</span><span style="color:#ABB2BF">&#x3C;{ </span><span style="color:#E06C75">name</span><span style="color:#ABB2BF">: </span><span style="color:#E5C07B">string</span><span style="color:#ABB2BF"> }> </span><span style="color:#56B6C2">=</span><span style="color:#ABB2BF"> </span><span style="color:#E06C75;font-style:italic">props</span><span style="color:#ABB2BF"> </span><span style="color:#C678DD">=></span><span style="color:#ABB2BF"> (</span></span>
<span class="line"><span style="color:#ABB2BF">  &#x3C;</span><span style="color:#E06C75">button</span></span>
<span class="line"><span style="color:#ABB2BF">    </span><span style="color:#C678DD">{</span><span style="color:#ABB2BF">...</span><span style="color:#E06C75">props</span><span style="color:#C678DD">}</span></span>
<span class="line"><span style="color:#ABB2BF">    </span><span style="color:#D19A66;font-style:italic">style</span><span style="color:#56B6C2">=</span><span style="color:#C678DD">{</span><span style="color:#ABB2BF">{ </span><span style="color:#E06C75">background</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"red"</span><span style="color:#ABB2BF">, ...</span><span style="color:#E5C07B">props</span><span style="color:#ABB2BF">.</span><span style="color:#E06C75">style</span><span style="color:#ABB2BF"> }</span><span style="color:#C678DD">}</span></span>
<span class="line"><span style="color:#ABB2BF">  /></span></span>
<span class="line"><span style="color:#ABB2BF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">const</span><span style="color:#ABB2BF"> </span><span style="color:#E5C07B">Interactive</span><span style="color:#ABB2BF"> </span><span style="color:#56B6C2">=</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#ABB2BF">  </span><span style="color:#E06C75">addOne</span><span style="color:#ABB2BF">: </span><span style="color:#61AFEF">withId</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">"button"</span><span style="color:#ABB2BF">, </span><span style="color:#98C379">"add"</span><span style="color:#ABB2BF">),</span></span>
<span class="line"><span style="color:#ABB2BF">  </span><span style="color:#E06C75">subOne</span><span style="color:#ABB2BF">: </span><span style="color:#61AFEF">withId</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75">MyButton</span><span style="color:#ABB2BF">, </span><span style="color:#98C379">"sub"</span><span style="color:#ABB2BF">),</span></span>
<span class="line"><span style="color:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">const</span><span style="color:#ABB2BF"> </span><span style="color:#E5C07B">state</span><span style="color:#ABB2BF"> </span><span style="color:#56B6C2">=</span><span style="color:#ABB2BF"> </span><span style="color:#C678DD">new</span><span style="color:#ABB2BF"> </span><span style="color:#61AFEF">BehaviorSubject</span><span style="color:#ABB2BF">(</span><span style="color:#D19A66">0</span><span style="color:#ABB2BF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B">Interactive</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">addOne</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">$</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">click</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">subscribe</span><span style="color:#ABB2BF">(() </span><span style="color:#C678DD">=></span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#ABB2BF">  </span><span style="color:#E5C07B">state</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">next</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">state</span><span style="color:#ABB2BF">.</span><span style="color:#E06C75">value</span><span style="color:#ABB2BF"> </span><span style="color:#56B6C2">+</span><span style="color:#ABB2BF"> </span><span style="color:#D19A66">1</span><span style="color:#ABB2BF">)</span></span>
<span class="line"><span style="color:#ABB2BF">})</span></span>
<span class="line"><span style="color:#E5C07B">Interactive</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">subOne</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">$</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">click</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">subscribe</span><span style="color:#ABB2BF">(() </span><span style="color:#C678DD">=></span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#ABB2BF">  </span><span style="color:#E5C07B">state</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">next</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">state</span><span style="color:#ABB2BF">.</span><span style="color:#E06C75">value</span><span style="color:#ABB2BF"> </span><span style="color:#56B6C2">-</span><span style="color:#ABB2BF"> </span><span style="color:#D19A66">1</span><span style="color:#ABB2BF">)</span></span>
<span class="line"><span style="color:#ABB2BF">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">export</span><span style="color:#ABB2BF"> </span><span style="color:#C678DD">default</span><span style="color:#ABB2BF"> () </span><span style="color:#C678DD">=></span><span style="color:#ABB2BF"> (</span></span>
<span class="line"><span style="color:#ABB2BF">  &#x3C;</span><span style="color:#E06C75">div</span><span style="color:#ABB2BF"> </span><span style="color:#D19A66;font-style:italic">style</span><span style="color:#56B6C2">=</span><span style="color:#98C379">"display: flex; flex-direction: column;"</span><span style="color:#ABB2BF">></span></span>
<span class="line"><span style="color:#ABB2BF">    &#x3C;</span><span style="color:#E5C07B">Interactive.addOne</span></span>
<span class="line"><span style="color:#ABB2BF">      </span><span style="color:#D19A66;font-style:italic">style</span><span style="color:#56B6C2">=</span><span style="color:#C678DD">{</span><span style="color:#ABB2BF">{</span></span>
<span class="line"><span style="color:#ABB2BF">        </span><span style="color:#E06C75">padding</span><span style="color:#ABB2BF">: </span><span style="color:#D19A66">10</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#ABB2BF">        </span><span style="color:#E06C75">color</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"white"</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#ABB2BF">        </span><span style="color:#E06C75">background</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"blue"</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#ABB2BF">      }</span><span style="color:#C678DD">}</span></span>
<span class="line"><span style="color:#ABB2BF">    ></span></span>
<span class="line"><span style="color:#ABB2BF">      Add One</span></span>
<span class="line"><span style="color:#ABB2BF">    &#x3C;/</span><span style="color:#E5C07B">Interactive.addOne</span><span style="color:#ABB2BF">></span></span>
<span class="line"><span style="color:#ABB2BF">    &#x3C;</span><span style="color:#E5C07B">Interactive.subOne</span></span>
<span class="line"><span style="color:#ABB2BF">      </span><span style="color:#D19A66;font-style:italic">name</span><span style="color:#56B6C2">=</span><span style="color:#98C379">"sub-one"</span></span>
<span class="line"><span style="color:#ABB2BF">      </span><span style="color:#D19A66;font-style:italic">style</span><span style="color:#56B6C2">=</span><span style="color:#C678DD">{</span><span style="color:#ABB2BF">{</span></span>
<span class="line"><span style="color:#ABB2BF">        </span><span style="color:#E06C75">padding</span><span style="color:#ABB2BF">: </span><span style="color:#D19A66">10</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#ABB2BF">        </span><span style="color:#E06C75">color</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"white"</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#ABB2BF">      }</span><span style="color:#C678DD">}</span></span>
<span class="line"><span style="color:#ABB2BF">    ></span></span>
<span class="line"><span style="color:#ABB2BF">      Sub One</span></span>
<span class="line"><span style="color:#ABB2BF">    &#x3C;/</span><span style="color:#E5C07B">Interactive.subOne</span><span style="color:#ABB2BF">></span></span>
<span class="line"><span style="color:#ABB2BF">    &#x3C;</span><span style="color:#E06C75">div</span><span style="color:#ABB2BF">>Result: </span><span style="color:#C678DD">{</span><span style="color:#E06C75">state</span><span style="color:#C678DD">}</span><span style="color:#ABB2BF">&#x3C;/</span><span style="color:#E06C75">div</span><span style="color:#ABB2BF">></span></span>
<span class="line"><span style="color:#ABB2BF">  &#x3C;/</span><span style="color:#E06C75">div</span><span style="color:#ABB2BF">></span></span>
<span class="line"><span style="color:#ABB2BF">)</span></span>
<span class="line"></span></code></div><button class='copy-to-clipboard caption'>Copy</button></pre><script defer src="/Users/chrishafley/projects/le-blog/src/lib/CodeTabs/temp/src/blog/unholy-custom-jsx-with-observable-strings/state//index.vite.ts" type="module"></script>
<style>
  #src\/blog\/unholy-custom-jsx-with-observable-strings\/state\/{
    
  &:has(#src\/blog\/unholy-custom-jsx-with-observable-strings\/state\/2\.woBS\.dom\.tsx:checked) { 
    & pre:nth-child(2){
      & + .console\.log-details {
        display: block;
      }
      display: block;
    }
    pre:nth-child(2)
  }
  

  &:has(#src\/blog\/unholy-custom-jsx-with-observable-strings\/state\/1\.wBS\.dom\.tsx:checked) { 
    & pre:nth-child(3){
      & + .console\.log-details {
        display: block;
      }
      display: block;
    }
    pre:nth-child(3)
  }
  
  }
</style>
<div class="code-group-demo-area"></div></div><style>
#section-state {
  --section-header-hr-start: 92.85714285714286%;
  --section-header-hr-stop: 100%;
}
</style><div class="flair-section"></div></section></div></main><footer></footer><script>// Smooth scrolling for browsers that don't support CSS smooth scrolling
;(() => {
  /**
   * @type {Record<string, {elem: HTMLElement, percent: number, lastEntry: null | IntersectionObserverEntry}>}
   */
  const byId = {}
  window.sectionById = byId
  /**
   * @type {(typeof byId)[string]}
   */
  let top = null
  /**
   * @type {(typeof byId)[string]}
   */
  let bottom = null

  window.addEventListener("DOMContentLoaded", () => {
    /**
     * @type {HTMLElement}
     */
    const nav = document.getElementById("toc-nav")
    const li = nav?.querySelector("li a")

    let liRatio = li.offsetHeight / nav.offsetHeight

    window.addEventListener("resize", () => {
      console.log("Resize detected")
      liRatio = li.offsetHeight / nav.offsetHeight
    })

    const setEnds = (start, end) => {
      start != null &&
        nav.style.setProperty(
          "--toc-scroll-start",
          "" + (start * 100).toFixed(0) + "%",
        )
      end != null &&
        nav.style.setProperty(
          "--toc-scroll-end",
          "" + (end * 100).toFixed(0) + "%",
        )
    }

    // use elem, its the li
    // now we have its offset from its parent
    // get percent from parent 0 edge
    // that is constant range start

    const observer = new IntersectionObserver(
      entries => {
        entries.forEach(entry => {
          const id = entry.target.getAttribute("id") ?? ""
          let cache =
            // biome-ignore lint/suspicious/noAssignInExpressions: <explanation>
            (byId[id] ||= {
              elem: document.querySelector(
                `nav li a[href="#${id}"]`,
              ),
              percent: 0,
              lastEntry: entry,
            })
          const elem = cache.elem
          cache.lastEntry = entry
          cache.percent = entry.intersectionRatio
          if (entry.isIntersecting) {
            if (entry.intersectionRatio === 1) {
              // console.log("we are golden", cache)
              // console.log("--", elem)
              if (!top) {
                // console.log("A)", elem)
                top = cache
              } else if (
                top.lastEntry.intersectionRect.top >
                  entry.intersectionRect.top ||
                top.lastEntry.time < entry.time
              ) {
                // console.log("AA)", elem)
                // this entry is above the previous top
                top = cache
              } else {
                // console.log(
                //   top.lastEntry,
                //   "does not beat",
                //   entry,
                // )
              }
              // we take full percent of offset + offset+height of LI
            } else if (
              entry.intersectionRect.y ===
                entry.rootBounds.y &&
              entry.intersectionRect.bottom ===
                entry.rootBounds.bottom
            ) {
              // console.log("B)", elem)
              top = cache
              bottom = cache
              // console.log(
              //   "this is both entering/exiting element",
              //   cache,
              // )
            } else if (entry.intersectionRect.y === 0) {
              // console.log(
              //   "this is the leaving element",
              //   cache,
              // )
              // console.log("C)", elem)
              top = cache
            } else {
              // console.log(
              //   "this is the entering element",
              //   cache,
              // )
              // console.log("D)", elem)
              bottom = cache
            }
            if (cache.percent === 0)
              elem?.parentElement?.classList.add(
                "viewtimeline-active",
              )
          } else {
            elem?.parentElement?.classList.remove(
              "viewtimeline-active",
            )
            cache.percent = 0
          }
          // console.log(entry.boundingClientRect.top)
          if (entry.boundingClientRect.top < 0) {
            // we have passed the element and are exiting, which means we are stickied. we need to set the var for our mini gradient as a ratio of relative percent of top / height
            const underWater =
              Math.abs(entry.boundingClientRect.top) /
              entry.boundingClientRect.height

            entry.target.style.setProperty(
              "--section-header-hr-progress",
              underWater,
            )
          }
        })
        if (top && bottom) {
          const a = top.elem // get corresponding LI's anchor
          const percentFromNavTop =
            a.offsetTop / a.offsetParent.offsetHeight // this is our base percent we are setting
          // now calculate the intersection ratio relative to

          const percentDiff =
            (a.offsetHeight *
              (1 - top.lastEntry.intersectionRatio)) /
            a.offsetParent.offsetHeight

          const b = bottom.elem
          const percentFromNavTopToBottom =
            (b.offsetTop + b.offsetHeight) /
            b.offsetParent.offsetHeight // this is our base percent we are setting
          // now calculate the intersection ratio relative to

          const percentDiffB =
            (b.offsetHeight *
              (1 - bottom.lastEntry.intersectionRatio)) /
            b.offsetParent.offsetHeight

          // console.log({
          //   top,
          //   bottom,
          //   percentFromNavTop,
          //   percentFromNavTopToBottom,
          //   percentDiff,
          //   percentDiffB,
          //   a,
          //   b,
          // })

          setEnds(
            percentFromNavTop + percentDiff,
            percentFromNavTopToBottom - percentDiffB,
          )
        }
        // console.log({ top, bottom })
      },
      {
        threshold: Array.from(
          { length: 10 },
          (_, i) => i / 10,
        ),
      },
    )

    // Track all sections that have an `id` applied
    document
      .querySelectorAll("#main-content-middle section[id]")
      .forEach(section => {
        observer.observe(section)
      })
  })
})()
;
;document.addEventListener("DOMContentLoaded", () => {
  try {
    const it = document.getElementById("toc-toggle")
    if (it) {
      it.checked = JSON.parse(
        localStorage.tocChecked ?? "false",
      )
      it.addEventListener("change", e => {
        localStorage.tocChecked = !!e.target.checked
      })
    }
  } catch (e) {}
  setTimeout(() => {
    document.body.classList.toggle("ready")
  }, 1)
})
;
;function copyToClipboard(text) {
  navigator.clipboard
    .writeText(text)
    .then(() => {
      // Text copied successfully
      console.log("Text copied to clipboard")
    })
    .catch(err => {
      // Error copying text
      console.error("Failed to copy text: ", err)
    })
}

/**
 * @param {HTMLElement} el
 * @param {Window} win
 */
function selectElementText(el, win) {
  win = win || window
  let doc = win.document
  /**
   * @type {Selection}
   */
  let sel
  /**
   * @type {Range}
   */
  let range

  if (win.getSelection && doc.createRange) {
    sel = win.getSelection()
    range = doc.createRange()
    range.selectNodeContents(el)
    sel.removeAllRanges()
    sel.addRange(range)
  } else if (doc.body.createTextRange) {
    range = doc.body.createTextRange()
    range.moveToElementText(el)
    range.select()
  }
  console.log(sel.toString())
  return sel.toString()
}

document.addEventListener("click", e => {
  let target =
    e.target.classList.contains("copy-to-clipboard") &&
    e.target.parentElement.classList.contains("shiki")
      ? e.target
      : null
  target = target?.parentElement.querySelector("code")
  if (target) {
    copyToClipboard(selectElementText(target))
    window.getSelection().removeAllRanges()
  }
})
;
;let isZoomin = false
let container = null
const remove = () => {
  if (!container) return
  container?.remove()
  container = null
  const it = document.querySelector(".img-zoom")
  it?.classList.toggle("img-zoom")
  isZoomin = false
}
document.addEventListener("click", e => {
  if (
    isZoomin &&
    e.target.classList.contains("img-zoom-clone-parent")
  ) {
    document
      .querySelector(".img-zoom-clone-exit")
      ?.dispatchEvent(
        new MouseEvent("click", {
          view: window,
          bubbles: true,
          cancelable: false,
        }),
      )
  }

  if (e.target.tagName === "IMG") {
    if (e.target.classList.contains("img-zoom-clone")) {
      return
    }
    if (!e.target.classList.contains("img-zoom")) {
      /**
       * @type {HTMLImageElement}
       */
      const orig = e.target
      /**
       * @type {HTMLImageElement}
       */
      const clone = e.target.cloneNode()
      clone.classList.add("img-zoom-clone")

      container = document.createElement("div")
      container.classList.add("img-zoom-clone-parent")

      const behind = document.createElement("div")
      behind.classList.add("behind")

      const exitButton = document.createElement("button")
      exitButton.classList.add("img-zoom-clone-exit")
      ;[exitButton, behind].forEach(i =>
        i.addEventListener("click", remove),
      )
      isZoomin = true

      exitButton.setAttribute("aria-role", "button")
      exitButton.setAttribute("type", "button")
      exitButton.innerHTML = "Close"

      container.appendChild(behind)
      container.appendChild(clone)
      container.appendChild(exitButton)

      document.body.appendChild(container)
      e.target.classList.toggle("img-zoom")
      requestAnimationFrame(() => {
        exitButton.focus()
      })
    }
  }
})

document.addEventListener("keyup", e => {
  if (e.key === "Escape" && isZoomin) {
    remove()
  }
})
</script>
    
    <script type='module' src='/lib/client/invokers.dom.js' demo-for='invokers.dom.js'></script>
    
    
    
    <script type='module' src='/lib/client/dialog-closeby-attribute-polyfill.dom.js' demo-for='dialog-closeby-attribute-polyfill.dom.js'></script>
    
    <script type="module" src="/lib/client/on-click-scroll.dom.ts" defer="true"></script></body></html>