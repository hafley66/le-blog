<html lang="en"><head><meta name="viewport" content="width=device-width, initial-scale=1"><meta charSet="UTF-8"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><script>window.resizeIframe = function resizeIframe(obj) {
          obj.style.height = obj.contentWindow.document.documentElement.scrollHeight + 'px';
          }</script><link rel="stylesheet" href="/styles/colors.css"><link rel="stylesheet" href="/styles/fonts.css"><link rel="stylesheet" href="/styles/global.css"><link rel="stylesheet" href="/styles/nav_and_toc.css"><link rel="stylesheet" href="/styles/hex.css"><link rel="stylesheet" href="/styles/code.css"><link rel="stylesheet" href="/styles/img.css"><link rel="stylesheet" href="/shiki-twoslash.css"><title>(DRAFT) True lazy rendering with JSX and RxJS Observables (DRAFT)</title></head><body class=""><header><nav id="primary-nav" aria-label="Primary navigation"><div class="nav-links" role="tablist"><a href="/home" role="tab" class="nav-link-anchor"><span class="nav-link ">Home</span></a><a href="/resume" role="tab" class="nav-link-anchor"><span class="nav-link ">Resume</span></a><a href="/blog" role="tab" aria-selected="true" class="nav-link-anchor"><span class="nav-link active">Blog</span></a></div></nav></header><main class="body-markdown"><section id="title-and-description"><h1>(DRAFT) True lazy rendering with JSX and RxJS Observables (DRAFT)</h1><sub>2025-02-25 by Chris Hafley</sub><div id="h1-desc"><div class="f-col"><strong>DRAFT!!!</strong><em><blockquote>"Do you think God stays in heaven because he too lives in fear of what he's created?"</blockquote></em></div></div><div class="f-col f-a-center" id="tags" style="margin-bottom:24px;"><div class="responsive-hex-grid-3"><a class="hex-content caption" href="/tags/typescript" style="--hex-color:var(--color-inferno-2);">
      <div class="hex-content hex-shadow">
        <div class="hex-content-amoeba"></div>
      </div>
      <div class="hex-content-amoeba"></div>
      <span>typescript</span>
</a><a class="hex-content caption" href="/tags/javascript" style="--hex-color:var(--color-inferno-4);">
      <div class="hex-content hex-shadow">
        <div class="hex-content-amoeba"></div>
      </div>
      <div class="hex-content-amoeba"></div>
      <span>javascript</span>
</a><a class="hex-content caption" href="/tags/jsx" style="--hex-color:var(--color-inferno-6);">
      <div class="hex-content hex-shadow">
        <div class="hex-content-amoeba"></div>
      </div>
      <div class="hex-content-amoeba"></div>
      <span>jsx</span>
</a><a class="hex-content caption" href="/tags/react" style="--hex-color:var(--color-inferno-8);">
      <div class="hex-content hex-shadow">
        <div class="hex-content-amoeba"></div>
      </div>
      <div class="hex-content-amoeba"></div>
      <span>react</span>
</a><a class="hex-content caption" href="/tags/deno" style="--hex-color:var(--color-inferno-10);">
      <div class="hex-content hex-shadow">
        <div class="hex-content-amoeba"></div>
      </div>
      <div class="hex-content-amoeba"></div>
      <span>deno</span>
</a><a class="hex-content caption" href="/tags/rxjs" style="--hex-color:var(--color-inferno-12);">
      <div class="hex-content hex-shadow">
        <div class="hex-content-amoeba"></div>
      </div>
      <div class="hex-content-amoeba"></div>
      <span>rxjs</span>
</a></div></div></section><details open="true" id="section-table-of-contents"><summary id="toc-header-contents"><h2 id="table-of-contents">Table of Contents</h2><input type="checkbox" id="toc-toggle"></summary><div class="fancy-hr"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 20"><circle cx="10" cy="10" r="7" style="fill:var(--color-text);" stroke-width="2"></circle><circle cx="30" cy="10" r="9" style="fill:var(--color-text);" stroke-width="2" fill="transparent"></circle><circle cx="50" cy="10" r="7" style="fill:var(--color-text);" stroke-width="2"></circle></svg></div><nav id="toc-nav"><ol><li><a href="#section-html-over-time">1.  HTML Over Time</a><ol><li><a href="#section-but-actually-why">1.1.  But actually why</a></li><li><a href="#section-comparisons-with-react">1.2.  Comparisons with React</a></li><li><a href="#section-basic-demos">1.3.  Basic Demos</a></li></ol></li></ol></nav></details><div id="main-content-middle"><section id="section-html-over-time"><h2 id="html-over-time"><a href="#html-over-time"><span class="marker">1.</span>  HTML Over Time<div class="flair-a"></div></a><div class="flair-h"></div></h2><p>React Components represent <strong>HTML</strong> over time.</p><p>Observables represent <strong>any value</strong>  over time.</p><p>So then, we can say React Components are <code>Observable&#x3C;JSX></code> over time.</p><p>After seeing this logic, I decided to create a RxJS version of <code>JSX</code>. It is meant to be as simple as possible, and promote what I view as idiomatic/practical RxJS.</p><style>
#section-html-over-time {
  --section-header-hr-start: 0%;
  --section-header-hr-stop: 25%;
}
</style><div class="flair-section"></div></section>
<section id="section-but-actually-why"><h3 id="but-actually-why"><a href="#but-actually-why"><span class="marker">1.1.</span>  But actually why<div class="flair-a"></div></a><div class="flair-h"></div></h3><p>I have a lot of experience getting react to work with RxJS. Often times, its a chaotic mess. Its much like lifting everything out of react and into redux. But even with redux, you are often left re-implementing a ton of missing features that are just in rxjs for free.</p><p>My biggest frustration was making this blog while learning the ReactDOM server API's. You must spam <code>use(Promise)</code> everywhere to prevent rendering your blog post. useEffect cannot be used as a way to defer rendering. React notes this in their docs for 19, with a special info block that tells you to use a meta-framework that does all this for you. Talk about friendly and intuitive ergonomics.</p><p>These are simply non-problems in RxJS, so I decided to write a version of jsx that <strong>naturally</strong> allows lazy programming, by leveraging Observable's and RxJS.</p><p>If you want to defer rendering for a blog post, just do whatever combo of rxjs that you need.</p><p>RxJS is fundamentally the reverse order of how you do things in other libraries, but they express all the same things.</p><p>I truly hope that this is a starting point for some devs to build intuition or interest in RxJS, and more importantly, Observable's as a standard data structure.</p><style>
#section-but-actually-why {
  --section-header-hr-start: 25%;
  --section-header-hr-stop: 50%;
}
</style><div class="flair-section"></div></section>
<section id="section-comparisons-with-react"><h3 id="comparisons-with-react"><a href="#comparisons-with-react"><span class="marker">1.2.</span>  Comparisons with React<div class="flair-a"></div></a><div class="flair-h"></div></h3><ol>
<li>Components
<ul>
<li>Components are <strong>run once</strong>
<ul>
<li>Unlike React, more like Solid.js</li>
</ul>
</li>
<li>The unit of reactivity is <code>Observable&#x3C;string></code>
<ul>
<li>Not signals, and not magic hooks</li>
<li>Just an Symbol.asyncIterable compatible data structure</li>
</ul>
</li>
<li>Props
<ul>
<li>Props are not reactive, if you want reactive props, you must pass Observables</li>
</ul>
</li>
</ul>
</li>
<li>JSX Basics
<ul>
<li>Like all others, style as css object, className, id</li>
<li><strong>There are no refs</strong>: this is intentional...for now</li>
<li>There is no vdom and reason for <code>key</code> prop...also for now
<ul>
<li>I will eventually learn how to make efficient dom updates just using rxjs and a read/write queue</li>
</ul>
</li>
</ul>
</li>
<li>DOM events
<ul>
<li>I am not supporting inline handlers for now
<ul>
<li>I view it as an anti-pattern</li>
</ul>
</li>
<li>Instead, there are helpers for making <strong>event delegation</strong> patterns easier
<ul>
<li><strong>jQuery was right all along</strong></li>
</ul>
</li>
<li>But this keeps the DOM you produced mostly serializable from the get go</li>
</ul>
</li>
<li>State
<ul>
<li>scan operator exists or new Observable for idiomatic RxJS</li>
<li>BehaviorSubject for imperative/useState style setState</li>
</ul>
</li>
<li>Memos/Computed/Derived
<ul>
<li>In RxJS, you have a massive amount of incredibly useful tools</li>
<li>The very basic combo of <code>combineLatest(...).pipe(map(MEMO_FN))</code> will get you very far
<ul>
<li>This gives you manual control of the reactivity, instead of having 1 blunt tool for it
<ul>
<li>(Lexical scope deps arrays)</li>
</ul>
</li>
</ul>
</li>
<li>I do nothing special here, you must learn the power of <code>merge</code>, <code>combineLatest</code></li>
</ul>
</li>
<li>Effects
<ul>
<li>switchMap
<ul>
<li>switchMap</li>
<li>?????????</li>
<li>Believe it or not, also switchMap</li>
</ul>
</li>
<li>The ubiquity of switchMap will drive you nuts</li>
<li>You will see it in every library you use, a horrifically custom and duct taped switchMap of disappointment</li>
<li>You can do conditional useEffect's in this lib, bc switchMap doesn't care about magic call order</li>
</ul>
</li>
<li>Server Side Stuff
<ul>
<li>I have crazy ideas for this with websockets but thats a much later thing.</li>
<li>Running on the server is easy, I do it for the demos that output console.logs to the page.</li>
<li>Its just a string output, so you do what you want with it.</li>
<li>Some day I'll make a better situations but for now it works fine for my blog.</li>
</ul>
</li>
</ol><style>
#section-comparisons-with-react {
  --section-header-hr-start: 50%;
  --section-header-hr-stop: 75%;
}
</style><div class="flair-section"></div></section>
<section id="section-basic-demos"><h3 id="basic-demos"><a href="#basic-demos"><span class="marker">1.3.</span>  Basic Demos<div class="flair-a"></div></a><div class="flair-h"></div></h3><p>Here are 4 intro demos demonstrating basic jsx, sync jsx, and async jsx with observables, and async jsx with rxjs.</p><p>The console.logs represent the value of html emitted over time.</p><div class="code-group code-group-src/blog/unholy-custom-jsx-with-observable-strings"><div id="code-group-src/blog/unholy-custom-jsx-with-observable-strings" class="code-group-tabs" data-sticky="1"><input type="radio" name="async.rxjs.deno.tsx" id="src/blog/unholy-custom-jsx-with-observable-strings/intro/async.rxjs.deno.tsx" value="src/blog/unholy-custom-jsx-with-observable-strings/intro/" class="code-tabs-radio-input" data-scroll-to-me=".code-group-src/blog/unholy-custom-jsx-with-observable-strings" checked="true"><label for="code-group-radio-0-0"><div class="centerino"></div></label><input type="radio" name="sync.deno.tsx" id="src/blog/unholy-custom-jsx-with-observable-strings/intro/sync.deno.tsx" value="src/blog/unholy-custom-jsx-with-observable-strings/intro/" class="code-tabs-radio-input" data-scroll-to-me=".code-group-src/blog/unholy-custom-jsx-with-observable-strings" checked="true"><label for="code-group-radio-0-1"><div class="centerino"></div></label><input type="radio" name="basic.deno.tsx" id="src/blog/unholy-custom-jsx-with-observable-strings/intro/basic.deno.tsx" value="src/blog/unholy-custom-jsx-with-observable-strings/intro/" class="code-tabs-radio-input" data-scroll-to-me=".code-group-src/blog/unholy-custom-jsx-with-observable-strings" checked="true"><label for="code-group-radio-0-2"><div class="centerino"></div></label><input type="radio" name="async.deno.tsx" id="src/blog/unholy-custom-jsx-with-observable-strings/intro/async.deno.tsx" value="src/blog/unholy-custom-jsx-with-observable-strings/intro/" class="code-tabs-radio-input" data-scroll-to-me=".code-group-src/blog/unholy-custom-jsx-with-observable-strings" checked="true"><label for="code-group-radio-0-3"><div class="centerino">Async Observables
</div></label></div><pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E06C75">eval</span></span></code></pre><pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E06C75">eval</span></span></code></pre><pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E06C75">eval</span></span></code></pre><pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E06C75">eval</span></span></code></pre>
<style>
  #src\/blog\/unholy-custom-jsx-with-observable-strings\/intro\/{
    
  &:has(#code-group-radio-0:checked) { 
    & pre:nth-child(2){
      & + .console\.log-details {
        display: block;
      }
      display: block;
    }
    pre:nth-child(2)
  }
  

  &:has(#code-group-radio-0:checked) { 
    & pre:nth-child(3){
      & + .console\.log-details {
        display: block;
      }
      display: block;
    }
    pre:nth-child(3)
  }
  

  &:has(#code-group-radio-0:checked) { 
    & pre:nth-child(4){
      & + .console\.log-details {
        display: block;
      }
      display: block;
    }
    pre:nth-child(4)
  }
  

  &:has(#code-group-radio-0:checked) { 
    & pre:nth-child(5){
      & + .console\.log-details {
        display: block;
      }
      display: block;
    }
    pre:nth-child(5)
  }
  
  }
</style>
</div><pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><div class="code-scroller"><code class="language-tsx"><span class="line"><span style="color:#7F848E;font-style:italic">// @@eval</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">// @@filename Basic</span></span>
<span class="line"><span style="color:#C678DD">export</span><span style="color:#C678DD"> default</span><span style="color:#ABB2BF"> (&#x3C;</span><span style="color:#E06C75">div</span><span style="color:#ABB2BF">>Hello World&#x3C;/</span><span style="color:#E06C75">div</span><span style="color:#ABB2BF">>).</span><span style="color:#61AFEF">subscribe</span><span style="color:#ABB2BF">(</span></span>
<span class="line"><span style="color:#E5C07B">  console</span><span style="color:#ABB2BF">.</span><span style="color:#E06C75">log</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#ABB2BF">)</span></span>
<span class="line"></span></code></div><button class="copy-to-clipboard caption">Copy</button></pre><pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><div class="code-scroller"><code class="language-tsx"><span class="line"><span style="color:#7F848E;font-style:italic">// @@eval</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">// @@filename Sync children</span></span>
<span class="line"><span style="color:#C678DD">import</span><span style="color:#ABB2BF"> { </span><span style="color:#E06C75">of</span><span style="color:#ABB2BF"> } </span><span style="color:#C678DD">from</span><span style="color:#98C379"> "rxjs"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">const</span><span style="color:#E5C07B"> children</span><span style="color:#56B6C2"> =</span><span style="color:#61AFEF"> of</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">"Hello World"</span><span style="color:#ABB2BF">, </span><span style="color:#98C379">"It was me, DIO"</span><span style="color:#ABB2BF">)</span></span>
<span class="line"><span style="color:#ABB2BF">;(&#x3C;</span><span style="color:#E06C75">div</span><span style="color:#ABB2BF">></span><span style="color:#C678DD">{</span><span style="color:#E06C75">children</span><span style="color:#C678DD">}</span><span style="color:#ABB2BF">&#x3C;/</span><span style="color:#E06C75">div</span><span style="color:#ABB2BF">>).</span><span style="color:#61AFEF">subscribe</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">console</span><span style="color:#ABB2BF">.</span><span style="color:#E06C75">log</span><span style="color:#ABB2BF">)</span></span>
<span class="line"></span></code></div><button class="copy-to-clipboard caption">Copy</button></pre><pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><div class="code-scroller"><code class="language-tsx"><span class="line"><span style="color:#7F848E;font-style:italic">// @@eval</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">// @@filename Async Observable</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">// @@filename Async Observables</span></span>
<span class="line"><span style="color:#C678DD">import</span><span style="color:#ABB2BF"> { </span><span style="color:#E06C75">Observable</span><span style="color:#ABB2BF">, </span><span style="color:#E06C75">timeInterval</span><span style="color:#ABB2BF"> } </span><span style="color:#C678DD">from</span><span style="color:#98C379"> "rxjs"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">type</span><span style="color:#E5C07B"> User</span><span style="color:#56B6C2"> =</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E06C75">  id</span><span style="color:#ABB2BF">: </span><span style="color:#E5C07B">number</span></span>
<span class="line"><span style="color:#E06C75">  name</span><span style="color:#ABB2BF">: </span><span style="color:#E5C07B">string</span></span>
<span class="line"><span style="color:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">const</span><span style="color:#61AFEF"> fakeUserApiCall</span><span style="color:#56B6C2"> =</span><span style="color:#ABB2BF"> (): </span><span style="color:#E5C07B">Promise</span><span style="color:#ABB2BF">&#x3C;</span><span style="color:#E5C07B">User</span><span style="color:#ABB2BF">> </span><span style="color:#C678DD">=></span></span>
<span class="line"><span style="color:#C678DD">  new</span><span style="color:#E5C07B"> Promise</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75;font-style:italic">res</span><span style="color:#C678DD"> =></span></span>
<span class="line"><span style="color:#61AFEF">    setTimeout</span><span style="color:#ABB2BF">(</span></span>
<span class="line"><span style="color:#ABB2BF">      () </span><span style="color:#C678DD">=></span><span style="color:#61AFEF"> res</span><span style="color:#ABB2BF">({ </span><span style="color:#E06C75">id</span><span style="color:#ABB2BF">: </span><span style="color:#D19A66">0</span><span style="color:#ABB2BF">, </span><span style="color:#E06C75">name</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"ZA WARUDO"</span><span style="color:#ABB2BF"> }),</span></span>
<span class="line"><span style="color:#D19A66">      100</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#ABB2BF">    ),</span></span>
<span class="line"><span style="color:#ABB2BF">  )</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">const</span><span style="color:#61AFEF"> Subscription</span><span style="color:#56B6C2"> =</span><span style="color:#ABB2BF"> (</span></span>
<span class="line"><span style="color:#ABB2BF">  &#x3C;</span><span style="color:#E06C75">div</span><span style="color:#ABB2BF">></span></span>
<span class="line"><span style="color:#ABB2BF">    Hello</span><span style="color:#E06C75">&#x26;nbsp;</span></span>
<span class="line"><span style="color:#C678DD">    {</span></span>
<span class="line"><span style="color:#C678DD">      new</span><span style="color:#61AFEF"> Observable</span><span style="color:#ABB2BF">&#x3C;</span><span style="color:#E5C07B">string</span><span style="color:#ABB2BF">>(</span><span style="color:#E06C75;font-style:italic">sub</span><span style="color:#C678DD"> =></span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B">        sub</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">next</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">"..."</span><span style="color:#ABB2BF">)</span></span>
<span class="line"><span style="color:#61AFEF">        fakeUserApiCall</span><span style="color:#ABB2BF">().</span><span style="color:#61AFEF">then</span><span style="color:#ABB2BF">(</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic">          i</span><span style="color:#C678DD"> =></span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B">            sub</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">next</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">i</span><span style="color:#ABB2BF">.</span><span style="color:#E06C75">name</span><span style="color:#ABB2BF">)</span></span>
<span class="line"><span style="color:#E5C07B">            sub</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">complete</span><span style="color:#ABB2BF">()</span></span>
<span class="line"><span style="color:#ABB2BF">          },</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic">          err</span><span style="color:#C678DD"> =></span><span style="color:#E5C07B"> sub</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">error</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75">err</span><span style="color:#ABB2BF">),</span></span>
<span class="line"><span style="color:#ABB2BF">        )</span></span>
<span class="line"><span style="color:#C678DD">        return</span><span style="color:#ABB2BF"> () </span><span style="color:#C678DD">=></span><span style="color:#ABB2BF"> {}</span></span>
<span class="line"><span style="color:#ABB2BF">      })</span></span>
<span class="line"><span style="color:#C678DD">    }</span></span>
<span class="line"><span style="color:#ABB2BF">  &#x3C;/</span><span style="color:#E06C75">div</span><span style="color:#ABB2BF">></span></span>
<span class="line"><span style="color:#ABB2BF">)</span></span>
<span class="line"><span style="color:#ABB2BF">  .</span><span style="color:#61AFEF">pipe</span><span style="color:#ABB2BF">(</span><span style="color:#61AFEF">timeInterval</span><span style="color:#ABB2BF">())</span></span>
<span class="line"><span style="color:#ABB2BF">  .</span><span style="color:#61AFEF">subscribe</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">console</span><span style="color:#ABB2BF">.</span><span style="color:#E06C75">log</span><span style="color:#ABB2BF">)</span></span>
<span class="line"></span></code></div><button class="copy-to-clipboard caption">Copy</button></pre><pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><div class="code-scroller"><code class="language-tsx"><span class="line"><span style="color:#7F848E;font-style:italic">// @@eval</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">// @@filename Async RxJS</span></span>
<span class="line"><span style="color:#C678DD">import</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E06C75">  defer</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75">  from</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75">  map</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75">  startWith</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75">  timeInterval</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#ABB2BF">} </span><span style="color:#C678DD">from</span><span style="color:#98C379"> "rxjs"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">type</span><span style="color:#E5C07B"> User</span><span style="color:#56B6C2"> =</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E06C75">  id</span><span style="color:#ABB2BF">: </span><span style="color:#E5C07B">number</span></span>
<span class="line"><span style="color:#E06C75">  name</span><span style="color:#ABB2BF">: </span><span style="color:#E5C07B">string</span></span>
<span class="line"><span style="color:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">const</span><span style="color:#61AFEF"> fakeUserApiCall</span><span style="color:#56B6C2"> =</span><span style="color:#ABB2BF"> (): </span><span style="color:#E5C07B">Promise</span><span style="color:#ABB2BF">&#x3C;</span><span style="color:#E5C07B">User</span><span style="color:#ABB2BF">> </span><span style="color:#C678DD">=></span></span>
<span class="line"><span style="color:#C678DD">  new</span><span style="color:#E5C07B"> Promise</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75;font-style:italic">res</span><span style="color:#C678DD"> =></span></span>
<span class="line"><span style="color:#61AFEF">    setTimeout</span><span style="color:#ABB2BF">(</span></span>
<span class="line"><span style="color:#ABB2BF">      () </span><span style="color:#C678DD">=></span><span style="color:#61AFEF"> res</span><span style="color:#ABB2BF">({ </span><span style="color:#E06C75">id</span><span style="color:#ABB2BF">: </span><span style="color:#D19A66">0</span><span style="color:#ABB2BF">, </span><span style="color:#E06C75">name</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"ZA WARUDO"</span><span style="color:#ABB2BF"> }),</span></span>
<span class="line"><span style="color:#D19A66">      100</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#ABB2BF">    ),</span></span>
<span class="line"><span style="color:#ABB2BF">  )</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">const</span><span style="color:#61AFEF"> Subscription</span><span style="color:#56B6C2"> =</span><span style="color:#ABB2BF"> (</span></span>
<span class="line"><span style="color:#ABB2BF">  &#x3C;</span><span style="color:#E06C75">div</span><span style="color:#ABB2BF">></span></span>
<span class="line"><span style="color:#ABB2BF">    Hello</span><span style="color:#E06C75">&#x26;nbsp;</span></span>
<span class="line"><span style="color:#C678DD">    {</span><span style="color:#61AFEF">defer</span><span style="color:#ABB2BF">(() </span><span style="color:#C678DD">=></span><span style="color:#61AFEF"> from</span><span style="color:#ABB2BF">(</span><span style="color:#61AFEF">fakeUserApiCall</span><span style="color:#ABB2BF">())).</span><span style="color:#61AFEF">pipe</span><span style="color:#ABB2BF">(</span></span>
<span class="line"><span style="color:#61AFEF">      map</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75;font-style:italic">i</span><span style="color:#C678DD"> =></span><span style="color:#E5C07B"> i</span><span style="color:#ABB2BF">.</span><span style="color:#E06C75">name</span><span style="color:#ABB2BF">),</span></span>
<span class="line"><span style="color:#61AFEF">      startWith</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">"..."</span><span style="color:#ABB2BF">),</span></span>
<span class="line"><span style="color:#ABB2BF">    )</span><span style="color:#C678DD">}</span></span>
<span class="line"><span style="color:#ABB2BF">  &#x3C;/</span><span style="color:#E06C75">div</span><span style="color:#ABB2BF">></span></span>
<span class="line"><span style="color:#ABB2BF">)</span></span>
<span class="line"><span style="color:#ABB2BF">  .</span><span style="color:#61AFEF">pipe</span><span style="color:#ABB2BF">(</span><span style="color:#61AFEF">timeInterval</span><span style="color:#ABB2BF">())</span></span>
<span class="line"><span style="color:#ABB2BF">  .</span><span style="color:#61AFEF">subscribe</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">console</span><span style="color:#ABB2BF">.</span><span style="color:#E06C75">log</span><span style="color:#ABB2BF">)</span></span>
<span class="line"></span></code></div><button class="copy-to-clipboard caption">Copy</button></pre><style>
#section-basic-demos {
  --section-header-hr-start: 75%;
  --section-header-hr-stop: 100%;
}
</style><div class="flair-section"></div></section></div></main><footer></footer><script>// Smooth scrolling for browsers that don't support CSS smooth scrolling
;(() => {
  /**
   * @type {Record<string, {elem: HTMLElement, percent: number, lastEntry: null | IntersectionObserverEntry}>}
   */
  const byId = {}
  window.sectionById = byId
  /**
   * @type {(typeof byId)[string]}
   */
  let top = null
  /**
   * @type {(typeof byId)[string]}
   */
  let bottom = null

  window.addEventListener("DOMContentLoaded", () => {
    /**
     * @type {HTMLElement}
     */
    const nav = document.getElementById("toc-nav")
    const li = nav?.querySelector("li a")

    let liRatio = li.offsetHeight / nav.offsetHeight

    window.addEventListener("resize", () => {
      console.log("Resize detected")
      liRatio = li.offsetHeight / nav.offsetHeight
    })

    const setEnds = (start, end) => {
      start != null &&
        nav.style.setProperty(
          "--toc-scroll-start",
          "" + (start * 100).toFixed(0) + "%",
        )
      end != null &&
        nav.style.setProperty(
          "--toc-scroll-end",
          "" + (end * 100).toFixed(0) + "%",
        )
    }

    // use elem, its the li
    // now we have its offset from its parent
    // get percent from parent 0 edge
    // that is constant range start

    const observer = new IntersectionObserver(
      entries => {
        entries.forEach(entry => {
          const id = entry.target.getAttribute("id") ?? ""
          let cache =
            // biome-ignore lint/suspicious/noAssignInExpressions: <explanation>
            (byId[id] ||= {
              elem: document.querySelector(
                `nav li a[href="#${id}"]`,
              ),
              percent: 0,
              lastEntry: entry,
            })
          const elem = cache.elem
          cache.lastEntry = entry
          cache.percent = entry.intersectionRatio
          if (entry.isIntersecting) {
            if (entry.intersectionRatio === 1) {
              // console.log("we are golden", cache)
              // console.log("--", elem)
              if (!top) {
                // console.log("A)", elem)
                top = cache
              } else if (
                top.lastEntry.intersectionRect.top >
                  entry.intersectionRect.top ||
                top.lastEntry.time < entry.time
              ) {
                // console.log("AA)", elem)
                // this entry is above the previous top
                top = cache
              } else {
                // console.log(
                //   top.lastEntry,
                //   "does not beat",
                //   entry,
                // )
              }
              // we take full percent of offset + offset+height of LI
            } else if (
              entry.intersectionRect.y ===
                entry.rootBounds.y &&
              entry.intersectionRect.bottom ===
                entry.rootBounds.bottom
            ) {
              // console.log("B)", elem)
              top = cache
              bottom = cache
              // console.log(
              //   "this is both entering/exiting element",
              //   cache,
              // )
            } else if (entry.intersectionRect.y === 0) {
              // console.log(
              //   "this is the leaving element",
              //   cache,
              // )
              // console.log("C)", elem)
              top = cache
            } else {
              // console.log(
              //   "this is the entering element",
              //   cache,
              // )
              // console.log("D)", elem)
              bottom = cache
            }
            if (cache.percent === 0)
              elem?.parentElement?.classList.add(
                "viewtimeline-active",
              )
          } else {
            elem?.parentElement?.classList.remove(
              "viewtimeline-active",
            )
            cache.percent = 0
          }
          // console.log(entry.boundingClientRect.top)
          if (entry.boundingClientRect.top < 0) {
            // we have passed the element and are exiting, which means we are stickied. we need to set the var for our mini gradient as a ratio of relative percent of top / height
            const underWater =
              Math.abs(entry.boundingClientRect.top) /
              entry.boundingClientRect.height

            entry.target.style.setProperty(
              "--section-header-hr-progress",
              underWater,
            )
          }
        })
        if (top && bottom) {
          const a = top.elem // get corresponding LI's anchor
          const percentFromNavTop =
            a.offsetTop / a.offsetParent.offsetHeight // this is our base percent we are setting
          // now calculate the intersection ratio relative to

          const percentDiff =
            (a.offsetHeight *
              (1 - top.lastEntry.intersectionRatio)) /
            a.offsetParent.offsetHeight

          const b = bottom.elem
          const percentFromNavTopToBottom =
            (b.offsetTop + b.offsetHeight) /
            b.offsetParent.offsetHeight // this is our base percent we are setting
          // now calculate the intersection ratio relative to

          const percentDiffB =
            (b.offsetHeight *
              (1 - bottom.lastEntry.intersectionRatio)) /
            b.offsetParent.offsetHeight

          // console.log({
          //   top,
          //   bottom,
          //   percentFromNavTop,
          //   percentFromNavTopToBottom,
          //   percentDiff,
          //   percentDiffB,
          //   a,
          //   b,
          // })

          setEnds(
            percentFromNavTop + percentDiff,
            percentFromNavTopToBottom - percentDiffB,
          )
        }
        // console.log({ top, bottom })
      },
      {
        threshold: Array.from(
          { length: 10 },
          (_, i) => i / 10,
        ),
      },
    )

    // Track all sections that have an `id` applied
    document
      .querySelectorAll("#main-content-middle section[id]")
      .forEach(section => {
        observer.observe(section)
      })
  })
})()
;
;document.addEventListener("DOMContentLoaded", () => {
  try {
    const it = document.getElementById("toc-toggle")
    if (it) {
      it.checked = JSON.parse(
        localStorage.tocChecked ?? "false",
      )
      it.addEventListener("change", e => {
        localStorage.tocChecked = !!e.target.checked
      })
    }
  } catch (e) {}
  setTimeout(() => {
    document.body.classList.toggle("ready")
  }, 1)
})
;
;function copyToClipboard(text) {
  navigator.clipboard
    .writeText(text)
    .then(() => {
      // Text copied successfully
      console.log("Text copied to clipboard")
    })
    .catch(err => {
      // Error copying text
      console.error("Failed to copy text: ", err)
    })
}

/**
 * @param {HTMLElement} el
 * @param {Window} win
 */
function selectElementText(el, win) {
  win = win || window
  let doc = win.document
  /**
   * @type {Selection}
   */
  let sel
  /**
   * @type {Range}
   */
  let range

  if (win.getSelection && doc.createRange) {
    sel = win.getSelection()
    range = doc.createRange()
    range.selectNodeContents(el)
    sel.removeAllRanges()
    sel.addRange(range)
  } else if (doc.body.createTextRange) {
    range = doc.body.createTextRange()
    range.moveToElementText(el)
    range.select()
  }
  console.log(sel.toString())
  return sel.toString()
}

document.addEventListener("click", e => {
  let target =
    e.target.classList.contains("copy-to-clipboard") &&
    e.target.parentElement.classList.contains("shiki")
      ? e.target
      : null
  target = target?.parentElement.querySelector("code")
  if (target) {
    copyToClipboard(selectElementText(target))
    window.getSelection().removeAllRanges()
  }
})
;
;let isZoomin = false
let container = null
const remove = () => {
  if (!container) return
  container?.remove()
  container = null
  const it = document.querySelector(".img-zoom")
  it?.classList.toggle("img-zoom")
  isZoomin = false
}
document.addEventListener("click", e => {
  if (
    isZoomin &&
    e.target.classList.contains("img-zoom-clone-parent")
  ) {
    document
      .querySelector(".img-zoom-clone-exit")
      ?.dispatchEvent(
        new MouseEvent("click", {
          view: window,
          bubbles: true,
          cancelable: false,
        }),
      )
  }

  if (e.target.tagName === "IMG") {
    if (e.target.classList.contains("img-zoom-clone")) {
      return
    }
    if (!e.target.classList.contains("img-zoom")) {
      /**
       * @type {HTMLImageElement}
       */
      const orig = e.target
      /**
       * @type {HTMLImageElement}
       */
      const clone = e.target.cloneNode()
      clone.classList.add("img-zoom-clone")

      container = document.createElement("div")
      container.classList.add("img-zoom-clone-parent")

      const behind = document.createElement("div")
      behind.classList.add("behind")

      const exitButton = document.createElement("button")
      exitButton.classList.add("img-zoom-clone-exit")
      ;[exitButton, behind].forEach(i =>
        i.addEventListener("click", remove),
      )
      isZoomin = true

      exitButton.setAttribute("aria-role", "button")
      exitButton.setAttribute("type", "button")
      exitButton.innerHTML = "Close"

      container.appendChild(behind)
      container.appendChild(clone)
      container.appendChild(exitButton)

      document.body.appendChild(container)
      e.target.classList.toggle("img-zoom")
      requestAnimationFrame(() => {
        exitButton.focus()
      })
    }
  }
})

document.addEventListener("keyup", e => {
  if (e.key === "Escape" && isZoomin) {
    remove()
  }
})
</script>
    
    <script type='module' src='/lib/client/invokers.dom.js' demo-for='invokers.dom.js'></script>
    
    
    
    <script type='module' src='/lib/client/dialog-closeby-attribute-polyfill.dom.js' demo-for='dialog-closeby-attribute-polyfill.dom.js'></script>
    
    <script type="module" src="/lib/client/on-click-scroll.dom.ts" defer="true"></script><script type="module" src="/lib/remark_rehype/demo-runner.daemon.dom.ts" defer="true"></script></body></html>