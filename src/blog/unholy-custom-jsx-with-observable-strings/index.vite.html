<html lang="en"><head><meta name="viewport" content="width=device-width, initial-scale=1"><meta charSet="UTF-8"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><script>window.resizeIframe = function resizeIframe(obj) {
          obj.style.height = obj.contentWindow.document.documentElement.scrollHeight + 'px';
          }</script><link rel="stylesheet" href="/styles/colors.css"><link rel="stylesheet" href="/styles/fonts.css"><link rel="stylesheet" href="/styles/global.css"><link rel="stylesheet" href="/styles/nav_and_toc.css"><link rel="stylesheet" href="/styles/hex.css"><link rel="stylesheet" href="/styles/code.css"><link rel="stylesheet" href="/styles/img.css"><link rel="stylesheet" href="/shiki-twoslash.css"><title>(DRAFT) True lazy rendering with JSX and RxJS Observables (DRAFT)</title></head><body class=""><header><nav id="primary-nav" aria-label="Primary navigation"><div class="nav-links" role="tablist"><a href="/home" role="tab" class="nav-link-anchor"><span class="nav-link ">Home</span></a><a href="/resume" role="tab" class="nav-link-anchor"><span class="nav-link ">Resume</span></a><a href="/blog" role="tab" aria-selected="true" class="nav-link-anchor"><span class="nav-link active">Blog</span></a></div></nav></header><main class="body-markdown"><section id="title-and-description"><h1>(DRAFT) True lazy rendering with JSX and RxJS Observables (DRAFT)</h1><sub>2025-02-25 by Chris Hafley</sub><div id="h1-desc"><div class="f-col"><strong>DRAFT!!!</strong><em><blockquote>"Do you think God stays in heaven because he too lives in fear of what he's created?"</blockquote></em></div></div><div class="f-col f-a-center" id="tags" style="margin-bottom:24px;"><div class="responsive-hex-grid-3"><a class="hex-content caption" href="/tags/typescript" style="--hex-color:var(--color-inferno-2);">
      <div class="hex-content hex-shadow">
        <div class="hex-content-amoeba"></div>
      </div>
      <div class="hex-content-amoeba"></div>
      <span>typescript</span>
</a><a class="hex-content caption" href="/tags/javascript" style="--hex-color:var(--color-inferno-4);">
      <div class="hex-content hex-shadow">
        <div class="hex-content-amoeba"></div>
      </div>
      <div class="hex-content-amoeba"></div>
      <span>javascript</span>
</a><a class="hex-content caption" href="/tags/jsx" style="--hex-color:var(--color-inferno-6);">
      <div class="hex-content hex-shadow">
        <div class="hex-content-amoeba"></div>
      </div>
      <div class="hex-content-amoeba"></div>
      <span>jsx</span>
</a><a class="hex-content caption" href="/tags/react" style="--hex-color:var(--color-inferno-8);">
      <div class="hex-content hex-shadow">
        <div class="hex-content-amoeba"></div>
      </div>
      <div class="hex-content-amoeba"></div>
      <span>react</span>
</a><a class="hex-content caption" href="/tags/deno" style="--hex-color:var(--color-inferno-10);">
      <div class="hex-content hex-shadow">
        <div class="hex-content-amoeba"></div>
      </div>
      <div class="hex-content-amoeba"></div>
      <span>deno</span>
</a><a class="hex-content caption" href="/tags/rxjs" style="--hex-color:var(--color-inferno-12);">
      <div class="hex-content hex-shadow">
        <div class="hex-content-amoeba"></div>
      </div>
      <div class="hex-content-amoeba"></div>
      <span>rxjs</span>
</a></div></div></section><details open="true" id="section-table-of-contents"><summary id="toc-header-contents"><h2 id="table-of-contents">Table of Contents</h2><input type="checkbox" id="toc-toggle"></summary><div class="fancy-hr"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 20"><circle cx="10" cy="10" r="7" style="fill:var(--color-text);" stroke-width="2"></circle><circle cx="30" cy="10" r="9" style="fill:var(--color-text);" stroke-width="2" fill="transparent"></circle><circle cx="50" cy="10" r="7" style="fill:var(--color-text);" stroke-width="2"></circle></svg></div><nav id="toc-nav"><ol><li><a href="#section-abstract">1.  Abstract</a></li><li><a href="#section-basics">2.  Basics</a><ol><li><a href="#section-counter-demo">2.1.  Counter Demo</a></li><li><a href="#section-mic-check-1-2-3-for-if">2.2.  Mic Check 1-2-3, For + If</a></li></ol></li><li><a href="#section-state">3.  State</a></li></ol></nav></details><div id="main-content-middle"><section id="section-abstract"><h2 id="abstract"><a href="#abstract"><span class="marker">1.</span>  Abstract<div class="flair-a"></div></a><div class="flair-h"></div></h2><p>I created a jsx implementation that returns <code>Observable&#x3C;string></code> for static site generation(SSG). It uses a really simple technique to determine when a component is ready (first emit!). This round is for unsanitized html over time for my blog.</p><p>You can do both of these with this technique:
Subscribe to every next value of your html over time using...just rxjs.</p><p>Here are 4 main demos demonstrating basic jsx, sync jsx, and async jsx with observables, and async jsx with rxjs.</p><div class="code-group code-group-1"><div class="code-group-tabs" data-sticky="1" id="code-group-1"><input data-scroll-to-me=".code-group-1" type="radio" name="code-group-1" id="code-group-radio-2" checked="true"><label for="code-group-radio-2"><div class="centerino">Basic
</div></label><input data-scroll-to-me=".code-group-1" type="radio" name="code-group-1" id="code-group-radio-3"><label for="code-group-radio-3"><div class="centerino">Sync children
</div></label><input data-scroll-to-me=".code-group-1" type="radio" name="code-group-1" id="code-group-radio-4"><label for="code-group-radio-4"><div class="centerino">Async Observable
</div></label><input data-scroll-to-me=".code-group-1" type="radio" name="code-group-1" id="code-group-radio-5"><label for="code-group-radio-5"><div class="centerino">Async RxJS 
</div></label></div><pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><div class="code-scroller"><code class="language-tsx"><span class="line"><span style="color:#C678DD">export</span><span style="color:#C678DD"> default</span><span style="color:#ABB2BF"> (&#x3C;</span><span style="color:#E06C75">div</span><span style="color:#ABB2BF">>Hello World&#x3C;/</span><span style="color:#E06C75">div</span><span style="color:#ABB2BF">>).</span><span style="color:#61AFEF">subscribe</span><span style="color:#ABB2BF">(</span></span>
<span class="line"><span style="color:#E5C07B">  console</span><span style="color:#ABB2BF">.</span><span style="color:#E06C75">log</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#ABB2BF">)</span></span></code></div><button class="copy-to-clipboard caption">Copy</button><details class="console.log-details" open="1"><summary class="log-grid-heading">console.log[1]</summary><code class="console.log-output"><span class="log-line">log(1)</span><span class="log-line">&#x3C;div>Hello World&#x3C;/div></span></code></details></pre><pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><div class="code-scroller"><code class="language-tsx"><span class="line"><span style="color:#C678DD">import</span><span style="color:#ABB2BF"> { </span><span style="color:#E06C75">of</span><span style="color:#ABB2BF"> } </span><span style="color:#C678DD">from</span><span style="color:#98C379"> "rxjs"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">const</span><span style="color:#E5C07B"> children</span><span style="color:#56B6C2"> =</span><span style="color:#61AFEF"> of</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">"Hello World"</span><span style="color:#ABB2BF">, </span><span style="color:#98C379">"It was me, DIO"</span><span style="color:#ABB2BF">)</span></span>
<span class="line"><span style="color:#ABB2BF">;(&#x3C;</span><span style="color:#E06C75">div</span><span style="color:#ABB2BF">></span><span style="color:#C678DD">{</span><span style="color:#E06C75">children</span><span style="color:#C678DD">}</span><span style="color:#ABB2BF">&#x3C;/</span><span style="color:#E06C75">div</span><span style="color:#ABB2BF">>).</span><span style="color:#61AFEF">subscribe</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">console</span><span style="color:#ABB2BF">.</span><span style="color:#E06C75">log</span><span style="color:#ABB2BF">)</span></span></code></div><button class="copy-to-clipboard caption">Copy</button><details class="console.log-details" open="1"><summary class="log-grid-heading">console.log[2]</summary><code class="console.log-output"><span class="log-line">log(1)</span><span class="log-line">&#x3C;div>Hello World&#x3C;/div></span><span class="log-line">log(2)</span><span class="log-line">&#x3C;div>It was me, DIO&#x3C;/div></span></code></details></pre><pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><div class="code-scroller"><code class="language-tsx"><span class="line"><span style="color:#C678DD">import</span><span style="color:#ABB2BF"> { </span><span style="color:#E06C75">Observable</span><span style="color:#ABB2BF">, </span><span style="color:#E06C75">timeInterval</span><span style="color:#ABB2BF"> } </span><span style="color:#C678DD">from</span><span style="color:#98C379"> "rxjs"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">type</span><span style="color:#E5C07B"> User</span><span style="color:#56B6C2"> =</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E06C75">  id</span><span style="color:#ABB2BF">: </span><span style="color:#E5C07B">number</span></span>
<span class="line"><span style="color:#E06C75">  name</span><span style="color:#ABB2BF">: </span><span style="color:#E5C07B">string</span></span>
<span class="line"><span style="color:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">const</span><span style="color:#61AFEF"> fakeUserApiCall</span><span style="color:#56B6C2"> =</span><span style="color:#ABB2BF"> (): </span><span style="color:#E5C07B">Promise</span><span style="color:#ABB2BF">&#x3C;</span><span style="color:#E5C07B">User</span><span style="color:#ABB2BF">> </span><span style="color:#C678DD">=></span></span>
<span class="line"><span style="color:#C678DD">  new</span><span style="color:#E5C07B"> Promise</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75;font-style:italic">res</span><span style="color:#C678DD"> =></span></span>
<span class="line"><span style="color:#61AFEF">    setTimeout</span><span style="color:#ABB2BF">(</span></span>
<span class="line"><span style="color:#ABB2BF">      () </span><span style="color:#C678DD">=></span><span style="color:#61AFEF"> res</span><span style="color:#ABB2BF">({ </span><span style="color:#E06C75">id</span><span style="color:#ABB2BF">: </span><span style="color:#D19A66">0</span><span style="color:#ABB2BF">, </span><span style="color:#E06C75">name</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"ZA WARUDO"</span><span style="color:#ABB2BF"> }),</span></span>
<span class="line"><span style="color:#D19A66">      100</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#ABB2BF">    ),</span></span>
<span class="line"><span style="color:#ABB2BF">  )</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">const</span><span style="color:#61AFEF"> Subscription</span><span style="color:#56B6C2"> =</span><span style="color:#ABB2BF"> (</span></span>
<span class="line"><span style="color:#ABB2BF">  &#x3C;</span><span style="color:#E06C75">div</span><span style="color:#ABB2BF">></span></span>
<span class="line"><span style="color:#ABB2BF">    Hello</span><span style="color:#E06C75">&#x26;nbsp;</span></span>
<span class="line"><span style="color:#C678DD">    {</span></span>
<span class="line"><span style="color:#C678DD">      new</span><span style="color:#61AFEF"> Observable</span><span style="color:#ABB2BF">&#x3C;</span><span style="color:#E5C07B">string</span><span style="color:#ABB2BF">>(</span><span style="color:#E06C75;font-style:italic">sub</span><span style="color:#C678DD"> =></span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B">        sub</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">next</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">"..."</span><span style="color:#ABB2BF">)</span></span>
<span class="line"><span style="color:#61AFEF">        fakeUserApiCall</span><span style="color:#ABB2BF">().</span><span style="color:#61AFEF">then</span><span style="color:#ABB2BF">(</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic">          i</span><span style="color:#C678DD"> =></span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B">            sub</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">next</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">i</span><span style="color:#ABB2BF">.</span><span style="color:#E06C75">name</span><span style="color:#ABB2BF">)</span></span>
<span class="line"><span style="color:#E5C07B">            sub</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">complete</span><span style="color:#ABB2BF">()</span></span>
<span class="line"><span style="color:#ABB2BF">          },</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic">          err</span><span style="color:#C678DD"> =></span><span style="color:#E5C07B"> sub</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">error</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75">err</span><span style="color:#ABB2BF">),</span></span>
<span class="line"><span style="color:#ABB2BF">        )</span></span>
<span class="line"><span style="color:#C678DD">        return</span><span style="color:#ABB2BF"> () </span><span style="color:#C678DD">=></span><span style="color:#ABB2BF"> {}</span></span>
<span class="line"><span style="color:#ABB2BF">      })</span></span>
<span class="line"><span style="color:#C678DD">    }</span></span>
<span class="line"><span style="color:#ABB2BF">  &#x3C;/</span><span style="color:#E06C75">div</span><span style="color:#ABB2BF">></span></span>
<span class="line"><span style="color:#ABB2BF">)</span></span>
<span class="line"><span style="color:#ABB2BF">  .</span><span style="color:#61AFEF">pipe</span><span style="color:#ABB2BF">(</span><span style="color:#61AFEF">timeInterval</span><span style="color:#ABB2BF">())</span></span>
<span class="line"><span style="color:#ABB2BF">  .</span><span style="color:#61AFEF">subscribe</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">console</span><span style="color:#ABB2BF">.</span><span style="color:#E06C75">log</span><span style="color:#ABB2BF">)</span></span></code></div><button class="copy-to-clipboard caption">Copy</button><details class="console.log-details" open="1"><summary class="log-grid-heading">console.log[2]</summary><code class="console.log-output"><span class="log-line">log(1)</span><span class="log-line">TimeInterval { value: "&#x3C;div>Hello ...&#x3C;/div>", interval: 4 }</span><span class="log-line">log(2)</span><span class="log-line">TimeInterval { value: "&#x3C;div>Hello ZA WARUDO&#x3C;/div>", interval: 100 }</span></code></details></pre><pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><div class="code-scroller"><code class="language-tsx"><span class="line"><span style="color:#C678DD">import</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E06C75">  defer</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75">  from</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75">  map</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75">  startWith</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75">  timeInterval</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#ABB2BF">} </span><span style="color:#C678DD">from</span><span style="color:#98C379"> "rxjs"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">type</span><span style="color:#E5C07B"> User</span><span style="color:#56B6C2"> =</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E06C75">  id</span><span style="color:#ABB2BF">: </span><span style="color:#E5C07B">number</span></span>
<span class="line"><span style="color:#E06C75">  name</span><span style="color:#ABB2BF">: </span><span style="color:#E5C07B">string</span></span>
<span class="line"><span style="color:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">const</span><span style="color:#61AFEF"> fakeUserApiCall</span><span style="color:#56B6C2"> =</span><span style="color:#ABB2BF"> (): </span><span style="color:#E5C07B">Promise</span><span style="color:#ABB2BF">&#x3C;</span><span style="color:#E5C07B">User</span><span style="color:#ABB2BF">> </span><span style="color:#C678DD">=></span></span>
<span class="line"><span style="color:#C678DD">  new</span><span style="color:#E5C07B"> Promise</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75;font-style:italic">res</span><span style="color:#C678DD"> =></span></span>
<span class="line"><span style="color:#61AFEF">    setTimeout</span><span style="color:#ABB2BF">(</span></span>
<span class="line"><span style="color:#ABB2BF">      () </span><span style="color:#C678DD">=></span><span style="color:#61AFEF"> res</span><span style="color:#ABB2BF">({ </span><span style="color:#E06C75">id</span><span style="color:#ABB2BF">: </span><span style="color:#D19A66">0</span><span style="color:#ABB2BF">, </span><span style="color:#E06C75">name</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"ZA WARUDO"</span><span style="color:#ABB2BF"> }),</span></span>
<span class="line"><span style="color:#D19A66">      100</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#ABB2BF">    ),</span></span>
<span class="line"><span style="color:#ABB2BF">  )</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">const</span><span style="color:#61AFEF"> Subscription</span><span style="color:#56B6C2"> =</span><span style="color:#ABB2BF"> (</span></span>
<span class="line"><span style="color:#ABB2BF">  &#x3C;</span><span style="color:#E06C75">div</span><span style="color:#ABB2BF">></span></span>
<span class="line"><span style="color:#ABB2BF">    Hello</span><span style="color:#E06C75">&#x26;nbsp;</span></span>
<span class="line"><span style="color:#C678DD">    {</span><span style="color:#61AFEF">defer</span><span style="color:#ABB2BF">(() </span><span style="color:#C678DD">=></span><span style="color:#61AFEF"> from</span><span style="color:#ABB2BF">(</span><span style="color:#61AFEF">fakeUserApiCall</span><span style="color:#ABB2BF">())).</span><span style="color:#61AFEF">pipe</span><span style="color:#ABB2BF">(</span></span>
<span class="line"><span style="color:#61AFEF">      map</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75;font-style:italic">i</span><span style="color:#C678DD"> =></span><span style="color:#E5C07B"> i</span><span style="color:#ABB2BF">.</span><span style="color:#E06C75">name</span><span style="color:#ABB2BF">),</span></span>
<span class="line"><span style="color:#61AFEF">      startWith</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">"..."</span><span style="color:#ABB2BF">),</span></span>
<span class="line"><span style="color:#ABB2BF">    )</span><span style="color:#C678DD">}</span></span>
<span class="line"><span style="color:#ABB2BF">  &#x3C;/</span><span style="color:#E06C75">div</span><span style="color:#ABB2BF">></span></span>
<span class="line"><span style="color:#ABB2BF">)</span></span>
<span class="line"><span style="color:#ABB2BF">  .</span><span style="color:#61AFEF">pipe</span><span style="color:#ABB2BF">(</span><span style="color:#61AFEF">timeInterval</span><span style="color:#ABB2BF">())</span></span>
<span class="line"><span style="color:#ABB2BF">  .</span><span style="color:#61AFEF">subscribe</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">console</span><span style="color:#ABB2BF">.</span><span style="color:#E06C75">log</span><span style="color:#ABB2BF">)</span></span></code></div><button class="copy-to-clipboard caption">Copy</button><details class="console.log-details" open="1"><summary class="log-grid-heading">console.log[2]</summary><code class="console.log-output"><span class="log-line">log(1)</span><span class="log-line">TimeInterval { value: "&#x3C;div>Hello ...&#x3C;/div>", interval: 4 }</span><span class="log-line">log(2)</span><span class="log-line">TimeInterval { value: "&#x3C;div>Hello ZA WARUDO&#x3C;/div>", interval: 101 }</span></code></details></pre><div class="demo-iframe" id="demo-iframe-code-group-1"></div><script>
            //{}
document.addEventListener('DOMContentLoaded', () => {
  const tabs = document.getElementById("code-group-1");
  const demoContainer = document.getElementById("demo-iframe-code-group-1");
  const toDemoArea = (src) => {
    demoContainer.children[0]?.remove();
    const iframe = document.createElement('iframe');
    iframe.style.width = 'calc(100%)';
    iframe.onload=function(){ window.resizeIframe(this)};
    
    iframe.onload = function() {
      const iframeWindow = iframe.contentWindow;
      const doc = iframe.contentDocument || iframeWindow.document;

      doc.open();
      doc.write(`
        <html style='height: fit-content;'>
          <head>
            <style>
            <\/style>
          <\/head>
          <body style='margin: 4px; height: fit-content;'>
          <\/body>
          <script type="module" src="${src}"><\/script>
          <script>
              (function() {
                const observer = new MutationObserver(() => {
                  // Adjust the height of the parent iframe based on the body's height
                  window.frameElement.style.height = (document.documentElement.offsetHeight + 1) +'px';
                });

                // Start observing changes in the body element
                observer.observe(document.body, { childList: true, subtree: true, attributes: true });

                // Initial setting of height
                window.frameElement.style.height = (document.documentElement.offsetHeight + 1) + 'px';
              })();
            <\/script>
        <\/html>
      `);
      doc.close();
    };
    // iframe.style.cssText="width:100%;";
    demoContainer.appendChild(iframe);
    // const doc = iframe.contentDocument || iframe.contentWindow?.document;
    // doc.open();
    // doc.write(`
    //   
    //   <head></head>
    //   
    //     
    //   </body>
    //   </html>
    // `);
    // doc.close();
  };


});
</script><style>
.code-group pre {display:none}
.code-group-1 {

  #code-group-radio-2+label {

  }

  #code-group-radio-2:checked+label {
    background:#282c34;
    position: relative;
    z-index:1;
    border-bottom: none;
    
    &:hover {
      text-decoration: underline;
      color: white;
    }

    border-top-color: var(--color-blue-500);

    &::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 6px;
      z-index: 10;
      width: 100%; 
      background: var(--color-blue-500);
    }

  }

  &:has(#code-group-radio-2:checked) pre:nth-child(2){ 
    display: block;
  }
  

  #code-group-radio-3+label {

  }

  #code-group-radio-3:checked+label {
    background:#282c34;
    position: relative;
    z-index:1;
    border-bottom: none;
    
    &:hover {
      text-decoration: underline;
      color: white;
    }

    border-top-color: var(--color-blue-500);

    &::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 6px;
      z-index: 10;
      width: 100%; 
      background: var(--color-blue-500);
    }

  }

  &:has(#code-group-radio-3:checked) pre:nth-child(3){ 
    display: block;
  }
  

  #code-group-radio-4+label {

  }

  #code-group-radio-4:checked+label {
    background:#282c34;
    position: relative;
    z-index:1;
    border-bottom: none;
    
    &:hover {
      text-decoration: underline;
      color: white;
    }

    border-top-color: var(--color-blue-500);

    &::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 6px;
      z-index: 10;
      width: 100%; 
      background: var(--color-blue-500);
    }

  }

  &:has(#code-group-radio-4:checked) pre:nth-child(4){ 
    display: block;
  }
  

  #code-group-radio-5+label {

  }

  #code-group-radio-5:checked+label {
    background:#282c34;
    position: relative;
    z-index:1;
    border-bottom: none;
    
    &:hover {
      text-decoration: underline;
      color: white;
    }

    border-top-color: var(--color-blue-500);

    &::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 6px;
      z-index: 10;
      width: 100%; 
      background: var(--color-blue-500);
    }

  }

  &:has(#code-group-radio-5:checked) pre:nth-child(5){ 
    display: block;
  }
  
} </style></div><style>
#section-abstract {
  --section-header-hr-start: 0%;
  --section-header-hr-stop: 20%;
}
</style><div class="flair-section"></div></section>
<section id="section-basics"><h2 id="basics"><a href="#basics"><span class="marker">2.</span>  Basics<div class="flair-a"></div></a><div class="flair-h"></div></h2><p>In this jsx transform, thie children types are</p><pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><div class="code-scroller"><code class="language-ts"><span class="line"><span style="color:#C678DD">type</span><span style="color:#E5C07B"> Element</span><span style="color:#56B6C2"> =</span><span style="color:#E5C07B"> Array</span><span style="color:#ABB2BF">&#x3C;</span></span>
<span class="line"><span style="color:#ABB2BF">  | </span><span style="color:#E5C07B">string</span><span style="color:#ABB2BF"> </span></span>
<span class="line"><span style="color:#ABB2BF">  | </span><span style="color:#E5C07B">number</span><span style="color:#ABB2BF"> </span></span>
<span class="line"><span style="color:#ABB2BF">  | </span><span style="color:#E5C07B">boolean</span><span style="color:#ABB2BF"> </span></span>
<span class="line"><span style="color:#ABB2BF">  | </span><span style="color:#E5C07B">Observable</span><span style="color:#ABB2BF">&#x3C;</span></span>
<span class="line"><span style="color:#ABB2BF">      | </span><span style="color:#E5C07B">string</span><span style="color:#ABB2BF"> </span></span>
<span class="line"><span style="color:#ABB2BF">      | </span><span style="color:#E5C07B">number</span><span style="color:#ABB2BF"> </span></span>
<span class="line"><span style="color:#ABB2BF">      | </span><span style="color:#E5C07B">boolean</span></span>
<span class="line"><span style="color:#ABB2BF">    ></span></span>
<span class="line"><span style="color:#ABB2BF">  ></span></span></code></div><button class="copy-to-clipboard caption">Copy</button></pre><p>This means you can do anything with rxjs as a child, so long as it results in a string over time.</p><style>
#section-basics {
  --section-header-hr-start: 20%;
  --section-header-hr-stop: 40%;
}
</style><div class="flair-section"></div></section>
<section id="section-counter-demo"><h3 id="counter-demo"><a href="#counter-demo"><span class="marker">2.1.</span>  Counter Demo<div class="flair-a"></div></a><div class="flair-h"></div></h3><p>To demonstrate what I mean as fast as possible, we can take <code>RsJS.interval</code> function and use it to create an inline timer that fires its next value every 1 second.</p><div class="code-group code-group-2"><div class="code-group-tabs" data-sticky="1" id="code-group-2"><input data-scroll-to-me=".code-group-2" type="radio" name="code-group-2" id="code-group-radio-6" checked="true"><label for="code-group-radio-6"><div class="centerino">5_interval.dom.tsx
</div></label><input data-scroll-to-me=".code-group-2" type="radio" name="code-group-2" id="code-group-radio-7"><label for="code-group-radio-7"><div class="centerino">6_interval.dom.tsx
</div></label></div><pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><div class="code-scroller"><code class="language-tsx"><span class="line"><span style="color:#C678DD">import</span><span style="color:#ABB2BF"> { </span><span style="color:#E06C75">interval</span><span style="color:#ABB2BF">, </span><span style="color:#E06C75">map</span><span style="color:#ABB2BF"> } </span><span style="color:#C678DD">from</span><span style="color:#98C379"> "rxjs"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">export</span><span style="color:#C678DD"> const</span><span style="color:#61AFEF"> main</span><span style="color:#56B6C2"> =</span><span style="color:#ABB2BF"> (</span></span>
<span class="line"><span style="color:#ABB2BF">  &#x3C;</span><span style="color:#E06C75">div</span><span style="color:#D19A66;font-style:italic"> style</span><span style="color:#56B6C2">=</span><span style="color:#C678DD">{</span><span style="color:#ABB2BF">{ </span><span style="color:#E06C75">background</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"red"</span><span style="color:#ABB2BF">, </span><span style="color:#E06C75">color</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"white"</span><span style="color:#ABB2BF"> }</span><span style="color:#C678DD">}</span><span style="color:#ABB2BF">></span></span>
<span class="line"><span style="color:#C678DD">    {</span><span style="color:#61AFEF">interval</span><span style="color:#ABB2BF">(</span><span style="color:#D19A66">1000</span><span style="color:#ABB2BF">).</span><span style="color:#61AFEF">pipe</span><span style="color:#ABB2BF">(</span><span style="color:#61AFEF">map</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75">String</span><span style="color:#ABB2BF">))</span><span style="color:#C678DD">}</span></span>
<span class="line"><span style="color:#E06C75">    &#x26;nbsp;</span><span style="color:#ABB2BF">seconds since mount/subscribe</span></span>
<span class="line"><span style="color:#ABB2BF">  &#x3C;/</span><span style="color:#E06C75">div</span><span style="color:#ABB2BF">></span></span>
<span class="line"><span style="color:#ABB2BF">)</span></span></code></div><button class="copy-to-clipboard caption">Copy</button></pre><pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><div class="code-scroller"><code class="language-tsx"><span class="line"><span style="color:#C678DD">import</span><span style="color:#ABB2BF"> { </span><span style="color:#E06C75">interval</span><span style="color:#ABB2BF">, </span><span style="color:#E06C75">map</span><span style="color:#ABB2BF"> } </span><span style="color:#C678DD">from</span><span style="color:#98C379"> "rxjs"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">export</span><span style="color:#C678DD"> const</span><span style="color:#61AFEF"> main</span><span style="color:#56B6C2"> =</span><span style="color:#ABB2BF"> (</span></span>
<span class="line"><span style="color:#ABB2BF">  &#x3C;</span><span style="color:#E06C75">div</span><span style="color:#D19A66;font-style:italic"> style</span><span style="color:#56B6C2">=</span><span style="color:#C678DD">{</span><span style="color:#ABB2BF">{ </span><span style="color:#E06C75">background</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"blue"</span><span style="color:#ABB2BF">, </span><span style="color:#E06C75">color</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"white"</span><span style="color:#ABB2BF"> }</span><span style="color:#C678DD">}</span><span style="color:#ABB2BF">></span></span>
<span class="line"><span style="color:#C678DD">    {</span><span style="color:#61AFEF">interval</span><span style="color:#ABB2BF">(</span><span style="color:#D19A66">1000</span><span style="color:#ABB2BF">).</span><span style="color:#61AFEF">pipe</span><span style="color:#ABB2BF">(</span><span style="color:#61AFEF">map</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75">String</span><span style="color:#ABB2BF">))</span><span style="color:#C678DD">}</span></span>
<span class="line"><span style="color:#E06C75">    &#x26;nbsp;</span><span style="color:#ABB2BF">seconds since mount/subscribe</span></span>
<span class="line"><span style="color:#ABB2BF">  &#x3C;/</span><span style="color:#E06C75">div</span><span style="color:#ABB2BF">></span></span>
<span class="line"><span style="color:#ABB2BF">)</span></span></code></div><button class="copy-to-clipboard caption">Copy</button></pre><div class="demo-iframe" id="demo-iframe-code-group-2"></div><script>
            //{"code-group-radio-6":"/blog/unholy-custom-jsx-with-observable-strings/5_interval.dom.tsx","code-group-radio-7":"/blog/unholy-custom-jsx-with-observable-strings/6_interval.dom.tsx"}
document.addEventListener('DOMContentLoaded', () => {
  const tabs = document.getElementById("code-group-2");
  const demoContainer = document.getElementById("demo-iframe-code-group-2");
  const toDemoArea = (src) => {
    demoContainer.children[0]?.remove();
    const iframe = document.createElement('iframe');
    iframe.style.width = 'calc(100%)';
    iframe.onload=function(){ window.resizeIframe(this)};
    
    iframe.onload = function() {
      const iframeWindow = iframe.contentWindow;
      const doc = iframe.contentDocument || iframeWindow.document;

      doc.open();
      doc.write(`
        <html style='height: fit-content;'>
          <head>
            <style>
            <\/style>
          <\/head>
          <body style='margin: 4px; height: fit-content;'>
          <\/body>
          <script type="module" src="${src}"><\/script>
          <script>
              (function() {
                const observer = new MutationObserver(() => {
                  // Adjust the height of the parent iframe based on the body's height
                  window.frameElement.style.height = (document.documentElement.offsetHeight + 1) +'px';
                });

                // Start observing changes in the body element
                observer.observe(document.body, { childList: true, subtree: true, attributes: true });

                // Initial setting of height
                window.frameElement.style.height = (document.documentElement.offsetHeight + 1) + 'px';
              })();
            <\/script>
        <\/html>
      `);
      doc.close();
    };
    // iframe.style.cssText="width:100%;";
    demoContainer.appendChild(iframe);
    // const doc = iframe.contentDocument || iframe.contentWindow?.document;
    // doc.open();
    // doc.write(`
    //   
    //   <head></head>
    //   
    //     
    //   </body>
    //   </html>
    // `);
    // doc.close();
  };


  const id0 = document.getElementById('code-group-radio-6');
  id0.addEventListener('input', e => {
    if(e.target.checked) {
      toDemoArea("/blog/unholy-custom-jsx-with-observable-strings/5_interval.dom.tsx")
    }
  });
  if(id0.checked) {
    console.log("I am checked...", id0);
    toDemoArea("/blog/unholy-custom-jsx-with-observable-strings/5_interval.dom.tsx")
  }
  

  const id1 = document.getElementById('code-group-radio-7');
  id1.addEventListener('input', e => {
    if(e.target.checked) {
      toDemoArea("/blog/unholy-custom-jsx-with-observable-strings/6_interval.dom.tsx")
    }
  });
  if(id1.checked) {
    console.log("I am checked...", id1);
    toDemoArea("/blog/unholy-custom-jsx-with-observable-strings/6_interval.dom.tsx")
  }
  
});
</script><style>
.code-group pre {display:none}
.code-group-2 {

  #code-group-radio-6+label {

  }

  #code-group-radio-6:checked+label {
    background:#282c34;
    position: relative;
    z-index:1;
    border-bottom: none;
    
    &:hover {
      text-decoration: underline;
      color: white;
    }

    border-top-color: var(--color-blue-500);

    &::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 6px;
      z-index: 10;
      width: 100%; 
      background: var(--color-blue-500);
    }

  }

  &:has(#code-group-radio-6:checked) pre:nth-child(2){ 
    display: block;
  }
  

  #code-group-radio-7+label {

  }

  #code-group-radio-7:checked+label {
    background:#282c34;
    position: relative;
    z-index:1;
    border-bottom: none;
    
    &:hover {
      text-decoration: underline;
      color: white;
    }

    border-top-color: var(--color-blue-500);

    &::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 6px;
      z-index: 10;
      width: 100%; 
      background: var(--color-blue-500);
    }

  }

  &:has(#code-group-radio-7:checked) pre:nth-child(3){ 
    display: block;
  }
  
} </style></div><style>
#section-counter-demo {
  --section-header-hr-start: 40%;
  --section-header-hr-stop: 60%;
}
</style><div class="flair-section"></div></section>
<section id="section-mic-check-1-2-3-for-if"><h3 id="mic-check-1-2-3-for-if"><a href="#mic-check-1-2-3-for-if"><span class="marker">2.2.</span>  Mic Check 1-2-3, For + If<div class="flair-a"></div></a><div class="flair-h"></div></h3><p>Okay and lets make sure that doing regular array map's into jsx work as expected, as well as conditionals.</p><div class="code-group code-group-3"><div class="code-group-tabs" data-sticky="1" id="code-group-3"><input data-scroll-to-me=".code-group-3" type="radio" name="code-group-3" id="code-group-radio-8" checked="true"><label for="code-group-radio-8"><div class="centerino">Array Map
</div></label><input data-scroll-to-me=".code-group-3" type="radio" name="code-group-3" id="code-group-radio-9"><label for="code-group-radio-9"><div class="centerino">Conditional Render
</div></label></div><pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><div class="code-scroller"><code class="language-tsx"><span class="line"><span style="color:#C678DD">const</span><span style="color:#E5C07B"> navItems</span><span style="color:#56B6C2"> =</span><span style="color:#ABB2BF"> [</span></span>
<span class="line"><span style="color:#98C379">  "home"</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#98C379">  "resume"</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#98C379">  "blog"</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#98C379">  "tags"</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#98C379">  "projects"</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#ABB2BF">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">export</span><span style="color:#C678DD"> const</span><span style="color:#61AFEF"> main</span><span style="color:#56B6C2"> =</span><span style="color:#ABB2BF"> (</span></span>
<span class="line"><span style="color:#ABB2BF">  &#x3C;</span><span style="color:#E06C75">nav</span><span style="color:#D19A66;font-style:italic"> style</span><span style="color:#56B6C2">=</span><span style="color:#C678DD">{</span><span style="color:#ABB2BF">{ </span><span style="color:#E06C75">background</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"purple"</span><span style="color:#ABB2BF">, </span><span style="color:#E06C75">color</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"white"</span><span style="color:#ABB2BF"> }</span><span style="color:#C678DD">}</span><span style="color:#ABB2BF">></span></span>
<span class="line"><span style="color:#ABB2BF">    Primary Nav:</span></span>
<span class="line"><span style="color:#ABB2BF">    &#x3C;</span><span style="color:#E06C75">ul</span><span style="color:#ABB2BF">></span></span>
<span class="line"><span style="color:#C678DD">      {</span><span style="color:#E5C07B">navItems</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">map</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75;font-style:italic">it</span><span style="color:#C678DD"> =></span><span style="color:#ABB2BF"> (</span></span>
<span class="line"><span style="color:#ABB2BF">        &#x3C;</span><span style="color:#E06C75">li</span><span style="color:#D19A66;font-style:italic"> key</span><span style="color:#56B6C2">=</span><span style="color:#C678DD">{</span><span style="color:#E06C75">it</span><span style="color:#C678DD">}</span><span style="color:#ABB2BF">></span><span style="color:#C678DD">{</span><span style="color:#E06C75">it</span><span style="color:#C678DD">}</span><span style="color:#ABB2BF">&#x3C;/</span><span style="color:#E06C75">li</span><span style="color:#ABB2BF">></span></span>
<span class="line"><span style="color:#ABB2BF">      ))</span><span style="color:#C678DD">}</span></span>
<span class="line"><span style="color:#ABB2BF">    &#x3C;/</span><span style="color:#E06C75">ul</span><span style="color:#ABB2BF">></span></span>
<span class="line"><span style="color:#ABB2BF">  &#x3C;/</span><span style="color:#E06C75">nav</span><span style="color:#ABB2BF">></span></span>
<span class="line"><span style="color:#ABB2BF">)</span></span></code></div><button class="copy-to-clipboard caption">Copy</button></pre><pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><div class="code-scroller"><code class="language-tsx"><span class="line"><span style="color:#C678DD">export</span><span style="color:#C678DD"> const</span><span style="color:#61AFEF"> main</span><span style="color:#56B6C2"> =</span><span style="color:#ABB2BF"> (</span></span>
<span class="line"><span style="color:#ABB2BF">  &#x3C;</span><span style="color:#E06C75">div</span><span style="color:#D19A66;font-style:italic"> style</span><span style="color:#56B6C2">=</span><span style="color:#C678DD">{</span><span style="color:#ABB2BF">{ </span><span style="color:#E06C75">background</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"red"</span><span style="color:#ABB2BF">, </span><span style="color:#E06C75">color</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"white"</span><span style="color:#ABB2BF"> }</span><span style="color:#C678DD">}</span><span style="color:#ABB2BF">></span></span>
<span class="line"><span style="color:#C678DD">    {</span><span style="color:#D19A66">true</span><span style="color:#C678DD"> ?</span><span style="color:#98C379"> "Yes "</span><span style="color:#C678DD"> :</span><span style="color:#98C379"> "No "</span><span style="color:#C678DD">}</span></span>
<span class="line"><span style="color:#C678DD">    {</span><span style="color:#D19A66">false</span><span style="color:#C678DD"> ?</span><span style="color:#98C379"> "Yay "</span><span style="color:#C678DD"> :</span><span style="color:#98C379"> "Nay "</span><span style="color:#C678DD">}</span></span>
<span class="line"><span style="color:#ABB2BF">  &#x3C;/</span><span style="color:#E06C75">div</span><span style="color:#ABB2BF">></span></span>
<span class="line"><span style="color:#ABB2BF">)</span></span></code></div><button class="copy-to-clipboard caption">Copy</button></pre><div class="demo-iframe" id="demo-iframe-code-group-3"></div><script>
            //{"code-group-radio-8":"/blog/unholy-custom-jsx-with-observable-strings/7.array_map.dom.tsx","code-group-radio-9":"/blog/unholy-custom-jsx-with-observable-strings/8.conditional.dom.tsx"}
document.addEventListener('DOMContentLoaded', () => {
  const tabs = document.getElementById("code-group-3");
  const demoContainer = document.getElementById("demo-iframe-code-group-3");
  const toDemoArea = (src) => {
    demoContainer.children[0]?.remove();
    const iframe = document.createElement('iframe');
    iframe.style.width = 'calc(100%)';
    iframe.onload=function(){ window.resizeIframe(this)};
    
    iframe.onload = function() {
      const iframeWindow = iframe.contentWindow;
      const doc = iframe.contentDocument || iframeWindow.document;

      doc.open();
      doc.write(`
        <html style='height: fit-content;'>
          <head>
            <style>
            <\/style>
          <\/head>
          <body style='margin: 4px; height: fit-content;'>
          <\/body>
          <script type="module" src="${src}"><\/script>
          <script>
              (function() {
                const observer = new MutationObserver(() => {
                  // Adjust the height of the parent iframe based on the body's height
                  window.frameElement.style.height = (document.documentElement.offsetHeight + 1) +'px';
                });

                // Start observing changes in the body element
                observer.observe(document.body, { childList: true, subtree: true, attributes: true });

                // Initial setting of height
                window.frameElement.style.height = (document.documentElement.offsetHeight + 1) + 'px';
              })();
            <\/script>
        <\/html>
      `);
      doc.close();
    };
    // iframe.style.cssText="width:100%;";
    demoContainer.appendChild(iframe);
    // const doc = iframe.contentDocument || iframe.contentWindow?.document;
    // doc.open();
    // doc.write(`
    //   
    //   <head></head>
    //   
    //     
    //   </body>
    //   </html>
    // `);
    // doc.close();
  };


  const id0 = document.getElementById('code-group-radio-8');
  id0.addEventListener('input', e => {
    if(e.target.checked) {
      toDemoArea("/blog/unholy-custom-jsx-with-observable-strings/7.array_map.dom.tsx")
    }
  });
  if(id0.checked) {
    console.log("I am checked...", id0);
    toDemoArea("/blog/unholy-custom-jsx-with-observable-strings/7.array_map.dom.tsx")
  }
  

  const id1 = document.getElementById('code-group-radio-9');
  id1.addEventListener('input', e => {
    if(e.target.checked) {
      toDemoArea("/blog/unholy-custom-jsx-with-observable-strings/8.conditional.dom.tsx")
    }
  });
  if(id1.checked) {
    console.log("I am checked...", id1);
    toDemoArea("/blog/unholy-custom-jsx-with-observable-strings/8.conditional.dom.tsx")
  }
  
});
</script><style>
.code-group pre {display:none}
.code-group-3 {

  #code-group-radio-8+label {

  }

  #code-group-radio-8:checked+label {
    background:#282c34;
    position: relative;
    z-index:1;
    border-bottom: none;
    
    &:hover {
      text-decoration: underline;
      color: white;
    }

    border-top-color: var(--color-blue-500);

    &::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 6px;
      z-index: 10;
      width: 100%; 
      background: var(--color-blue-500);
    }

  }

  &:has(#code-group-radio-8:checked) pre:nth-child(2){ 
    display: block;
  }
  

  #code-group-radio-9+label {

  }

  #code-group-radio-9:checked+label {
    background:#282c34;
    position: relative;
    z-index:1;
    border-bottom: none;
    
    &:hover {
      text-decoration: underline;
      color: white;
    }

    border-top-color: var(--color-blue-500);

    &::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 6px;
      z-index: 10;
      width: 100%; 
      background: var(--color-blue-500);
    }

  }

  &:has(#code-group-radio-9:checked) pre:nth-child(3){ 
    display: block;
  }
  
} </style></div><style>
#section-mic-check-1-2-3-for-if {
  --section-header-hr-start: 60%;
  --section-header-hr-stop: 80%;
}
</style><div class="flair-section"></div></section>
<section id="section-state"><h2 id="state"><a href="#state"><span class="marker">3.</span>  State<div class="flair-a"></div></a><div class="flair-h"></div></h2><p>For idiomatic RxJS, I heavily urge you to avoid BehaviorSubject as much as possible. BUT, it exists for a reason, and when you are starting out, you will want to use it all the time.</p><p>Just know that using it will delay you from understanding everything you see as state is really just some other observable somewhere else.</p><div class="code-group code-group-4"><div class="code-group-tabs" data-sticky="1" id="code-group-4"><input data-scroll-to-me=".code-group-4" type="radio" name="code-group-4" id="code-group-radio-10" checked="true"><label for="code-group-radio-10"><div class="centerino">With BehaviorSubject
</div></label><input data-scroll-to-me=".code-group-4" type="radio" name="code-group-4" id="code-group-radio-11"><label for="code-group-radio-11"><div class="centerino">Without BehaviorSubject
</div></label></div><pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><div class="code-scroller"><code class="language-tsx"><span class="line"></span></code></div><button class="copy-to-clipboard caption">Copy</button></pre><pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><div class="code-scroller"><code class="language-tsx"><span class="line"></span></code></div><button class="copy-to-clipboard caption">Copy</button></pre><div class="demo-iframe" id="demo-iframe-code-group-4"></div><script>
            //{"code-group-radio-10":"/blog/unholy-custom-jsx-with-observable-strings/state.1.dom.tsx","code-group-radio-11":"/blog/unholy-custom-jsx-with-observable-strings/state.2.dom.tsx"}
document.addEventListener('DOMContentLoaded', () => {
  const tabs = document.getElementById("code-group-4");
  const demoContainer = document.getElementById("demo-iframe-code-group-4");
  const toDemoArea = (src) => {
    demoContainer.children[0]?.remove();
    const iframe = document.createElement('iframe');
    iframe.style.width = 'calc(100%)';
    iframe.onload=function(){ window.resizeIframe(this)};
    
    iframe.onload = function() {
      const iframeWindow = iframe.contentWindow;
      const doc = iframe.contentDocument || iframeWindow.document;

      doc.open();
      doc.write(`
        <html style='height: fit-content;'>
          <head>
            <style>
            <\/style>
          <\/head>
          <body style='margin: 4px; height: fit-content;'>
          <\/body>
          <script type="module" src="${src}"><\/script>
          <script>
              (function() {
                const observer = new MutationObserver(() => {
                  // Adjust the height of the parent iframe based on the body's height
                  window.frameElement.style.height = (document.documentElement.offsetHeight + 1) +'px';
                });

                // Start observing changes in the body element
                observer.observe(document.body, { childList: true, subtree: true, attributes: true });

                // Initial setting of height
                window.frameElement.style.height = (document.documentElement.offsetHeight + 1) + 'px';
              })();
            <\/script>
        <\/html>
      `);
      doc.close();
    };
    // iframe.style.cssText="width:100%;";
    demoContainer.appendChild(iframe);
    // const doc = iframe.contentDocument || iframe.contentWindow?.document;
    // doc.open();
    // doc.write(`
    //   
    //   <head></head>
    //   
    //     
    //   </body>
    //   </html>
    // `);
    // doc.close();
  };


  const id0 = document.getElementById('code-group-radio-10');
  id0.addEventListener('input', e => {
    if(e.target.checked) {
      toDemoArea("/blog/unholy-custom-jsx-with-observable-strings/state.1.dom.tsx")
    }
  });
  if(id0.checked) {
    console.log("I am checked...", id0);
    toDemoArea("/blog/unholy-custom-jsx-with-observable-strings/state.1.dom.tsx")
  }
  

  const id1 = document.getElementById('code-group-radio-11');
  id1.addEventListener('input', e => {
    if(e.target.checked) {
      toDemoArea("/blog/unholy-custom-jsx-with-observable-strings/state.2.dom.tsx")
    }
  });
  if(id1.checked) {
    console.log("I am checked...", id1);
    toDemoArea("/blog/unholy-custom-jsx-with-observable-strings/state.2.dom.tsx")
  }
  
});
</script><style>
.code-group pre {display:none}
.code-group-4 {

  #code-group-radio-10+label {

  }

  #code-group-radio-10:checked+label {
    background:#282c34;
    position: relative;
    z-index:1;
    border-bottom: none;
    
    &:hover {
      text-decoration: underline;
      color: white;
    }

    border-top-color: var(--color-blue-500);

    &::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 6px;
      z-index: 10;
      width: 100%; 
      background: var(--color-blue-500);
    }

  }

  &:has(#code-group-radio-10:checked) pre:nth-child(2){ 
    display: block;
  }
  

  #code-group-radio-11+label {

  }

  #code-group-radio-11:checked+label {
    background:#282c34;
    position: relative;
    z-index:1;
    border-bottom: none;
    
    &:hover {
      text-decoration: underline;
      color: white;
    }

    border-top-color: var(--color-blue-500);

    &::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 6px;
      z-index: 10;
      width: 100%; 
      background: var(--color-blue-500);
    }

  }

  &:has(#code-group-radio-11:checked) pre:nth-child(3){ 
    display: block;
  }
  
} </style></div><style>
#section-state {
  --section-header-hr-start: 80%;
  --section-header-hr-stop: 100%;
}
</style><div class="flair-section"></div></section></div></main><footer></footer><script>// Smooth scrolling for browsers that don't support CSS smooth scrolling
;(() => {
  /**
   * @type {Record<string, {elem: HTMLElement, percent: number, lastEntry: null | IntersectionObserverEntry}>}
   */
  const byId = {}
  window.sectionById = byId
  /**
   * @type {(typeof byId)[string]}
   */
  let top = null
  /**
   * @type {(typeof byId)[string]}
   */
  let bottom = null

  window.addEventListener("DOMContentLoaded", () => {
    /**
     * @type {HTMLElement}
     */
    const nav = document.getElementById("toc-nav")
    const li = nav?.querySelector("li a")

    let liRatio = li.offsetHeight / nav.offsetHeight

    window.addEventListener("resize", () => {
      console.log("Resize detected")
      liRatio = li.offsetHeight / nav.offsetHeight
    })

    const setEnds = (start, end) => {
      start != null &&
        nav.style.setProperty(
          "--toc-scroll-start",
          "" + (start * 100).toFixed(0) + "%",
        )
      end != null &&
        nav.style.setProperty(
          "--toc-scroll-end",
          "" + (end * 100).toFixed(0) + "%",
        )
    }

    // use elem, its the li
    // now we have its offset from its parent
    // get percent from parent 0 edge
    // that is constant range start

    const observer = new IntersectionObserver(
      entries => {
        entries.forEach(entry => {
          const id = entry.target.getAttribute("id") ?? ""
          let cache =
            // biome-ignore lint/suspicious/noAssignInExpressions: <explanation>
            (byId[id] ||= {
              elem: document.querySelector(
                `nav li a[href="#${id}"]`,
              ),
              percent: 0,
              lastEntry: entry,
            })
          const elem = cache.elem
          cache.lastEntry = entry
          cache.percent = entry.intersectionRatio
          if (entry.isIntersecting) {
            if (entry.intersectionRatio === 1) {
              // console.log("we are golden", cache)
              // console.log("--", elem)
              if (!top) {
                // console.log("A)", elem)
                top = cache
              } else if (
                top.lastEntry.intersectionRect.top >
                  entry.intersectionRect.top ||
                top.lastEntry.time < entry.time
              ) {
                // console.log("AA)", elem)
                // this entry is above the previous top
                top = cache
              } else {
                // console.log(
                //   top.lastEntry,
                //   "does not beat",
                //   entry,
                // )
              }
              // we take full percent of offset + offset+height of LI
            } else if (
              entry.intersectionRect.y ===
                entry.rootBounds.y &&
              entry.intersectionRect.bottom ===
                entry.rootBounds.bottom
            ) {
              // console.log("B)", elem)
              top = cache
              bottom = cache
              // console.log(
              //   "this is both entering/exiting element",
              //   cache,
              // )
            } else if (entry.intersectionRect.y === 0) {
              // console.log(
              //   "this is the leaving element",
              //   cache,
              // )
              // console.log("C)", elem)
              top = cache
            } else {
              // console.log(
              //   "this is the entering element",
              //   cache,
              // )
              // console.log("D)", elem)
              bottom = cache
            }
            if (cache.percent === 0)
              elem?.parentElement?.classList.add(
                "viewtimeline-active",
              )
          } else {
            elem?.parentElement?.classList.remove(
              "viewtimeline-active",
            )
            cache.percent = 0
          }
          // console.log(entry.boundingClientRect.top)
          if (entry.boundingClientRect.top < 0) {
            // we have passed the element and are exiting, which means we are stickied. we need to set the var for our mini gradient as a ratio of relative percent of top / height
            const underWater =
              Math.abs(entry.boundingClientRect.top) /
              entry.boundingClientRect.height

            entry.target.style.setProperty(
              "--section-header-hr-progress",
              underWater,
            )
          }
        })
        if (top && bottom) {
          const a = top.elem // get corresponding LI's anchor
          const percentFromNavTop =
            a.offsetTop / a.offsetParent.offsetHeight // this is our base percent we are setting
          // now calculate the intersection ratio relative to

          const percentDiff =
            (a.offsetHeight *
              (1 - top.lastEntry.intersectionRatio)) /
            a.offsetParent.offsetHeight

          const b = bottom.elem
          const percentFromNavTopToBottom =
            (b.offsetTop + b.offsetHeight) /
            b.offsetParent.offsetHeight // this is our base percent we are setting
          // now calculate the intersection ratio relative to

          const percentDiffB =
            (b.offsetHeight *
              (1 - bottom.lastEntry.intersectionRatio)) /
            b.offsetParent.offsetHeight

          // console.log({
          //   top,
          //   bottom,
          //   percentFromNavTop,
          //   percentFromNavTopToBottom,
          //   percentDiff,
          //   percentDiffB,
          //   a,
          //   b,
          // })

          setEnds(
            percentFromNavTop + percentDiff,
            percentFromNavTopToBottom - percentDiffB,
          )
        }
        // console.log({ top, bottom })
      },
      {
        threshold: Array.from(
          { length: 10 },
          (_, i) => i / 10,
        ),
      },
    )

    // Track all sections that have an `id` applied
    document
      .querySelectorAll("#main-content-middle section[id]")
      .forEach(section => {
        observer.observe(section)
      })
  })
})()
;
;document.addEventListener("DOMContentLoaded", () => {
  try {
    const it = document.getElementById("toc-toggle")
    if (it) {
      it.checked = JSON.parse(
        localStorage.tocChecked ?? "false",
      )
      it.addEventListener("change", e => {
        localStorage.tocChecked = !!e.target.checked
      })
    }
  } catch (e) {}
  setTimeout(() => {
    document.body.classList.toggle("ready")
  }, 1)
})
;
;function copyToClipboard(text) {
  navigator.clipboard
    .writeText(text)
    .then(() => {
      // Text copied successfully
      console.log("Text copied to clipboard")
    })
    .catch(err => {
      // Error copying text
      console.error("Failed to copy text: ", err)
    })
}

/**
 * @param {HTMLElement} el
 * @param {Window} win
 */
function selectElementText(el, win) {
  win = win || window
  let doc = win.document
  /**
   * @type {Selection}
   */
  let sel
  /**
   * @type {Range}
   */
  let range

  if (win.getSelection && doc.createRange) {
    sel = win.getSelection()
    range = doc.createRange()
    range.selectNodeContents(el)
    sel.removeAllRanges()
    sel.addRange(range)
  } else if (doc.body.createTextRange) {
    range = doc.body.createTextRange()
    range.moveToElementText(el)
    range.select()
  }
  console.log(sel.toString())
  return sel.toString()
}

document.addEventListener("click", e => {
  let target =
    e.target.classList.contains("copy-to-clipboard") &&
    e.target.parentElement.classList.contains("shiki")
      ? e.target
      : null
  target = target?.parentElement.querySelector("code")
  if (target) {
    copyToClipboard(selectElementText(target))
    window.getSelection().removeAllRanges()
  }
})
;
;let isZoomin = false
let container = null
const remove = () => {
  if (!container) return
  container?.remove()
  container = null
  const it = document.querySelector(".img-zoom")
  it?.classList.toggle("img-zoom")
  isZoomin = false
}
document.addEventListener("click", e => {
  if (
    isZoomin &&
    e.target.classList.contains("img-zoom-clone-parent")
  ) {
    document
      .querySelector(".img-zoom-clone-exit")
      ?.dispatchEvent(
        new MouseEvent("click", {
          view: window,
          bubbles: true,
          cancelable: false,
        }),
      )
  }

  if (e.target.tagName === "IMG") {
    if (e.target.classList.contains("img-zoom-clone")) {
      return
    }
    if (!e.target.classList.contains("img-zoom")) {
      /**
       * @type {HTMLImageElement}
       */
      const orig = e.target
      /**
       * @type {HTMLImageElement}
       */
      const clone = e.target.cloneNode()
      clone.classList.add("img-zoom-clone")

      container = document.createElement("div")
      container.classList.add("img-zoom-clone-parent")

      const behind = document.createElement("div")
      behind.classList.add("behind")

      const exitButton = document.createElement("button")
      exitButton.classList.add("img-zoom-clone-exit")
      ;[exitButton, behind].forEach(i =>
        i.addEventListener("click", remove),
      )
      isZoomin = true

      exitButton.setAttribute("aria-role", "button")
      exitButton.setAttribute("type", "button")
      exitButton.innerHTML = "Close"

      container.appendChild(behind)
      container.appendChild(clone)
      container.appendChild(exitButton)

      document.body.appendChild(container)
      e.target.classList.toggle("img-zoom")
      requestAnimationFrame(() => {
        exitButton.focus()
      })
    }
  }
})

document.addEventListener("keyup", e => {
  if (e.key === "Escape" && isZoomin) {
    remove()
  }
})
;
;document.addEventListener("DOMContentLoaded", function () {
  const element = document.querySelector(
    "[data-scroll-to-me]",
  )
  document.addEventListener(
    "click",
    e => {
      /**
       * @type {HTMLElement}
       */
      let h = e.target
      if (h.matches("[data-scroll-to-me]")) {
        /**
         * @type {HTMLElement}
         */
        const it = document.querySelector(
          h.dataset.scrollToMe,
        )
        if (it)
          setTimeout(
            () => it.scrollIntoView({ behavior: "smooth" }),
            16,
          )
      }
    },
    { capture: true },
  )
})
</script></body></html>