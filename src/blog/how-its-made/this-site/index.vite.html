<html lang="en"><head><meta name="viewport" content="width=device-width, initial-scale=1"><meta charSet="UTF-8"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><link rel="stylesheet" href="/styles/colors.css"><link rel="stylesheet" href="/styles/fonts.css"><link rel="stylesheet" href="/styles/global.css"><link rel="stylesheet" href="/styles/nav_and_toc.css"><link rel="stylesheet" href="/styles/hex.css"><link rel="stylesheet" href="/styles/code.css"><link rel="stylesheet" href="/styles/img.css"><link rel="stylesheet" href="/shiki-twoslash.css"><title>How I made this site as of 2025/03/16</title></head><body class=""><header><nav id="primary-nav" aria-label="Primary navigation"><div class="nav-links" role="tablist"><a href="/home" role="tab" class="nav-link-anchor"><span class="nav-link ">Home</span></a><a href="/resume" role="tab" class="nav-link-anchor"><span class="nav-link ">Resume</span></a><a href="/blog" role="tab" aria-selected="true" class="nav-link-anchor"><span class="nav-link active">Blog</span></a><a href="/tags" role="tab" class="nav-link-anchor"><span class="nav-link ">Tags</span></a></div></nav></header><main class="body-markdown"><section id="title-and-description"><h1>How I made this site as of 2025/03/16</h1><sub>2025-03-11 by Chris Hafley</sub><div id="h1-desc">Astro.js is cool but I don't like that much magic</div><div class="f-col f-a-center" id="tags" style="margin-bottom:24px;"><div class="responsive-hex-grid-3"><a class="hex-content caption" href="/tags/typescript" style="--hex-color:var(--color-inferno-2);">
      <div class="hex-content hex-shadow">
        <div class="hex-content-amoeba"></div>
      </div>
      <div class="hex-content-amoeba"></div>
      <span>typescript</span>
</a><a class="hex-content caption" href="/tags/javascript" style="--hex-color:var(--color-inferno-4);">
      <div class="hex-content hex-shadow">
        <div class="hex-content-amoeba"></div>
      </div>
      <div class="hex-content-amoeba"></div>
      <span>javascript</span>
</a><a class="hex-content caption" href="/tags/astro" style="--hex-color:var(--color-inferno-6);">
      <div class="hex-content hex-shadow">
        <div class="hex-content-amoeba"></div>
      </div>
      <div class="hex-content-amoeba"></div>
      <span>astro</span>
</a><a class="hex-content caption" href="/tags/ssg" style="--hex-color:var(--color-inferno-8);">
      <div class="hex-content hex-shadow">
        <div class="hex-content-amoeba"></div>
      </div>
      <div class="hex-content-amoeba"></div>
      <span>ssg</span>
</a><a class="hex-content caption" href="/tags/deno" style="--hex-color:var(--color-inferno-10);">
      <div class="hex-content hex-shadow">
        <div class="hex-content-amoeba"></div>
      </div>
      <div class="hex-content-amoeba"></div>
      <span>deno</span>
</a><a class="hex-content caption" href="/tags/markdown" style="--hex-color:var(--color-inferno-12);">
      <div class="hex-content hex-shadow">
        <div class="hex-content-amoeba"></div>
      </div>
      <div class="hex-content-amoeba"></div>
      <span>markdown</span>
</a><a class="hex-content caption" href="/tags/node" style="--hex-color:var(--color-inferno-14);">
      <div class="hex-content hex-shadow">
        <div class="hex-content-amoeba"></div>
      </div>
      <div class="hex-content-amoeba"></div>
      <span>node</span>
</a></div></div></section><details open="true" id="section-table-of-contents"><summary id="toc-header-contents"><h2 id="table-of-contents">Table of Contents</h2><input type="checkbox" id="toc-toggle"></summary><div class="fancy-hr"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 20"><circle cx="10" cy="10" r="7" style="fill:var(--color-text);" stroke-width="2"></circle><circle cx="30" cy="10" r="9" style="fill:var(--color-text);" stroke-width="2" fill="transparent"></circle><circle cx="50" cy="10" r="7" style="fill:var(--color-text);" stroke-width="2"></circle></svg></div><nav id="toc-nav"><div class="debug-slider"></div><ol debug="true"><li debug="true"><a href="#section-reasons-to-make-my-own-website">1.  Reasons to make my own website</a></li><li debug="true"><a href="#section-the-good">2.  The good</a><ol><li debug="true"><a href="#section-really-nice-docs">2.1.  Really nice docs</a></li><li debug="true"><a href="#section-is-quite-fast">2.2.  Is quite fast </a></li><li debug="true"><a href="#section-lots-of-options">2.3.  Lots of options</a></li><li debug="true"><a href="#section-markdown">2.4.  Markdown </a></li><li debug="true"><a href="#section-vite-based">2.5.  Vite based</a></li></ol></li><li debug="true"><a href="#section-the-bad">3.  The Bad</a><ol><li debug="true"><a href="#section-too-many-options">3.1.  Too many options</a></li><li debug="true"><a href="#section-confusing-flow-of-time">3.2.  Confusing flow of time</a></li><li debug="true"><a href="#section-to-react-or-not-react">3.3.  To react or not react</a></li><li debug="true"><a href="#section-magic-meta-glob-imports">3.4.  Magic meta glob imports</a></li><li debug="true"><a href="#section-collections-or-source-code">3.5.  Collections or source code</a></li><li debug="true"><a href="#section-markdown-frontmatter">3.6.  Markdown frontmatter</a></li></ol></li></ol></nav></details><div id="main-content-middle"><section id="section-reasons-to-make-my-own-website"><h2 id="reasons-to-make-my-own-website"><a href="#reasons-to-make-my-own-website">1.  Reasons to make my own website</a></h2><p>So I have been caught writing a lot of my thoughts to coworkers in gigantic article length messages.
I kept hitting post limits, so better to state an argument for or against an idea publically, so my goal is to make it easy for me to shortform, it gets frustrating...or if you've ever had Confluence or Teams decide your message was no longer worth keeping around >:|</p><style>
#section-reasons-to-make-my-own-website {
  --section-header-hr-start: -8.881784197001252e-16%;
  --section-header-hr-stop: 7.142857142857142%;
}
</style></section>
<section id="section-the-good"><h2 id="the-good"><a href="#the-good">2.  The good</a></h2><style>
#section-the-good {
  --section-header-hr-start: 7.1428571428571415%;
  --section-header-hr-stop: 14.285714285714285%;
}
</style></section>
<section id="section-really-nice-docs"><h3 id="really-nice-docs"><a href="#really-nice-docs">2.1.  Really nice docs</a></h3><style>
#section-really-nice-docs {
  --section-header-hr-start: 14.285714285714285%;
  --section-header-hr-stop: 21.428571428571427%;
}
</style></section>
<section id="section-is-quite-fast"><h3 id="is-quite-fast"><a href="#is-quite-fast">2.2.  Is quite fast</a></h3><style>
#section-is-quite-fast {
  --section-header-hr-start: 21.428571428571427%;
  --section-header-hr-stop: 28.57142857142857%;
}
</style></section>
<section id="section-lots-of-options"><h3 id="lots-of-options"><a href="#lots-of-options">2.3.  Lots of options</a></h3><style>
#section-lots-of-options {
  --section-header-hr-start: 28.571428571428573%;
  --section-header-hr-stop: 35.714285714285715%;
}
</style></section>
<section id="section-markdown"><h3 id="markdown"><a href="#markdown">2.4.  Markdown</a></h3><style>
#section-markdown {
  --section-header-hr-start: 35.71428571428571%;
  --section-header-hr-stop: 42.857142857142854%;
}
</style></section>
<section id="section-vite-based"><h3 id="vite-based"><a href="#vite-based">2.5.  Vite based</a></h3><style>
#section-vite-based {
  --section-header-hr-start: 42.857142857142854%;
  --section-header-hr-stop: 50%;
}
</style></section>
<section id="section-the-bad"><h2 id="the-bad"><a href="#the-bad">3.  The Bad</a></h2><style>
#section-the-bad {
  --section-header-hr-start: 49.99999999999999%;
  --section-header-hr-stop: 57.14285714285714%;
}
</style></section>
<section id="section-too-many-options"><h3 id="too-many-options"><a href="#too-many-options">3.1.  Too many options</a></h3><style>
#section-too-many-options {
  --section-header-hr-start: 57.142857142857146%;
  --section-header-hr-stop: 64.28571428571429%;
}
</style></section>
<section id="section-confusing-flow-of-time"><h3 id="confusing-flow-of-time"><a href="#confusing-flow-of-time">3.2.  Confusing flow of time</a></h3><style>
#section-confusing-flow-of-time {
  --section-header-hr-start: 64.28571428571429%;
  --section-header-hr-stop: 71.42857142857143%;
}
</style></section>
<section id="section-to-react-or-not-react"><h3 id="to-react-or-not-react"><a href="#to-react-or-not-react">3.3.  To react or not react</a></h3><style>
#section-to-react-or-not-react {
  --section-header-hr-start: 71.42857142857143%;
  --section-header-hr-stop: 78.57142857142857%;
}
</style></section>
<section id="section-magic-meta-glob-imports"><h3 id="magic-meta-glob-imports"><a href="#magic-meta-glob-imports">3.4.  Magic meta glob imports</a></h3><style>
#section-magic-meta-glob-imports {
  --section-header-hr-start: 78.57142857142857%;
  --section-header-hr-stop: 85.71428571428571%;
}
</style></section>
<section id="section-collections-or-source-code"><h3 id="collections-or-source-code"><a href="#collections-or-source-code">3.5.  Collections or source code</a></h3><style>
#section-collections-or-source-code {
  --section-header-hr-start: 85.71428571428572%;
  --section-header-hr-stop: 92.85714285714286%;
}
</style></section>
<section id="section-markdown-frontmatter"><h3 id="markdown-frontmatter"><a href="#markdown-frontmatter">3.6.  Markdown frontmatter</a></h3><style>
#section-markdown-frontmatter {
  --section-header-hr-start: 92.85714285714286%;
  --section-header-hr-stop: 100%;
}
</style></section></div></main><footer></footer><script>// Smooth scrolling for browsers that don't support CSS smooth scrolling
;(() => {
  /**
   * @type {Record<string, {elem: HTMLElement, percent: number, lastEntry: null | IntersectionObserverEntry}>}
   */
  const byId = {}
  window.sectionById = byId
  /**
   * @type {(typeof byId)[string]}
   */
  let top = null
  /**
   * @type {(typeof byId)[string]}
   */
  let bottom = null

  window.addEventListener("DOMContentLoaded", () => {
    /**
     * @type {HTMLElement}
     */
    const nav = document.getElementById("toc-nav")
    const li = nav?.querySelector("li a")

    let liRatio = li.offsetHeight / nav.offsetHeight

    window.addEventListener("resize", () => {
      console.log("Resize detected")
      liRatio = li.offsetHeight / nav.offsetHeight
    })

    const setEnds = (start, end) => {
      start != null &&
        nav.style.setProperty(
          "--toc-scroll-start",
          "" + (start * 100).toFixed(0) + "%",
        )
      end != null &&
        nav.style.setProperty(
          "--toc-scroll-end",
          "" + (end * 100).toFixed(0) + "%",
        )
    }

    // use elem, its the li
    // now we have its offset from its parent
    // get percent from parent 0 edge
    // that is constant range start

    const observer = new IntersectionObserver(
      entries => {
        entries.forEach(entry => {
          const id = entry.target.getAttribute("id") ?? ""
          let cache =
            // biome-ignore lint/suspicious/noAssignInExpressions: <explanation>
            (byId[id] ||= {
              elem: document.querySelector(
                `nav li a[href="#${id}"]`,
              ),
              percent: 0,
              lastEntry: entry,
            })
          const elem = cache.elem
          cache.lastEntry = entry
          cache.percent = entry.intersectionRatio
          if (entry.isIntersecting) {
            if (entry.intersectionRatio === 1) {
              // console.log("we are golden", cache)
              // console.log("--", elem)
              if (!top) {
                // console.log("A)", elem)
                top = cache
              } else if (
                top.lastEntry.intersectionRect.top >
                  entry.intersectionRect.top ||
                top.lastEntry.time < entry.time
              ) {
                // console.log("AA)", elem)
                // this entry is above the previous top
                top = cache
              } else {
                // console.log(
                //   top.lastEntry,
                //   "does not beat",
                //   entry,
                // )
              }
              // we take full percent of offset + offset+height of LI
            } else if (
              entry.intersectionRect.y ===
                entry.rootBounds.y &&
              entry.intersectionRect.bottom ===
                entry.rootBounds.bottom
            ) {
              // console.log("B)", elem)
              top = cache
              bottom = cache
              // console.log(
              //   "this is both entering/exiting element",
              //   cache,
              // )
            } else if (entry.intersectionRect.y === 0) {
              // console.log(
              //   "this is the leaving element",
              //   cache,
              // )
              // console.log("C)", elem)
              top = cache
            } else {
              // console.log(
              //   "this is the entering element",
              //   cache,
              // )
              // console.log("D)", elem)
              bottom = cache
            }
            if (cache.percent === 0)
              elem?.parentElement?.classList.add(
                "viewtimeline-active",
              )
          } else {
            elem?.parentElement?.classList.remove(
              "viewtimeline-active",
            )
            cache.percent = 0
          }
          console.log(entry.boundingClientRect.top)
          if (entry.boundingClientRect.top < 0) {
            // we have passed the element and are exiting, which means we are stickied. we need to set the var for our mini gradient as a ratio of relative percent of top / height
            const underWater =
              Math.abs(entry.boundingClientRect.top) /
              entry.boundingClientRect.height

            entry.target.style.setProperty(
              "--section-header-hr-progress",
              underWater,
            )
          }
        })
        if (top && bottom) {
          const a = top.elem // get corresponding LI's anchor
          const percentFromNavTop =
            a.offsetTop / a.offsetParent.offsetHeight // this is our base percent we are setting
          // now calculate the intersection ratio relative to

          const percentDiff =
            (a.offsetHeight *
              (1 - top.lastEntry.intersectionRatio)) /
            a.offsetParent.offsetHeight

          const b = bottom.elem
          const percentFromNavTopToBottom =
            (b.offsetTop + b.offsetHeight) /
            b.offsetParent.offsetHeight // this is our base percent we are setting
          // now calculate the intersection ratio relative to

          const percentDiffB =
            (b.offsetHeight *
              (1 - bottom.lastEntry.intersectionRatio)) /
            b.offsetParent.offsetHeight

          // console.log({
          //   top,
          //   bottom,
          //   percentFromNavTop,
          //   percentFromNavTopToBottom,
          //   percentDiff,
          //   percentDiffB,
          //   a,
          //   b,
          // })

          setEnds(
            percentFromNavTop + percentDiff,
            percentFromNavTopToBottom - percentDiffB,
          )
        }
        // console.log({ top, bottom })
      },
      {
        threshold: Array.from(
          { length: 10 },
          (_, i) => i / 10,
        ),
      },
    )

    // Track all sections that have an `id` applied
    document
      .querySelectorAll("#main-content-middle section[id]")
      .forEach(section => {
        observer.observe(section)
      })
  })
})()
;
;document.addEventListener("DOMContentLoaded", () => {
  try {
    const it = document.getElementById("toc-toggle")
    if (it) {
      it.checked = JSON.parse(
        localStorage.tocChecked ?? "false",
      )
      it.addEventListener("change", e => {
        localStorage.tocChecked = !!e.target.checked
      })
    }
  } catch (e) {}
  setTimeout(() => {
    document.body.classList.toggle("ready")
  }, 1)
})
;
;function copyToClipboard(text) {
  navigator.clipboard
    .writeText(text)
    .then(() => {
      // Text copied successfully
      console.log("Text copied to clipboard")
    })
    .catch(err => {
      // Error copying text
      console.error("Failed to copy text: ", err)
    })
}

/**
 * @param {HTMLElement} el
 * @param {Window} win
 */
function selectElementText(el, win) {
  win = win || window
  let doc = win.document
  /**
   * @type {Selection}
   */
  let sel
  /**
   * @type {Range}
   */
  let range

  if (win.getSelection && doc.createRange) {
    sel = win.getSelection()
    range = doc.createRange()
    range.selectNodeContents(el)
    sel.removeAllRanges()
    sel.addRange(range)
  } else if (doc.body.createTextRange) {
    range = doc.body.createTextRange()
    range.moveToElementText(el)
    range.select()
  }
  console.log(sel.toString())
  return sel.toString()
}

document.addEventListener("click", e => {
  let target =
    e.target.classList.contains("copy-to-clipboard") &&
    e.target.parentElement.classList.contains("shiki")
      ? e.target
      : null
  target = target?.parentElement.querySelector("code")
  if (target) {
    copyToClipboard(selectElementText(target))
    window.getSelection().removeAllRanges()
  }
})
;
;let isZoomin = false
let container = null
const remove = () => {
  if (!container) return
  container?.remove()
  container = null
  const it = document.querySelector(".img-zoom")
  it?.classList.toggle("img-zoom")
  isZoomin = false
}
document.addEventListener("click", e => {
  if (
    isZoomin &&
    e.target.classList.contains("img-zoom-clone-parent")
  ) {
    document
      .querySelector(".img-zoom-clone-exit")
      ?.dispatchEvent(
        new MouseEvent("click", {
          view: window,
          bubbles: true,
          cancelable: false,
        }),
      )
  }

  if (e.target.tagName === "IMG") {
    if (e.target.classList.contains("img-zoom-clone")) {
      return
    }
    if (!e.target.classList.contains("img-zoom")) {
      /**
       * @type {HTMLImageElement}
       */
      const orig = e.target
      /**
       * @type {HTMLImageElement}
       */
      const clone = e.target.cloneNode()
      clone.classList.add("img-zoom-clone")

      container = document.createElement("div")
      container.classList.add("img-zoom-clone-parent")

      const behind = document.createElement("div")
      behind.classList.add("behind")

      const exitButton = document.createElement("button")
      exitButton.classList.add("img-zoom-clone-exit")
      ;[exitButton, behind].forEach(i =>
        i.addEventListener("click", remove),
      )
      isZoomin = true

      exitButton.setAttribute("aria-role", "button")
      exitButton.setAttribute("type", "button")
      exitButton.innerHTML = "Close"

      container.appendChild(behind)
      container.appendChild(clone)
      container.appendChild(exitButton)

      document.body.appendChild(container)
      e.target.classList.toggle("img-zoom")
      requestAnimationFrame(() => {
        exitButton.focus()
      })
    }
  }
})

document.addEventListener("keyup", e => {
  if (e.key === "Escape" && isZoomin) {
    remove()
  }
})
</script></body></html>